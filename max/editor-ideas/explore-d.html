<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <title>
      OERPub Editor
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

    <script src="helper_files/jquery-1.8.2.min.js" type="text/javascript"></script>
    <script src="helper_files/jquery.ui.core.min.js" type="text/javascript"></script>
    <script src="helper_files/jquery.ui.position.min.js" type="text/javascript"></script>
    <script src="helper_files/jquery.ui.widget.min.js" type="text/javascript"></script>
    <script src="helper_files/jquery.ui.mouse.min.js" type="text/javascript"></script>
    <script src="helper_files/draggable.js" type="text/javascript"></script>
    <script src="helper_files/jquery.ui.droppable.js" type="text/javascript"></script>
    <script src="helper_files/scrollto.js" type="text/javascript"></script>
    <script src="helper_files/jquery.simplemodal.1.4.1.min.js" type="text/javascript"></script>
    <script src="helper_files/jquery.ui.dialog.min.js" type="text/javascript"></script>
    <script src="helper_files/jquery.effects.core.min.js" type="text/javascript"></script>
    <script src="helper_files/jquery.effects.highlight.min.js" type="text/javascript"></script>
    <script src="helper_files/googlejsapi.js" type="text/javascript"></script>
<!--
    <script src="helper_files/swordpush.js" type="text/javascript"></script>
-->
    <script src="helper_files/swordpush-max-03.js" type="text/javascript"></script>
    <script src="helper_files/hoverIntent.js" type="text/javascript"></script>
    <script src="helper_files/jquery.livequery.js" type="text/javascript"></script>
<!--
    <script src="helper_files/jquery.ui.resizable.min.js" type="text/javascript"></script>
-->
    <script src="helper_files/jquery.mousestop.js" type="text/javascript"></script>
    <script src="helper_files/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="helper_files/jquery.contextmenu.js" type="text/javascript"></script>
    <script src="helper_files/jquery.animate-shadow-min.js" type="text/javascript"></script>
<!--
    <script src="helper_files/jquery.plugin.boxshadow.js" type="text/javascript"></script>
    <script type="text/javascript"
      src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
-->
<!--
    <script type="text/javascript" src="http://cnx.org/++resource++mathjax/MathJax.js">
            MathJax.Hub.Config({
                extensions: ["mml2jax-bugfix.js"],
                menuSettings: {zoom:"Click"},
                "HTML-CSS": {scale:110},
                jax: ["input/MathML","output/HTML-CSS"]
            });
            if(location.href.split("#").length != 1) {
              MathJax.Hub.Register.StartupHook("End", function() {location.href = location.href; });
            }
    </script>
-->
    <script src="helper_files/ASCIIMathMLwFallback.js" type="text/javascript"></script>
    <script src="helper_files/ASCIIMathMLeditor.js" type="text/javascript"></script>
    <script src="helper_files/ASCIIMathMLcustomisations.js" type="text/javascript"></script>

    <!-- Max writes: This doesn't need to be the Connexions X ... but it was useful to have something there when making these mock-ups. -->
    <link rel="shortcut icon" type="image/x-icon" href="helper_files/favicon.ico" />

<link type="text/css" href="content_files/document-in-oerpub-01.css" media="screen" title="newlook" rel="stylesheet"/>

<!--
    <link rel="stylesheet" href="helper_files/main.css" type="text/css" media="screen" charset="utf-8" />
-->
    <link rel="stylesheet" href="helper_files/main-max-04.css" type="text/css" media="screen" charset="utf-8" />
    <link rel="stylesheet" href="helper_files/ui-theme-base/jquery.ui.all.css" type="text/css" media="screen" charset="utf-8" />
<!--
    <link rel="stylesheet" href="helper_files/bootstrap/css/bootstrap.css" type="text/css" media="screen" charset="utf-8" />
-->
    <!--[if IE 6]>
    <link rel="stylesheet" href="helper_files/ie6.css" type="text/css" media="screen" charset="utf-8" />
    <![endif]-->

<script type="text/javascript">

$(window).resize(function(){

  var winh = $(window).height();
  var headerh = $("#header-container").outerHeight();
  var wfnh = $("#workflownav-wrap").outerHeight();
  var contentp = parseInt($("#content").css("paddingTop"));
  var contentp = contentp + parseInt($("#content").css("paddingBottom"));
  var phwh = $("#pageheader-wrap").outerHeight();
  var ma = $("#module-actions .advanced").outerWidth();
/*
  var cmt = parseInt($("#canvas").css("marginTop"));
  var cpt = parseInt($("#canvas").css("paddingTop"));
*/

  // Make the editor fit exactly inside the remaining space
//  $("#editor").height(winh - headerh - wfnh - contentp - phwh + 10);
//  $("#artboard").height(winh - headerh - wfnh - contentp - phwh + 10 - 46 - cmt - cpt*2);
//  $("#artboard").height(winh - headerh - wfnh - contentp - phwh + 10 - 44);
  $("#artboard").height(winh - 43);
  $("#editor").width($(window).width() - 0);

});


$(document).ready(function(){

/* Moved this portion back directly into the file because 'headerh' wasn't always correctly calculated when done from the external file. */

  var winh = $(window).height();
  var headerh = $("#header-container").outerHeight();
  var wfnh = $("#workflownav-wrap").outerHeight();
  var contentp = parseInt($("#content").css("paddingTop"));
  var contentp = contentp + parseInt($("#content").css("paddingBottom"));
  var phwh = $("#pageheader-wrap").outerHeight();
  var ma = $("#module-actions .advanced").outerWidth();

  // Make the editor fit exactly inside the remaining space
//  $("#editor").height(winh - headerh - wfnh - contentp - phwh + 10);
//  $("#artboard").height(winh - headerh - wfnh - contentp - phwh + 10 - 44);
//  $("#editor").height(winh - 30);
//  $("#artboard").height(winh - 43);
  $("#artboard").css("margin-top",$('#toolbar').outerHeight() + "px");
  $("#editor").width($(window).width() - 0);

  // Give the page's header the correct top margin (since the elements above it are in a fixed position)
//  $("#content").css({'margin-top': headerh + wfnh})


  $("#toolbar-table").hoverIntent({
    over: function(e){
//      selectIcon($(this),aol,e);
    }, 
    out: function(e){
      unSelectIcon($(this),e);
    },
    timeout: 300,
  });

  $("#toolbar-table-options").hoverIntent({
    over: function(e){
    }, 
    out: function(e){
      unSelectIcon($(this),e);
    },
    timeout: 300,
  });

  $("#toolbar-olist-options").hoverIntent({
    over: function(e){
    }, 
    out: function(e){
      unSelectIcon($(this),e);
    },
    timeout: 300,
  });

  $(".toolbar-icon").click(function(e){
    fn = $(this).closest(".toolbar-function");
    if (fn.not(".disabled")) {
      if (fn.hasClass("selected")) {
        unSelectIcon(fn,e);
      } else {
        selectIcon(fn,aol,e);
      }
    }
    return false;
  });

/*
  $(".dropdown-toggle").click(function(e){
    var exText = newTablePlaceHolder(e);
    activateTableTemp();
    var td = $(this).closest(".toolbar-dropdown");
    if (td.hasClass("selected")) {
      td.removeClass("selected");
      td.find(".dropdown-menu").hide();
    } else {
      // If the cursor is in a table, enable the add/delete rows/columns options
      if ( $("#TableNew").closest(".table").length ) {
        $(".menu-list").removeClass("disabled");
        $("#TableNew").closest("td,th").addClass("current-cell");
      }
      td.addClass("selected");
      td.find(".dropdown-menu").show();
    }
    return false;
  });
*/

  $("#include-row-header, label[for='include-row-header']").live("click", function(e){
    if ($(this).is(":checked")) {
      $("#table-flyout tr:first-child td").each(function(e){
        $(this).addClass("header")
      });
    } else {
      $("#table-flyout tr:first-child td").each(function(e){
        $(this).removeClass("header")
      });
    }
    e.stopPropagation();
  });

  $("#table-flyout td").live("mouseenter", function(e){
    tfEnter($(this),e);
  });
  function tfEnter(td,e) {
    tfLeave(td.closest("table"),e);
    var curCol = td.index() + 1;
    var curRow = td.closest("tr").index() + 1;
    var totCols = td.siblings().length + 1;
    var totRows = td.closest("tbody").find("tr").length;
    // Remove rows if going upwards with 6+ rows
    if (curRow > 4 && totRows - curRow > 1) {
      td.closest("tbody").find("tr").last().remove();
    }
    // Remove columns if going left with 6+ columns
    if (curCol > 4 && totCols - curCol > 1) {
      td.closest("tbody").find("tr").each(function(e){
        $(this).find("td").last().remove();
      });
    }
    for (i=0; i<curRow; i++) {
      td.closest("tbody").children("tr").eq(i).each(function(e){
        for (j=0; j<curCol; j++) {
          $(this).find("td").eq(j).addClass("hovered");
        }
      });
    }
    // Add a new row to expand
    if (curRow > totRows - 1) {
      var newRows = '';
      for(k=0; k<totCols; k++) {
        newRows = newRows + "<td>&nbsp\;</td>";
      }
      td.closest("tbody").append("<tr>" + newRows + "</tr>");
      totRows++;
    }
    // Add a new column to expand
    if (curCol > totCols - 1) {
      td.closest("tbody").children("tr").each(function(e){
        if( $(this).index() == 0 && $("#include-row-header").is(":checked") ) {
          $(this).append('<td class="header">&nbsp\;</td>');
        } else {
          $(this).append('<td>&nbsp\;</td>');
        }
      });
      totCols++;
    }
    $("#table-dimensions").text(curCol + " x " + curRow);
  }

  $("#table-flyout table").live("mouseleave", function(e){
    tfLeave($(this),e);
  });
  function tfLeave(table,e) {
    $("#table-dimensions").text("");
    table.find("td").removeClass("hovered");
  }

  $(".toolbar-function.disabled .toolbar-icon").click(function(e){
    e.preventDefault();
  });


  function preventDefault(e){
    e.preventDefault();
  }

  $("#table-flyout-flyout, #table-flyout").live("click", function(e){
    return false;
  });

  $("#table-flyout td").live("click", function(e){
    if ($("#TableNew").closest("#canvas").length) {
      var curCol = $(this).index() + 1;
      var curRow = $(this).closest("tr").index() + 1;
      var exText = $(this).closest("#table-flyout").data("exText");
      if( $("#include-row-header").is(":checked") ) {
        var rowHeader = true;
      } else {
        var rowHeader = false;
      }
      newTableFill(curCol,curRow,exText,rowHeader,e);
    } else {
      alert("Please place your cursor in the part of the document where you want to add a new table.");
    }
    unSelectIcon($("#toolbar-table"),e);
    e.stopPropagation();
  });
  
  function newTableFill(dimX,dimY,exText,rowHeader,e) {

    var newTable = '<div class="canvas-wrap" contentEditable="false">\
      <div class="table canvas canvas-unhovered">\
        <div class="canvas-inner">\
          <table style="border: 1px solid\; width: 100%\;" align="center" cellpadding="0" cellspacing="0" id="TableNew" contentEditable="false">\
            <caption class="table-text" align="bottom">\
              <span class="cnx_label">Table 1&nbsp\;</span>\
              <span class="table-caption content-editable-2" style="display: none;" contentEditable="true">\
                <span class="hint-text">&nbsp;Add a caption (optional)</span>\
              </span>\
            </caption>\
            <colgroup>\
            </colgroup>\
          </table>\
        </div>\
      </div>\
    </div>';

    $("#TableNew").replaceWith(newTable);
    addHandles($("#TableNew").closest(".canvas-wrap"),'table');
    var width = Math.round(100/dimX);
    for (i=0; i<dimX; i++) {
      $("#TableNew colgroup").append('<col width="' + width + '%"/>');
    }
    if (rowHeader == true) {
      $("#TableNew").append("<thead></thead>");
    }
    if (rowHeader == false || dimY > 1) {
      $("#TableNew").append("<tbody></tbody>");
    }
    for (j=0; j<dimY; j++) {
      if (j == 0) {
        if (dimY > 1) {
          addColumns($("#TableNew thead, #TableNew tbody").first(),dimX,dimY,exText,"",e);
        } else {
          addColumns($("#TableNew thead, #TableNew tbody").first(),dimX,dimY,exText,"lastRow",e);
        }
      } else if (j == dimY - 1) {
        addColumns($("#TableNew tbody"),dimX,dimY,"","lastRow",e);
      } else {
        addColumns($("#TableNew tbody"),dimX,dimY,"","",e);
      }
    }
    $("#TableNew").closest(".canvas-wrap");
    $("#TableNew").closest(".canvas-wrap").effect("highlight", { color: "#E5EEF5" }, 1000);
    $("#TableNew th, #TableNew td").first().focus();
    $("#TableNew").removeAttr("id")
    e.stopPropagation();
  }

  function addColumns(location,dimX,dimY,exText,lastRow,e) {

    var cols = '';
    var repText = '';
    var style = 'text-align: left !important\; border-top-width: 0\; border-left-width: 0\; ';
    location.prop("tagName").toLowerCase() == "thead" ? locType = 'th' : locType = 'td';
    for (k=0; k<dimX; k++) {
      k == 0 && exText != "" ? repText = exText : repText = "&nbsp\;";
      if (k == dimX - 1) {
        style+= "border-right-width: 0\; ";
      } else {
        style+= "border-right-width: 1px\; ";
      }
      if (lastRow == "lastRow") {
        style+= "border-bottom-width: 0 !important\;";
      } else {
        style+= "border-bottom-width: 1px\;";
      }
      cols = cols + '<' + locType + ' style="' + style + '" contentEditable="true" class="content-editable">' + repText + '</' + locType + '>';
    }
    location.append('<tr>' + cols + '</tr>');
  }





  $('.canvas-buddy a').mousedown(function(e){
//    $(this).css("cursor","url('content_files/closedhand.cur')");
    $(this).addClass("dragging");
  });
  $('.canvas-buddy a').mouseup(function(e){
//    $(this).css("cursor","url('content_files/openhand.cur')");
    $(this).removeClass("dragging");
  });





  $("#pedagog ul a").toggle(function(e){
    $(this).addClass("pedagog-click");
  }, function(e){
    $(this).removeClass("pedagog-click");
  });

  var eqcw = $(".equation").parent();
/*
var exercw = $(".exercise").parent();
var quescw = $(".question").parent();
var examcw = $(".example").parent();
var notecw = $(".note").parent();
var rulecw = $(".rule").parent();
*/
//  $("#canvas .para").add(eqcw)
  $("#canvas .para, .canvas-wrap")
//  $("#canvas .para").add(eqcw).add(exercw).add(quescw).add(examcw).add(notecw).add(rulecw)
    .after("<div class='droppable-all droppable-all-existing'/>");
//.before("<div class='droppable-all droppable-all-existing'/>");
  // Trying something slightly different to avoid the problems of sibling paras getting double-contents dropped into them.
  $("#canvas .section-contents, .problem-contents, .solution-contents, .example-contents, .note-contents, .rule-contents, #cnx_main")
    .prepend("<div class='droppable-all droppable-all-existing'/>")
//.append("<div class='droppable-all droppable-all-existing'/>")

  $(".droppable-all").each(function(){
    var pw = $(this).parent().innerWidth();
    $(this).css("width",pw)
  });

/*
  $(".add-solution-2").click(function(e){
    buildSolution($(this),e);
  });
  $(".add-answer").click(function(e){
    buildSolution($(this),e,"Answer");
  });
  $(".add-meaning").click(function(e){
    buildMeaning($(this),e,"Meaning");
  });
*/

  $(".pedagog").each(function(e){
    var elemFormal = $(this).find(".node").clone().children().remove().end().text().trim();
    if (elemFormal == 'Numbered Equation') elemFormal = 'Equation';
//    if (elemFormal.indexOf('Assessment') > -1) elemFormal = 'Assessment item';
    if (elemFormal.indexOf('Note') > -1) elemFormal = 'Note';
    if (elemFormal.indexOf('Question') > -1) elemFormal = 'Question';
    var elemLower = elemFormal.toLowerCase();
//    if (elem == 'assessment item') elem = 'exercise';
    elem = "." + elemLower  + ":visible";
    var elemcount = $(elem).length;
    if (elemcount == 0) {
      $(this).prepend('<div class="count zero">0</div>');
    } else {
      var lis = ''
      $(elem).each(function(index,e){
        ind = index + 1;
        lis += '<li><a href="#' + this.id + '" title="Jump to this ' + elemLower + '">' + elemFormal + ' ' + ind + '</a></li>';
      });
      $(this).prepend('<div class="count"><a href="#" class="count-total">' + elemcount + '</a><div class="node-list"><strong>' + elemFormal + 's in this document</strong><ul>' + lis + '</ul></div></div>');
    }
  });


  $("#pedagog .count").hover(function(e){
    var arrow = "<span class='count-arrow' style='height: ";
    var height = $(this).outerHeight();
    var arrow = arrow + height + "px\; width: " + height/2 + "px\;'></span>"
    $(this).find(".count-total").append(arrow);
    $(this).parent().removeAttr("title");
//    $(this).attr("title","Click to view a list of these elements already in the document.")
    $(this).find(".count-total").addClass("count-total-hover");
    $(this).find(".node-list").show();
    pedagogLiLeave($(this).closest(".pedagog"),e);
    $("#pedagog li.pedagog").die("mouseenter");
  }, function(e){
    $(".node-list").hide();
    $(this).find(".count-total").removeClass("count-total-hover");
    $(this).find(".count-arrow").remove();
    if (e.relatedTarget.parentNode.className.indexOf("pedagog") > -1) {
      pedagogLiEnter($(this).closest(".pedagog"),e);
    }
    $("#pedagog li.pedagog").live("mouseenter", function(e){
      pedagogLiEnter($(this),e);
    });
  });

  $("#pedagog .count").click(function(e){
    return false;
  });

/*
  $("#pedagog .count-total").click(function(e){
    var nl = $(this).parent().find(".node-list");
    if (nl.css("display") == 'none') {
      nl.show();
    } else {
      nl.hide();
    }
    $(this).parent().removeAttr("title");
    $(this).parent().parent().removeAttr("title");
  });
*/

  $(".node-list a").click(function(e){
/*
    target = $(this).attr("href");
    window.location = target;
*/
    var canvasOT = $("#canvas").offset().top;
    e.preventDefault();
    $('body,html').animate({
        scrollTop:$(this.hash).offset().top - canvasOT,
      }, 500);
    $(this.hash).effect("highlight", { color: "#E5EEF5" }, 1500);
  });

  $(".node").hover(function(e){
//    $(this).find(".plus").css("visibility","visible");
    $(this).find(".plus").css("color","#000");
//  $(this).parent().not(".pedagog-glossary").attr("title","Drag this item to the place you want it on the page.");
  }, function(e){
//    $(this).find(".plus").css("visibility","hidden");
    $(this).find(".plus").css("color","#999");
  });

  
  $("#pedagog li.pedagog").live("mouseenter", function(e){
    pedagogLiEnter($(this),e);
  });
  $("#pedagog li.pedagog").live("mouseleave", function(e){
    pedagogLiLeave($(this),e);
  });
  
  function pedagogLiEnter(pl,e) {
    pl.animate({
      left: '+=7px',
      top: '+=3px',
      boxShadow: '-7px -3px rgba(170, 170, 170, 1)',
    }, 200, function(){
      $(this).addClass("hovered");
    });
//  pl.addClass("hovered");
  }
  function pedagogLiLeave(pl,e) {
    pl.animate({
      left: '-=7px',
      top: '-=3px',
      boxShadow: '0 0 rgba(204, 204, 204, 1)',
    }, 200, function(){
      $(this).removeClass("hovered");
    });
//    pl.removeClass("hovered");
  }

  $("#pedagog .node").livequery(function(){
    $(this).hoverIntent({
      over: function(e){
        $(this).next(".helper").show();
      }, 
      out: function(e){
        $(this).next(".helper").hide();
      },
      timeout: 50,
      interval: 600,
    });
  });

  $(".pedagog-glossary").click(function(e){
    $(this).find("input").attr("checked","checked");
    $("#artboard").scrollTo(".glossary-outer",{duration:700,over:0.5,onAfter:function(){
        $(".glossary-container").show();
        $("#artboard").scrollTo(".glossary-outer",{duration:500});
      }
    });
  });


  $(".canvas-buddy").each(function(e){
    ttl = $(this).children("a").attr("title");
    $(this).attr("title",ttl);
  });

  $(".element-options-tabs li").click(function(e){
     var eoid = $(this).attr("id").replace("-tab","");
     $(this).closest(".element-options").find(".element-options-tabs li").removeClass("selected");
     $(this).addClass("selected");
     $(this).closest(".element-options").find(".element-options-contents").hide();
     $("#" + eoid).show();
     return false;
  });

  $("input[name='custom-label']").focus(function(e){
    $("input[value='custom'][name='label']").attr("checked","checked");
  });
  $("input[name='custom-label2']").focus(function(e){
    $("input[value='custom2'][name='label2']").attr("checked","checked");
  });
  $("input[name='custom-label3']").focus(function(e){
    $("input[value='custom3'][name='label3']").attr("checked","checked");
  });


  $(".MathJax").attr("contentEditable","false");
  $(".canvas-wrap").attr("contentEditable","false");

  var cheatsheet = '\
    <div id="cheat-sheet-wrap">\
      <div id="cheat-sheet-open"><img src="content_files/open-cheat-sheet-01.png"></div>\
      <div id="cheat-sheet">\
        <div id="cheat-sheet-close"><img src="content_files/close-cheat-sheet-01.png"></div>\
        <div id="cheat-sheet-title"><strong>Math Cheat Sheet</strong>: Copy the "code" that matches the display you want. Paste it into the math entry box above. Adjust as needed.</div>\
        <div id="cheat-sheet-type">\
          <div>\
            <input type="radio" name="cs-math-type" id="cs_radio_ascii" value="cs_ascii" checked="checked"> <label for="cs_radio_ascii">ASCIIMath</label>\
          </div>\
          <div>\
            <input type="radio" name="cs-math-type" id="cs_radio_latex" value="cs_latex"> <label for="cs_radio_latex">LaTeX</label>\
          </div>\
        </div>\
        <div id="cheat-sheet-ascii" class="cheat-sheet-values">\
          <table><tbody><tr>\
            <td style="font-family: helvetica"><strong>Display:</strong></td>\
            <td><img src="content_files/root2over2.gif"/></td>\
            <td><img src="content_files/pirsq.gif"/></td>\
            <td><img src="content_files/xltoet0.gif"/></td>\
            <td><img src="content_files/infinity.gif"/></td>\
            <td><img src="content_files/aplusxover2.gif"/></td>\
            <td><img src="content_files/choose.gif"/></td>\
            <td><img src="content_files/integral.gif"/></td>\
            <td><img src="content_files/function-01.gif"/></td>\
            <td><img src="content_files/matrix-01.gif"/></td>\
            <td><img src="content_files/sin-01.gif"/></td>\
            <td><img src="content_files/piecewise-01.gif"/></td>\
            <td><img src="content_files/standard-product-01.gif"/></td>\
          </tr>\
          <tr>\
            <td style="font-family: helvetica"><strong>ASCIIMath code:</strong></td>\
            <td>sqrt(2)/2</td>\
            <td>pir^2  or  pi r^2</td>\
            <td>x &lt;= 0</td>\
            <td>x -&gt; oo</td>\
            <td>((A+X)/2 , (B+Y)/2)</td>\
            <td>sum_{k=0}^{s-1} ((n),(k))</td>\
            <td>int_-2^2 4-x^2dx</td>\
            <td>d/dxf(x)=lim_(h->0)(f(x+h)-f(x))/h</td>\
            <td>[[a,b],[c,d]]((n),(k))</td>\
            <td>sin^-1(x)</td>\
            <td>x/x={(1,if x!=0),(text{undefined},if x=0):}</td>\
            <td>((a*b))/c</td>\
          </tr></tbody></table>\
        </div>\
        <div id="cheat-sheet-latex" style="display: none;" class="cheat-sheet-values">\
          Fill in later\
          <br/>\
          <br/>\
          <br/>\
          <br/>\
          <br/>\
          <br/>\
        </div>\
        <div style="clear: both"></div>\
      </div>\
    </div>\
  ';
  $("#artboard-inner").append(cheatsheet);
  $("#cheat-sheet-wrap, #toolbar").css("width",$('#artboard-inner').outerWidth() + "px");

/*
  $('.canvas-wrap').on("mousestop", 200, function(e) {
    cwEnter($(this),e);
  });
*/

});

  $(".clear-text-from-input").live("click", function(e){
    $(this).parent().find("input").val('')
    return false;
  });


  $(".menu-list li:not('.menu-list.disabled li')").live("mouseenter", function(e){
    $(this).addClass("hovered");
  });
  $(".menu-list li").live("mouseleave", function(e){
    $(this).removeClass("hovered");
  });

  function tableEditorRemove(e) {
    $("td,th").removeClass("current-cell"); // Really inefficient, I'm sure.
    $("#table-flyout").remove();
    $("#toolbar-table").removeClass("selected");
    var exText = $("#TableNew").text();
    if (exText.trim() == '') {
      $("#TableNew").remove();
    } else {
      $("#TableNew").replaceWith(exText);
    }
  }

  function tableOptionsRemove(e) {
    $("td,th").removeClass("current-cell"); // Really inefficient, I'm sure.
    $("#table-options-flyout").remove();
    $("#toolbar-table-options").removeClass("selected");
    var exText = $("#TableNew").text();
    if (exText.trim() == '') {
      $("#TableNew").remove();
    } else {
      $("#TableNew").replaceWith(exText);
    }
  }

  function olistOptionsRemove(e) {
    $("#olist-options-flyout").remove();
    $("#toolbar-olist-options").removeClass("selected");
  }

  function mathIconEnter(mi,e){
    mi.addClass("hovered");
    mi.closest(".MathJax").addClass("to-remove");
    mi.closest(".MathJax").removeAttr("title");
  }
  function mathIconLeave(mi,e){
    mi.removeClass("hovered");
    mi.closest(".MathJax").removeClass("to-remove");
    mi.closest(".MathJax").attr("title","Click anywhere on the math to edit it");
  }
  $(".math-icon").live("mouseenter", function(e){
    mathIconEnter($(this),e);
  });
  $(".math-icon").live("mouseleave", function(e){
    mathIconLeave($(this),e);
  });

  function mathEnter(m,e) {
    $('.canvas-wrap').each(function(){
      $(this).children().children().children('.canvas-buddy, .canvas-buddy-2').hide();
      $(this).children().children().children().children().children('.canvas-buddy, .canvas-buddy-2').hide();
      $(this).children('.canvas').removeClass("canvas-hovered");
    });
    m.addClass("hovered");
    if(!m.find(".math-editor").length) {
      m.attr("title","Click anywhere on the math to edit it");
//      m.append('<span class="math-icon" id="math-icon-edit"><span class="math-icon-message">Click anywhere on the math to edit it</span></span>');
//      m.append('<div class="math-icon" id="math-icon-clear"><span class="math-icon-message"><span class="math-icon-message-close">X</span> Remove math formatting (revert to plain text)</span></div>');
//      mic = '<div class="math-icon" id="math-icon-clear"><span class="math-icon-message"><span class="math-icon-message-close">X</span> Remove math formatting (revert to plain text)</span></div>';
      mic = '<div class="math-icon" id="math-icon-clear"><span class="math-icon-message">Delete math</span></div>';
      m.append(mic);
//      $(".math-icon").show(1000);
      setTimeout(function(){$(".math-icon").show();}, 1000);
    }
    e.stopPropagation();
  }

  function mathLeave(m,e) {
/*
    if(!m.find(".math-editor").length) {
      m.removeClass("selected");
    }
*/
    m.removeClass("hovered");
    m.removeAttr("title");
    m.find('#math-icon-edit').remove();
    m.find('#math-icon-clear').remove();
    if ( !m.parents().closest(".active").length) {
      m.parent().closest('.canvas-wrap').each(function(){
        $(this).children().children().children('.canvas-buddy, .canvas-buddy-2').show();
        $(this).children().children().children().children().children('.canvas-buddy, .canvas-buddy-2').show();
        $(this).children('.canvas').addClass("canvas-hovered");
      });
    }
  }
  function buildMathEditor(m,e) {
    var ed = '<div class="math-editor" contenteditable="false">\
        <span id="math-editor-help" class="math-editor-help">\
          <a href="#asdfasdfasdf" title="Open a pane with information on how to use the math editor">See help</a>\
        </span>\
        <div class="math-source-wrap">\
          <div class="math-source" contenteditable="true"></div>\
          <div id="math-error" contentEditable="false">\
            <strong>LaTeX error:</strong> <br/>Please check your syntax and try again.\
          </div>\
        </div>\
        <div class="math-options">\
          This is:\
          <input type="radio" name="math-type" id="radio_ascii" value="ascii" checked="checked"> <label for="radio_ascii">ASCIIMath</label>\
          <input type="radio" name="math-type" id="radio_latex" value="latex"> <label for="radio_latex">LaTeX</label>\
          <span title="This will convert your math to plain text after clicking \'Done\'.">\
            <input type="radio" name="math-type" id="radio_plain" value="plain"> <label for="radio_plain" id="radio_plain_label">Plain text</label>\
          </span>\
          <span id="math-type-help" class="math-help" style="display: none"><a href="#asdfasdf" title="Open a pane with information on ASCIIMath and LaTeX">(?)</a></span>\
          <span id="cheat-sheet-activate">\
            <input type="checkbox" name="cheat-sheet-activator" id="cheat-sheet-activator">\
            <label for="cheat-sheet-activator">Show cheat sheet</label>\
          </span>\
        </div>\
        <div id="math-done">\
          <input class="math-done" type="button" value="Done"/>\
        </div>\
        <div class="math-help-text-wrap">\
          <div class="math-help-text" id="math-type">\
            <span class="math-help-text-close"><img src="content_files/remove-element-08.png"/></span>\
            ASCIIMath and LaTeX transform plain text into mathematics format.\
            <ul>\
              <li>\
                <strong>ASCIIMath</strong> is a simple input notation similar to that of a graphing calculator.\
                For example, <span style="font-family: courier new">x^(ab)</span> would display as \
                <span class="math-style">x<sup style="line-height: .5em; vertical-align: .3em;">ab</sup></span>.\
                <a href="http\:\/\/www1.chapman.edu\/\~jipsen\/asciimath.html" target="_blank" title="Opens in a new window/tab" class="external">Learn more.</a>\
              </li>\
              <li>\
                <strong>LaTeX</strong>, while similar to ASCIIMath, includes some more complex notation for advanced math.\
                <a href="http\:\/\/en.wikibooks.org/wiki/LaTeX/Mathematics" target="_blank" title="Opens in a new window/tab" class="external">Learn more.</a>\
              </li>\
            </ul>\
            Click the "<strong>Show cheat sheet</strong>" box to see examples of each.\
          </div>\
          <div class="math-help-text" id="math-editor-help-text">\
            <span class="math-help-text-close" title="Close this help"><img src="content_files/remove-element-08.png"/></span>\
            <strong style="display: block\; margin: .5em 0">Help using the math editor</strong>\
            <div style="margin: .5em 0">\
            To add math to your document, type math in the text field using either \
            <a href="#asd" id="math-type-help-2" style="display: none">ASCIIMath or LaTeX notation</a>\
            ASCIIMath or LaTeX notation\
.\
            The display math will be shown below in real time.  When you\'re done, click "Done" or click anywhere outside the blue box.\
            </div>\
            <ul>\
              <li>\
                <strong>ASCIIMath</strong> is a simple input notation similar to that of a graphing calculator.\
                For example, <span style="font-family: courier new">x^(ab)</span> would display as \
                <span class="math-style">x<sup style="line-height: .5em; vertical-align: .3em;">ab</sup></span>.\
                <a href="http\:\/\/www1.chapman.edu\/\~jipsen\/asciimath.html" target="_blank" title="Opens in a new window/tab" class="external">Learn more.</a>\
              </li>\
              <li>\
                <strong>LaTeX</strong>, while similar to ASCIIMath, includes some more complex notation for advanced math.\
                <a href="http\:\/\/en.wikibooks.org/wiki/LaTeX/Mathematics" target="_blank" title="Opens in a new window/tab" class="external">Learn more.</a>\
              </li>\
              <li>\
                <strong><a href="#asdf" id="cheat-sheet-activator-2">Show cheat sheet</a></strong>.  Use this to see common examples of notation and their respective display.\
              </li>\
            </ul>\
          </div>\
        </div>\
      </div>';
    return ed;
  }
  function mathClick(m,e) {

    $("[class*='-header']").die("mouseenter mouseleave"); // Turning hovers off (temporarily)
    $(".canvas-wrap").die("mouseenter mouseleave"); // Have to do this one separately from above, apparently
    $(".MathJax").die("mouseenter mouseleave");
    $("table caption").die("mouseenter mouseleave");

    cwLeave($(".canvas-wrap"),"special",e);

    if (m.find(".hint-text").length) {
      m.find(".hint-text").replaceWith("&nbsp\;");
      $(this).data("blank-equation",true);
    } else {
      $(this).data("blank-equation",false);
    }

    if(!m.find(".math-editor").length) {
      mathEditorRemove("");
      m.removeAttr("title");

      $('#math-icon-clear').remove();

      m.addClass("selected");
      $("#toolbar-math").addClass("selected");

      mec = buildMathEditor(m,e);
      m.prepend(mec);
      var mathtext = m.find(".ascii-notation").text();

      $('#math-icon-clear').remove();

      if (mathtext.length) {
        m.find(".math-source").append(mathtext);
      } else if ( m.find(".MathJaxText, .MathJaxText2").text().length ) {
        m.find(".math-source").append(m.find(".MathJaxText, .MathJaxText2").text());
      } else if ($(this).data("blank-equation") == true) {
        m.find(".math-source").append('<span class="math-source-hint-text">Enter your math notation here</span>');
      } else {
        m.find(".math-source").append("&nbsp\;");
      }

      $('#math-icon-clear').remove();

      newB = m.outerHeight() + 14; // 14 = approx. positive value of :after's "bottom" property
      newL = m.outerWidth() / 2 - parseInt($(".math-editor").css("width")) / 2 - 7; // 7 for mysterious good measure
      $(".math-editor").css("bottom", newB + "px");
      $(".math-editor").css("left", newL + "px");
      $(".math-source").css("width", $(".math-editor").outerWidth() - $("#math-editor-help").outerWidth() - 2 - 20 - 10  + "px");

      if ($(this).data("blank-equation") != true) {
        placeCaretAtEnd($(".math-source").get(0));
      }

      $('#math-icon-clear').remove();

    } else {
      placeCaretAtEnd($(".math-source").get(0));
    }
    if ( $("#cheat-sheet").css("display") != 'none' ) $("#cheat-sheet-activator").attr("checked",true);
    $("#cheat-sheet-wrap").slideUp("fast", function(e){
      $(this).show();
    });
    e.stopPropagation();
  }

  $(".math-source").live("click", function(e){
    $(this).find(".math-source-hint-text").replaceWith("&nbsp;");
  });

  $(".math-source").live("keyup", function(e){
    AMdisplay($(this),$(this).closest(".MathJax").find(".ascii-math"),true);
//    $(this).closest(".MathJax").find(".ascii-math").html($(this).text());
  });

/*
  $(".math-source").live("paste", function(e){
  });
*/

  var aol = '';

  function mathClickNew(aol,e) {
    var exText = getSelectionText();
    if (exText == '') {
      exText = '&nbsp\;';
//      pasteHtmlAtCaret('<span id="MathJaxNew" class="MathJax selected" contenteditable="false">' + exText + '</span>');
      pasteHtmlAtCaret('<span id="MathJaxNew" class="MathJax selected" contenteditable="false"><span class="ascii-notation" style="display: none;">' + exText + '</span><span class="ascii-math"></span></span>');

      $("[class*='-header']").die("mouseenter mouseleave"); // Turning hovers off (temporarily)
      $(".canvas-wrap").die("mouseenter mouseleave"); // Have to do this one separately from above, apparently
      $(".MathJax").die("mouseenter mouseleave");
      $("table caption").die("mouseenter mouseleave");
      cwLeave($(".canvas-wrap"),"special",e);
      $("#toolbar-math").addClass("selected");

      mec = buildMathEditor();
      
      var m = $("#MathJaxNew")
      m.prepend(mec)
      newB = m.outerHeight() + 15 + 14; // 14 = approx. positive value of :after's "bottom" property
      newL = m.outerWidth() / 2 - parseInt($(".math-editor").css("width")) / 2 - 7; // 7 for mysterious good measure
      $(".math-editor").css("bottom", newB + "px");
      $(".math-editor").css("left", newL + "px");
      // Not sure following condition is necessary ... might be copy/paste issue only
      if (exText == '&nbsp;') {
        m.find(".math-source").append('<span class="math-source-hint-text">Enter your math notation here</span>');
      } else {
        m.find(".math-source").append(exText);
        placeCaretAtEnd($(".math-source").get(0));
      }
      if ( $("#cheat-sheet").css("display") != 'none' ) $("#cheat-sheet-activator").attr("checked",true);
      $("#cheat-sheet-wrap").slideUp("fast", function(){
        $(this).show();
      });

    } else {
//      pasteHtmlAtCaret('<span id="MathJaxNew" class="MathJax" contenteditable="false"><span class="MathJaxText">' + exText + '</span></span>');
      pasteHtmlAtCaret('<span id="MathJaxNew" class="MathJax" contenteditable="false"><span class="ascii-notation" style="display: none;">' + exText + '</span><span class="ascii-math"></span></span>');
/*
      var mis = '';
      for (var i=0; i < exText.length; i++) {
        mis += '<mi>' + exText.charAt(i) + '</mi>';
      }
      $("#MathJaxNew").find(".ascii-math").append('<math><mstyle displaystyle="true" fontfamily="serif">' + mis + '</mstyle></math>');
*/
      var mathml = AMparseMath2(exText);
      $("#MathJaxNew").find(".ascii-math").append(mathml);
      $("#toolbar-math").removeClass("selected");
      $("#MathJaxNew").removeAttr("id").effect("highlight", { color: "#C5DAE9" }, 1500);
    }

    e.stopPropagation();
    e.preventDefault();

  }

  function pasteHtmlAtCaret(html) { // From Tim Down at http://stackoverflow.com/questions/6690752/insert-html-at-cursor-in-a-contenteditable-div
    var sel, range;
    if (window.getSelection) {
        // IE9 and non-IE
        sel = window.getSelection();
        if (sel.getRangeAt && sel.rangeCount) {
            range = sel.getRangeAt(0);
            range.deleteContents();

            // Range.createContextualFragment() would be useful here but is
            // non-standard and not supported in all browsers (IE9, for one)
            var el = document.createElement("div");
            el.innerHTML = html;
            var frag = document.createDocumentFragment(), node, lastNode;
            while ( (node = el.firstChild) ) {
                lastNode = frag.appendChild(node);
            }
            range.insertNode(frag);

            // Preserve the selection
            if (lastNode) {
                range = range.cloneRange();
                range.setStartAfter(lastNode);
                range.collapse(true);
                sel.removeAllRanges();
                sel.addRange(range);
            }
        }
    } else if (document.selection && document.selection.type != "Control") {
        // IE < 9
        document.selection.createRange().pasteHTML(html);
    }
  }


  function mathEditorRemove(override) {
//    if (!$("#MathJaxNew").length || override.length) { // Hack because propagation doesn't seem to be stopping in mathClickNew2

      $(".MathJax").removeClass("selected");
      $(".MathJax").removeClass("hovered");
      if ($("#cheat-sheet-wrap").css("display") != 'none') {
        $("#cheat-sheet-wrap").slideDown("fast", function(e){
          $(this).hide();
        });
      }
      var mj = $(".math-editor").closest(".MathJax");
      var ms = $(".math-editor").find(".math-source").text();
      
      if ((override.length || $("#radio_regular").is(":checked")) && !$(".math-source-hint-text").length) {
        if (ms == "&nbsp\;") {
          mj.replaceWith("");
        } else {
          mj.replaceWith(ms);
        }
      } else {
        if (!mj.find(".ascii-notation").length) { // This just not to mess up the nice examples in the mock-up.
//        if (!ms.trim().length || $("#MathJaxNew").find(".math-source-hint-text").length) {
          if (!ms.trim().length || mj.find(".math-source-hint-text").length) {
            if (mj.parent(".equation-contents").length || mj.parent().parent(".equation-contents").length) {
              mj.html('<div class="hint-text">Enter your math notation here</div>');
            } else {
              mj.remove();
            }
          } else {
            mj.html('<span class="MathJaxText">' + ms + '</span>');
          }
        }
      }
      $(".math-editor").remove();
      $("#toolbar-math").removeClass("selected");
      $(".MathJax").each(function(){
        if ($(this).attr("id") == 'MathJaxNew') {
          $(this).removeAttr("id");
        }
      });
    }
//  }
  $(".MathJax").live("mouseenter", function(e){
    mathEnter($(this),e);
  });
  $(".MathJax").live("mouseleave", function(e){
    mathLeave($(this),e);
  });
  $(".MathJax:not(.selected)").live("click", function(e){
    mathClick($(this),e);
  });
  $(".math-editor").live("click", function(e){
//  e.stopPropagation();
    meClick($(this),e);
  });
  function meClick(me,e) {
    e.stopPropagation();
  };
  
  $("#cheat-sheet-wrap, .MathJax.selected").live("click", function(e){
    meClick($(this),e);
  });

  $("#cheat-sheet-close").live("click", function(e){
    $("#cheat-sheet").slideUp("fast", function(){
      $(this).hide();
    });
    $("#cheat-sheet-open").show("slow");
    $("#cheat-sheet-activator").attr("checked",false);
  });
  $("#cheat-sheet-open").live("click", function(e){
    $(this).hide();
    $("#cheat-sheet").slideDown("fast", function(){
      $(this).show();
    });
    $("#cheat-sheet-activator").attr("checked",true);
  });

  $("#cheat-sheet-activator").live("click", function(e){
    if ($(this).is(":checked")) {
      $("#cheat-sheet-open").hide();
      $("#cheat-sheet").slideDown("fast");
    } else {
      $("#cheat-sheet").slideUp("fast");
      $("#cheat-sheet-open").show("slow");
    }
  });
  $("#cheat-sheet-activator-2").live("click", function(e){
    var csa = $("#cheat-sheet-activator");
    if (csa.is(":checked")) {
      csa.attr("checked",false);
      $("#cheat-sheet").slideUp("fast", function(){
        $(this).hide();
        $("#cheat-sheet-open").show("slow");
      });
    } else {
      csa.attr("checked",true);
      $("#cheat-sheet-open").hide();
      $("#cheat-sheet").slideDown("fast", function(){
        $(this).show();
      });
    }
    return false;
  });

/*
  $("#math-advanced-activator").live("click", function(e){
    if ($(this).is(":checked")) {
      $("#math-advanced").slideDown("fast");
    } else {
      $("#math-advanced").slideUp("fast");
    }
  });
*/

  $("#radio_regular").live("click", function(e){
    if ($(this).is(":checked")) {
      $(this).closest(".MathJax").find(".MathJaxText").removeClass("MathJaxText").addClass("MathJaxText2");
    } else {
      $(this).closest(".MathJax").find(".MathJaxText2").removeClass("MathJaxText2").addClass("MathJaxText");
    }
  });


/*
  $("#math-icon-clear").live("click", function(e){
      var mj = $(this).closest(".MathJax");
//      var ms = mj.contents(":not(.math-icon)").text();
      var ms = '&nbsp\;';
      if (mj.find(".ascii-notation").text().length) {
        ms = mj.find(".ascii-notation").text();
      } else if ( mj.find(".MathJaxText, .MathJaxText2").text().length ) {
        ms = mj.find(".MathJaxText, .MathJaxText2").text();
      }
      mj.replaceWith(ms);
      return false;
  });
*/
  $("#math-icon-clear").live("click", function(e){
    $(this).closest(".MathJax").slideUp("fast", function(){
      $(this).remove();
      mathEditorRemove("");
    });
  });

  $("input[name=math-type]").live("click", function(e){
    var m = $(this).closest(".MathJax");
    if ($(this).val() == 'latex') {
      m.removeClass("unmathified");
      m.addClass("errored");
      m.find(".ascii-math").hide();
      m.find(".ascii-notation").show();
      $("#math-error").css("width",m.find(".math-source").outerWidth() - 28 + "px"); // 28 = 24 total padding + 2 total border + 2 to appear inset
      $("#math-error").slideDown(100, function(e){
        $(this).show();
      });
    } else if ($(this).val() == 'plain') {
      m.removeClass("errored");
      m.addClass("unmathified");
      m.find(".ascii-math").hide();
      m.find(".ascii-notation").show();
      $("#math-error").slideUp(100, function(e){
        $(this).hide();
      });
    } else {
      m.removeClass("errored unmathified");
      m.find(".ascii-math").show();
      m.find(".ascii-notation").hide();
      $("#math-error").slideUp(100, function(e){
        $(this).hide();
      });
    }
  });

  $("input[name=cs-math-type]").live("click", function(e){
    var cs = $(this).closest("#cheat-sheet");
    if ($(this).val() == 'cs_latex') {
      cs.find("#cheat-sheet-ascii").hide();
      cs.find("#cheat-sheet-latex").show();
    } else {
      cs.find("#cheat-sheet-ascii").show();
      cs.find("#cheat-sheet-latex").hide();
    }
  });

  $("input[name=img-perms]").live("click", function(e){
    $("#img-perms-required").removeClass("warning");
      if (this.id == 'ip-reuse') {
//      $("#reuse-info").show();
        $("#reuse-info input, #reuse-info select").removeAttr("disabled").removeClass("disabled");
     } else {
//     $("#reuse-info").hide();
        $("#reuse-info input, #reuse-info select").attr("disabled","disabled").addClass("disabled");
     }
     $(".image-forward").removeClass("disabled");
  });

  $("html, .math-editor-close, .math-done").live("click", function(e){
      semanticHelpClose(e);
      resetTableContextMenu();
/*
    if ($(this).hasClass("math-editor-close")) {
      mathEditorRemove("override");
    } else {
*/
      mathEditorRemove("");
      $(".link, .cnxn").find(".link-options").remove();
//      removeLabelList();
/*
    }
*/
    tableEditorRemove(e);
    // Turn hovers back on ...
    $(".canvas-wrap").live("mouseenter", function(e){
      cwEnter($(this),e)
    });
    $(".canvas-wrap").live("mouseleave", function(e){
      cwLeave($(this),"",e)
    });
/*
    $("[class*='-header']").live("mouseenter", function(e){
      headerEnter($(this),e);
    });
    $("[class*='-header']").live("mouseleave", function(e){
      headerLeave($(this),e);
    });
*/
    $(".MathJax").live("mouseenter", function(e){
      mathEnter($(this),e);
    });
    $(".MathJax").live("mouseleave", function(e){
      mathLeave($(this),e);
    });
/*
    $("table caption").live("mouseenter", function(e){
      headerEnter($(this),e);
    });
    $("table caption").live("mouseleave", function(e){
      tableHeaderLeave($(this),tableTitleHintText,tableCaptionHintText,e);
    });
*/

//    $(".media-block").removeClass("selected");

  });

  function resetTableContextMenu() {
    $("#table-context-menu").hide();
    $("#TableNew").remove();
    $(".current-cell").removeClass("current-cell");
    $(".table-to-remove").removeClass("table-to-remove");
    $(".add-row-before").removeClass("add-row-before");
    $(".add-row-after").removeClass("add-row-after");
    $(".add-column-before").removeClass("add-column-before");
    $(".add-column-after").removeClass("add-column-after");
  }

  function placeCaretAtEnd(el) { // From Tim Down at http://stackoverflow.com/questions/4233265/contenteditable-set-caret-at-the-end-of-the-text-cross-browser
    el.focus();
    if (typeof window.getSelection != "undefined"
            && typeof document.createRange != "undefined") {
        var range = document.createRange();
        range.selectNodeContents(el);
        range.collapse(false);
        var sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(range);
    } else if (typeof document.body.createTextRange != "undefined") {
        var textRange = document.body.createTextRange();
        textRange.moveToElementText(el);
        textRange.collapse(false);
        textRange.select();
    }
  }

/*
  $(".toolbar-function").not(".disabled").find(".toolbar-icon").hover(function(e){
      $(this).closest(".toolbar-function").addClass("hovered");
  }, function(e){
      $(this).closest(".toolbar-function").removeClass("hovered");
  });
  $(".table-add-row-before:not('ul.disabled li')").live("mouseenter", function(e){
*/
  $(".toolbar-function:not('.disabled') .toolbar-icon").live("mouseenter", function(e){
      $(this).closest(".toolbar-function").addClass("hovered");
  });
  $(".toolbar-function:not('.disabled') .toolbar-icon").live("mouseleave", function(e){
      $(this).closest(".toolbar-function").removeClass("hovered");
  });


  function selectIcon(fn,aol,e) {
//    $(".toolbar-dropdown.selected .dropdown-toggle").click();
   if(!fn.hasClass("disabled")) {
    fn.addClass("selected");
    if (fn.attr("id") == "toolbar-table") {
      var exText = newTablePlaceHolder(e);
      activateTableTemp();
      fn.append(tableflyout);
      $("#table-flyout").data("exText", exText);
    } else if (fn.attr("id") == "toolbar-table-options") {
      var exText = newTablePlaceHolder(e);
      fn.append(tableoptionsflyout);
      // If the cursor is in a table, enable the add/delete rows/columns options
      if ( $("#TableNew").closest(".table td, .table th").length ) {
        $(".menu-list").removeClass("disabled");
//      $("#table-flyout-new").addClass("disabled");
        $("#TableNew").closest("td,th").addClass("current-cell");
      }
    } else if (fn.attr("id") == "toolbar-olist-options") {
      fn.append(olistoptionsflyout);
    } else if (fn.attr("id") == "toolbar-math") {
      mathClickNew(aol,e);
    } else if (fn.attr("id") == "toolbar-image") {
      var imgPH = newImagePlaceHolder(e);
      $("#image-options").data('div',$("#ImageNew")).data('e',e).dialog("open");
    } else if (fn.attr("id") == "toolbar-link") {
      newLinkPlaceHolder(e);
/*
      var linkPH = newLinkPlaceHolder(e);
      $("#link-options").data('e',e).dialog("open");
*/
    }
   }
   return false;
  }
  function unSelectIcon(fn) {
    fn.removeClass("selected");
    if (fn.attr("id") == "toolbar-table") {
/*
      disActivateTableTemp();
*/
      tableEditorRemove();
    } else if (fn.attr("id") == "toolbar-table-options") {
      tableOptionsRemove();
    } else if (fn.attr("id") == "toolbar-olist-options") {
      olistOptionsRemove();
    } else if (fn.attr("id") == "toolbar-math") {
      mathEditorRemove("");
    }
    return false;
  }

  function newTablePlaceHolder(e) {
    var exText = getSelectionText();
//    if (exText == '') exText = "&nbsp\;";
//    if (exText == "&nbsp\;") {
    if (exText == "&nbsp\;" || exText == '') {
      pasteHtmlAtCaret('<span id="TableNew" class="table-temp-empty">' + exText + '</span>');
    } else {
      pasteHtmlAtCaret('<span id="TableNew" class="table-temp-text">' + exText + '</span>');
    }
    return exText;
    e.stopPropagation();
  }

  function activateTableTemp() {
    if ($("#TableNew").closest("#canvas").length) {
      $("#TableNew").addClass("activated");
    }
  }
  function disActivateTableTemp() {
    $("#TableNew").removeClass("activated");
  }

  function newImagePlaceHolder(e) {
    var imgPH = getSelectionText();
    pasteHtmlAtCaret('<span id="ImageNew" class="image-temp">' + imgPH + '</span>');
    return imgPH;
    e.stopPropagation();
  }

  function newLinkPlaceHolder(e) {
    var linkPHtext = getSelectionText();
    var linkPHparent = $(getSelectionContainerElement());
    if (linkPHparent.closest(".link").length || linkPHparent.closest(".cnxn").length) {
      // If already on a link, edit the whole thing (identified by .LinkNew class, which will be removed after the dialog has closed)
      linkPHparent.addClass("LinkNew");
    } else {
      pasteHtmlAtCaret('<span id="LinkNew" class="image-temp-empty">' + linkPHtext + '</span>');
      // If not already on a link, surround the selected text (or non-text) with a #LinkNew (this ID will be removed after the dialog has closed)
    }
    var linkPH = $(".LinkNew, #LinkNew");
    $("#link-options").data("link",linkPH).data('e',e).dialog("open");
    e.stopPropagation();
  }

  var tableflyout = '\
    <div class="icon-flyout" id="table-flyout">\
            <div class="flyout-options">\
              <input type="checkbox" id="include-row-header" checked="checked"> <label for="include-row-header">Include header row</label>\
            </div>\
            <div class="flyout-core">\
              <table>\
                <tbody>\
                  <tr>\
                    <td class="header">&nbsp\;</td>\
                    <td class="header">&nbsp\;</td>\
                    <td class="header">&nbsp\;</td>\
                    <td class="header">&nbsp\;</td>\
                    <td class="header">&nbsp\;</td>\
                    <td class="header">&nbsp\;</td>\
                  </tr>\
                  <tr>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                  </tr>\
                  <tr>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                  </tr>\
                  <tr>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                  </tr>\
                  <tr>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                  </tr>\
                  <tr>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                  </tr>\
                </tbody>\
              </table>\
            </div>\
            <div id="table-dimensions"/>\
    </div>\
  ';

  var tableflyoutOLD = '\
    <div class="icon-flyout" id="table-flyout">\
      <ul class="menu-list" id="table-flyout-new">\
        <li>\
          <span class="list-text">Add new table</span>\
          <div id="table-flyout-flyout">\
            <div class="flyout-options">\
              <input type="checkbox" id="include-row-header" checked="checked"> <label for="include-row-header">Include header row</label>\
            </div>\
            <div class="flyout-core">\
              <table>\
                <tbody>\
                  <tr>\
                    <td class="header">&nbsp\;</td>\
                    <td class="header">&nbsp\;</td>\
                    <td class="header">&nbsp\;</td>\
                    <td class="header">&nbsp\;</td>\
                    <td class="header">&nbsp\;</td>\
                    <td class="header">&nbsp\;</td>\
                  </tr>\
                  <tr>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                  </tr>\
                  <tr>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                  </tr>\
                  <tr>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                  </tr>\
                  <tr>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                  </tr>\
                  <tr>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                    <td>&nbsp\;</td>\
                  </tr>\
                </tbody>\
              </table>\
            </div>\
            <div id="table-dimensions"/>\
          </div>\
        </li>\
      </ul>\
      <ul class="menu-list disabled" id="table-flyout-insert">\
        <li class="table-add-row-before">Add new row before</li>\
        <li class="table-add-row-after">Add new row after</li>\
        <li class="table-add-column-before">Add new column before</li>\
        <li class="table-add-column-after">Add new column after</li>\
      </ul>\
      <ul class="menu-list disabled" id="table-flyout-delete">\
        <li class="table-delete-row">Delete row</li>\
        <li class="table-delete-column">Delete column</li>\
      </ul>\
      <ul class="menu-list disabled" id="table-flyout-options">\
        <li class="table-options-activate">Table options ...</li>\
      </ul>\
    </div>\
  ';

  var tableoptionsflyout = '\
    <div class="icon-flyout icon-flyout-dd" id="table-options-flyout">\
      <ul class="menu-list disabled" id="table-flyout-insert">\
        <li class="table-add-row-before">Add new row before</li>\
        <li class="table-add-row-after">Add new row after</li>\
        <li class="table-add-column-before">Add new column before</li>\
        <li class="table-add-column-after">Add new column after</li>\
      </ul>\
      <ul class="menu-list disabled" id="table-flyout-delete">\
        <li class="table-delete-row">Delete row</li>\
        <li class="table-delete-column">Delete column</li>\
      </ul>\
      <ul class="menu-list disabled" id="table-flyout-options">\
        <li class="table-options-activate">Table options ...</li>\
      </ul>\
    </div>\
  ';

  var olistoptionsflyout = '\
    <div class="icon-flyout icon-flyout-dd" id="olist-options-flyout">\
      <ul class="ordered-list-type menu-list" style="border-top-width: 0;">\
        <li class="header">Choose numbering style:</li>\
        <li>\
          <span class="action listarabic"><span class="ordered-list-type-bullet">1. </span><span class="ordered-list-type-label">Default</span></span>\
        </li>\
        <li>\
          <span class="action listupperalpha"><span class="ordered-list-type-bullet">A. </span><span class="ordered-list-type-label">Upper Alpha</span></span>\
        </li>\
        <li>\
          <span class="action listloweralpha"><span class="ordered-list-type-bullet">a. </span><span class="ordered-list-type-label">Lower Alpha</span></span>\
        </li>\
        <li>\
          <span class="action listupperroman"><span class="ordered-list-type-bullet">I. </span><span class="ordered-list-type-label">Upper Roman</span></span>\
        </li>\
        <li>\
          <span class="action listlowerroman"><span class="ordered-list-type-bullet">i. </span><span class="ordered-list-type-label">Lower Roman</span></span>\
        </li>\
        <li>\
          <span href="#" class="action listlowerroman"><span class="ordered-list-type-bullet">Step 1. </span><span class="ordered-list-type-label">Step-wise</span></span>\
        </li>\
      </ul>\
    </div>\
  ';

/*
  function showTableNew(ul,e){
    $("#table-flyout-flyout").show();
    ul.children("li").addClass("hovered");
  }
  function hideTableNew(ul,e){
    $("#table-flyout-flyout").hide();
    ul.children("li").removeClass("hovered");
  }
  $("#table-flyout-new li").hoverIntent({
    over: function(e){
      showTableNew($(this),e);
    }, 
    out: function(e){
      hideTableNew($(this),e);
    },
    interval: 300,
    timeout: 300,
  });
  $("#table-flyout-new:not('.disabled') li").livequery(function(){ // Using livequery since hoverIntent won't work on newly-existing objects :-( but thanks Brandon Aaron for making it :-)
    $(this).hoverIntent({
      over: function(e){
        showTableNew($(this),e);
      }, 
      out: function(e){
        hideTableNew($(this),e);
      },
      interval: 150,
      timeout: 1000,
    });
  });
*/


  $(".table-add-row-before:not('ul.disabled li')").live("mouseenter", function(e){
    $("#TableNew").closest("tr").addClass("add-row-before");
  });
  $(".table-add-row-before:not('ul.disabled li')").live("mouseleave", function(e){
    $("#TableNew").closest("tr").removeClass("add-row-before");
  });
  $(".table-add-row-after:not('ul.disabled li')").live("mouseenter", function(e){
    $("#TableNew").closest("tr").addClass("add-row-after");
  });
  $(".table-add-row-after:not('ul.disabled li')").live("mouseleave", function(e){
    $("#TableNew").closest("tr").removeClass("add-row-after");
  });
  $(".table-add-column-before:not('ul.disabled li')").live("mouseenter", function(e){
    var colI = $("#TableNew").closest("td,th").index() + 1;
    $("#TableNew").closest("table").find("tr").find("td:nth-child(" + colI + "),th:nth-child(" + colI + ")").addClass("add-column-before");
  });
  $(".table-add-column-before:not('ul.disabled li')").live("mouseleave", function(e){
    $("#TableNew").closest("table").find("td,th").removeClass("add-column-before");
  });
  $(".table-add-column-after:not('ul.disabled li')").live("mouseenter", function(e){
    var colI = $("#TableNew").closest("td,th").index() + 1;
    $("#TableNew").closest("table").find("tr").find("td:nth-child(" + colI + "),th:nth-child(" + colI + ")").addClass("add-column-after");
  });
  $(".table-add-column-after:not('ul.disabled li')").live("mouseleave", function(e){
    $("#TableNew").closest("table").find("td,th").removeClass("add-column-after");
  });
  $(".table-delete-row:not('ul.disabled li')").live("mouseenter",function(e){
    $("#TableNew").closest("tr").addClass("table-to-remove");
  });
  $(".table-delete-row:not('ul.disabled li')").live("mouseleave",function(e){
    $("#TableNew").closest("tr").removeClass("table-to-remove");
  });
  $(".table-delete-column:not('ul.disabled li')").live("mouseenter",function(e){
    var colI = $("#TableNew").closest("td,th").index() + 1;
    $("#TableNew").closest("table").find("tr").find("td:nth-child(" + colI + "),th:nth-child(" + colI + ")").addClass("table-to-remove");
  });
  $(".table-delete-column:not('ul.disabled li')").live("mouseleave",function(e){
    $("#TableNew").closest("table").find("td,th").removeClass("table-to-remove");
  });
  $(".table-options-activate:not('ul.disabled li')").live("click",function(e){
    tableOptions($(".current-cell").closest(".canvas"));
    unSelectIcon($("#toolbar-table-options"),e)
  });



  function cwEnter(cw,e) {

      $('.canvas-wrap').each(function(){
/*
        cwLeave($(this),"",e);
*/
        $(this).children().children().children('.canvas-buddy, .canvas-buddy-2').hide();
        $(this).children().children().children().children().children('.canvas-buddy, .canvas-buddy-2').hide();
        $(this).children('.canvas').removeClass("canvas-hovered");
//        headerLeave($(this).find("[class*='-header']").first(),desctitle,e);
        $(".header-hovered").removeClass("header-hovered");
      });
//    cw.children('.canvas').addClass("canvas-hovered").removeClass("canvas-unhovered");
      cw.children('.canvas').addClass("canvas-hovered");
      cw.find("[class*='-header']").first().addClass("header-hovered");
      cw.children().children().children('.canvas-buddy, .canvas-buddy-2').show();
      cw.children().children().children().children().children('.canvas-buddy, .canvas-buddy-2').show();
      headerEnter(cw.find("[class*='-header']").first());
      if (cw.children('.exercise').length) {
        cw.children('.exercise').find(".add-solution-2").slideDown("fast");
      }
      if (cw.children('.question').length) {
        cw.children('.question').find(".add-answer").slideDown("fast");
      }
      if (cw.children('.definition').length) {
        cw.children('.definition').find(".glossary-options").slideDown("fast");
      }
      if (cw.children('.table').length) {
        headerEnter(cw.children('.table').find("caption"),e);
      }
      if (cw.children('.solution').length) {
        if (cw.closest('.exercise').find('.add-solution-2').is(':hidden')) {
          cw.closest('.exercise').find(".add-solution-2").slideDown("fast");
        }
      }
      if (cw.children('.answer').length) {
        if (cw.closest('.question').find('.add-answer').is(':hidden')) {
          cw.closest('.question').find(".add-answer").slideDown("fast");
        }
      }
/*
      if (cw.children('.meaning').length) {
        if (cw.closest('.definition').find('.add-meaning').is(':hidden')) {
          cw.closest('.definition').find(".add-meaning").slideDown("fast");
        }
      }
*/
      e.stopPropagation();
  }

  function cwLeave(cw,special,e) {

      $(".edit-element-menu").remove();

      cw.children().children().children('.canvas-buddy, .canvas-buddy-2').hide();
      cw.children().children().children().children().children('.canvas-buddy, .canvas-buddy-2').hide();
//    cw.children('.canvas').removeClass("canvas-hovered").addClass("canvas-unhovered");
      cw.children('.canvas').removeClass("canvas-hovered");
      cw.find("[class*='-header']").removeClass("header-hovered");
/*
      if (!cw.children('.definition').length) {
        headerLeave(cw.find("[class*='-header']").first(),desctitle,e);
      }
*/
      if (cw.children('.exercise').length) {
        cw.children('.exercise').find(".add-solution-2").slideUp("fast");
      }
      if (cw.children('.question').length) {
        cw.children('.question').find(".add-answer").slideUp("fast");
      }
      if (cw.children('.definition').length) {
        cw.children('.definition').find(".glossary-options").slideUp("fast");
      }
//alert (e.relatedTarget.parentNode.className);

      if (cw.children('.figure').length) {
        cw.children('.figure').find('.media-title').removeClass("hovered");
//        cw.children('.figure').find('.media-title-close').hide();
        cw.children('.figure').find('.media-caption').removeClass("hovered");
//        cw.children('.figure').find('.media-caption-close').hide();
      }
      if (cw.children('.table').length) {
        tableHeaderLeave(cw.children('.table').find("caption"),tableTitleHintText,tableCaptionHintText);
      }
      if ( !cw.parents().closest(".active").length && special != "special") {
        cw.parent().closest('.canvas-wrap').each(function(){
          $(this).children().children().children('.canvas-buddy, .canvas-buddy-2').show();
          $(this).children().children().children().children().children('.canvas-buddy, .canvas-buddy-2').show();
          $(this).children('.canvas').addClass("canvas-hovered");
          $(this).find("[class*='-header']").first().addClass("header-hovered");
//        headerEnter($(this).find("[class*='-header']").first());
        });
      }
  }

  $(".canvas-wrap").live("mouseenter", function(e){
    cwEnter($(this),e);
  });
  $(".canvas-wrap").live("mouseleave", function(e){
    cwLeave($(this),"",e);
  });



  function getSelectionText() { // from Tim Down at http://stackoverflow.com/questions/5379120/jquery-get-the-highlighted-text
    var text = "";
    if (window.getSelection) {
        text = window.getSelection().toString();
    } else if (document.selection && document.selection.type != "Control") {
        text = document.selection.createRange().text;
    }
    return text;
  }

  function getSelectionContainerElement() { // From Tim Down at http://stackoverflow.com/questions/1563427/how-do-i-find-out-the-dom-node-at-cursor-in-a-browsers-editable-content-window/1563492#1563492
    var range, sel, container;
    if (document.selection && document.selection.createRange) {
        // IE case
        range = document.selection.createRange();
        return range.parentElement();
    } else if (window.getSelection) {
        sel = window.getSelection();
        if (sel.getRangeAt) {
            if (sel.rangeCount > 0) {
                range = sel.getRangeAt(0);
            }
        } else {
            // Old WebKit selection object has no getRangeAt, so
            // create a range from other selection properties
            range = document.createRange();
            range.setStart(sel.anchorNode, sel.anchorOffset);
            range.setEnd(sel.focusNode, sel.focusOffset);

            // Handle the case when the selection was selected backwards (from the end to the start in the document)
            if (range.collapsed !== sel.isCollapsed) {
                range.setStart(sel.focusNode, sel.focusOffset);
                range.setEnd(sel.anchorNode, sel.anchorOffset);
            }
        }

        if (range) {
           container = range.commonAncestorContainer;

           // Check if the container is a text node and return its parent if so
           return container.nodeType === 3 ? container.parentNode : container;
        }   
    }
  }

  var desctitle = '<span class="hint-text">Add a title (optional)</span>';

  function headerEnter(h,e) {
    h.find(".title").show();
    h.find(".table-caption").show(); // Might not be there for elements other than table
  }
  function headerLeave(h,desctitle,e) {
//console.log("asdf");
    var title = h.find(".title,.term");
/*
    if (h.find(".hint-text").length) {
      title.hide();
    } else if (title.text().trim() == '') {
      title.hide(100, function(){
        $(this).empty();
        $(this).prepend(desctitle);
        $(this).blur();
      });
*/
    if (title.text().trim() == '') {
//console.log(desctitle);
      title.prepend(desctitle);
      if (title.closest(".definition-header").length) {
        title.find(".hint-text").html('Enter key term to be defined here (required) <img src="content_files/warning-01.png" class="term-required" title="You are required to have a key term"/>');
      }
      title.blur();
    }
    e.stopPropagation();
  }
/*
  function titleClick(h,e) {
    h.find(".title .hint-text").remove();
    h.find(".title").focus();
  }
*/
  function headerClick(h,e) {
//console.log(h.find(".hint-text").length);
    h.find(".hint-text").hide(100, function(e){
      $(this).replaceWith("&nbsp\;");
    });
    h.find(".title").focus();
    return false;
  }
/*
  function titleFocus(t,e) {
    var label = t.parent().find(".cnx_label").text().trim();
    if (label.substr(label.length - 1) != ":") {
      t.parent().find(".cnx_label").text(label + ":");
    }
  }
  function titleBlur(t,desctitle,e) {
    if (t.text().trim() == '') {
      t.prepend(desctitle);
      t.hide();
    }
  }
*/
  $("[class*='-header']").live("click", function(e){
    headerClick($(this),e);
  });
  $("[class*='-header']").live("mouseleave", function(e){
    headerLeave($(this),desctitle,e);
  });
/*
  $(".title").live("click", function(e){
    titleClick($(this),e);
  });
  $("strong.title").live("blur", function(e){
    titleBlur($(this),desctitle,e);
  });
*/


  var tableTitleHintText = '<span class="hint-text">&nbsp\;Add a title (optional)</span>';
  var tableCaptionHintText = '<span class="hint-text table-caption-hint-text">&nbsp\;Add a table caption (optional)</span>';
/*
  function tableTitleClick(tt) {
    var label = tt.parent().find(".cnx_label").text().trim();
    tt.children(".hint-text").remove();
    if (label.substr(label.length - 1) != ":") {
      tt.parent().find(".cnx_label").text(label + ": ");
    }
    tt.focus();
  }
*/
  function tableCaptionClick(tc) {
    var label = tc.parent().find(".cnx_label").text().trim();
    tc.find(".hint-text").remove();
    if (label.substr(label.length - 1) != ":") {
      tc.parent().find(".cnx_label").text(label + ":");
    }
    tc.focus();
  }
  function tableHeaderLeave(h,desctitle,desccaption) {
    var caption = h.find(".table-caption");
    var label = h.find(".cnx_label");
    var labelt = label.text().trim();
    if (caption.find(".hint-text").length) {
      caption.hide();
    }
    if (caption.text().trim() == '') {
      caption.hide();
      caption.prepend(desccaption);
    }
    caption.blur();
    if (caption.find(".hint-text").length && labelt.substr(labelt.length - 1) == ":") {
        label.text(labelt.substring(0, labelt.length - 1));
    }
  }
/*
  $("table caption").live("mouseenter", function(e){
    headerEnter($(this),e);
  });
  $("table caption").live("mouseleave", function(e){
    tableHeaderLeave($(this),tableTitleHintText,tableCaptionHintText,e);
  });
*/
/*
  $("table>caption>.title").live("click", function(e){
    tableTitleClick($(this),e);
  });
*/
  $("table>caption>.table-caption").live("click", function(e){
    tableCaptionClick($(this),e);
  });
/*
  $("table>caption>strong.title").live("blur", function(e){
    titleBlur($(this),tableTitleHintText,e);
  });
*/
  $("table>caption>.table-caption").live("blur", function(e){
//    titleBlur($(this),tableCaptionHintText,e);
  });



  function cbEnter(cb) {
    cb.css("background-color","#666");
    cb.parent().css("background-color","#f2f2f2");
    cb.find("img").attr("src","content_files/drag-element-20.png");
    cb.parent().children(".canvas-buddy-2").hide();
//    cb.closest(".canvas").addClass("canvas-hovered");
  }
  function cbLeave(cb) {
    cb.css("background-color","transparent");
    cb.parent().css("background-color","transparent");
    cb.find("img").attr("src","content_files/drag-element-19.png");
    cb.parent().children(".canvas-buddy-2").show();
//    cb.closest(".canvas").removeClass("canvas-hovered");
  }
  $(".canvas-buddy").live("mouseenter", function(){
    cbEnter($(this));
  });
  $(".canvas-buddy").live("mouseleave", function(){
    cbLeave($(this));
  });


  function reEnter(re) {
    re.parent().css("border-left-width","0");
    re.parent().parent().children(".canvas-buddy").hide();
    re.parent().find(".edit-element").hide();
    re.parent().parent().parent().css("background-color","#f9f9f9");
    re.parent().parent().addClass("to-remove");
    re.find("img").attr("src","content_files/remove-element-07.png");
//    re.closest(".canvas").addClass("canvas-hovered");
  }
  function reLeave(re) {
    re.parent().css("border-left-width","1px");
    re.parent().parent().children(".canvas-buddy").show();
    re.parent().find(".edit-element").show();
    re.parent().parent().parent().css("background-color","transparent");
    re.parent().parent().removeClass("to-remove");
    re.find("img").attr("src","content_files/remove-element-06.png");
//    re.closest(".canvas").removeClass("canvas-hovered");
  }
  $(".remove-element").live("mouseenter", function(){
    reEnter($(this));
  });
  $(".remove-element").live("mouseleave", function(){
    reLeave($(this));
  });


  function removeElement(el,e) {
/*
    var c = confirm('Are you sure you want to remove this element?');
    if (c == true) {
      $(this).closest('.canvas-wrap').hide("slow", function(){ $(this).remove(); });
*/
      var sol = false;
      var ans = false;
      var exercont = '';
      var questcont = '';
      if (el.parent().parent().parent(".solution").length) {
        sol = true;
        exercont = el.closest(".exercise-contents");
      }
      if (el.parent().parent().parent(".answer").length) {
        ans = true;
        questcont = el.closest(".question-contents");
      }
      el.closest(".canvas-wrap").slideUp("slow", function(){
        $(this).remove();
        if (sol) {
           exercont.append('<div class="add-solution-2" style="display: block;"><a href="#asdf">Click to add an answer/solution (optional)</a></div>');
           exercont.find(".solution-toggle-show").remove();
        }
/*
        if (ans) { 
           questcont.append('<div class="add-answer" style="display: block;"><a href="#asdf">Click to provide an answer to the question (optional)</a></div>');
           questcont.find(".answer-toggle-show").remove();
        }
*/
      });
/*
    }
*/
    e.stopPropagation();
    e.preventDefault();
  }
  $(".remove-element").live("click", function(e){
    removeElement($(this),e);
  });


  function eeEnter(ee,e) {
    ee.find("img").attr("src","content_files/options-06.png");
    ee.parent().css("background-color","transparent");
    ee.parent().css("border-left-color","#c2c2c2");
    ee.parent().parent().parent().css("background-color","#eee");
  }
  function eeLeave(ee,e) {
    ee.find("img").attr("src","content_files/options-05.png");
    ee.parent().css("background-color","#f7f7f7");
    ee.parent().css("border-left-color","#ddd");
    ee.parent().parent().parent().css("background-color","transparent");
  }
  $(".edit-element").live("mouseenter", function(e){
    eeEnter($(this),e);
  });
  $(".edit-element").live("mouseleave", function(e){
    eeLeave($(this),e);
  });


  function ueEnter(ue,e) {
    ue.find("img").attr("src","content_files/broom-01.png");
  }
  function ueLeave(ue,e) {
    ue.find("img").attr("src","content_files/broom-04.png");
  }
  $(".unelement-element").live("mouseenter", function(e){
    ueEnter($(this),e);
  });
  $(".unelement-element").live("mouseleave", function(e){
    ueLeave($(this),e);
  });


/*
        <a class="unelement-element" href="#" data-elementtype="' + elementtype + '" title="Remove the &quot;' + elementType + '&quot; formatting, reverting the content to regular paragraph(s).">\
          <img src="content_files/broom-04.png">\
        </a>\
*/
  function addHandles(cw,elementtype) {
    var elementType = elementtype.charAt(0).toUpperCase() + elementtype.substring(1);
    var buddies = '\
      <div style="display: none;" class="canvas-buddy-2">\
        <a class="edit-element" href="#" data-elementtype="' + elementtype + '" title="Edit options for this ' + elementtype + '">\
          <img src="content_files/options-05.png">\
        </a>\
        <a class="remove-element" href="#" title="Remove this ' + elementtype + '">\
          <img src="content_files/remove-element-01.png">\
        </a>\
      </div>\
      <div style="display: none;" class="canvas-buddy">\
        <a class="drag-element" href="#" title="Drag this ' + elementtype + ' to another location">\
          <img src="content_files/drag-element-19.png">\
        </a>\
      </div>\
    ';
    cw.children().children().prepend(buddies);
/*
    if (elementtype == 'solution') {
      cw.find(".unelement-element").remove();
    }
*/
  }

  function buildSolution(solhint,e,label) {
    if (label) {
      label = label;
    } else {
      label = "Solution";
    }
    var labell = label.toLowerCase();
    if (label == 'Meaning') {
      var emptymeaning = '\
        <div class="canvas-wrap" contenteditable="false">\
          <div class="meaning canvas canvas-unhovered">\
            <div class="canvas-inner">\
              <div class="meaning-contents">\
                <div class="para content-editable" contentEditable="true">&nbsp\;</div>\
              </div>\
            </div>\
          </div>\
        </div>\
      ';
      meaningparent = solhint.parent();
      solhint.replaceWith(emptymeaning);
      addHandles(meaningparent.children(".canvas-wrap"),'solution');
      meaningparent.find(".meaning-contents .para").focus();
    } else {
      var emptysol = '\
        <div class="canvas-wrap" contenteditable="false">\
          <div class="solution canvas canvas-unhovered">\
            <div class="canvas-inner">\
              <h2 class="solution-header">\
                <span class="cnx_label">' + label + '</span>\
              </h2>\
              <div class="solution-contents">\
               <div class="para content-editable" contentEditable="true">&nbsp\;</div>\
              </div>\
              <div class="' + labell + '-toggle-hide">\
                <span class="' + labell + '-toggle">[ Hide ' + label + ' ]</span>\
              </div>\
            </div>\
          </div>\
        </div>\
        <div class="' + labell + '-toggle-show" style="display: none;">\
          <span class="' + labell + '-toggle">[ Show ' + label + ' ]</span>\
        </div>\
      ';
      solparent = solhint.parent();
      solhint.replaceWith(emptysol);
      addHandles(solparent.children(".canvas-wrap"),'solution');
      solparent.find(".solution-contents .para").focus();
    }
    e.preventDefault();
    e.stopPropagation();
  }
  $(".add-solution-2").live("click", function(e){
    buildSolution($(this),e);
  });
  $(".add-answer").live("click", function(e){
    buildSolution($(this),e,"Answer");
  });
  $(".add-meaning").live("click", function(e){
    buildSolution($(this),e,"Meaning");
  });

  function removeHint(ce,e){
    ce.find(".hint-text").replaceWith("&nbsp;");
  }
  $(".example-contents>.content-editable").live("click focus", function(e){
    removeHint($(this),e);
  });
  $(".problem-contents>.content-editable").live("click focus", function(e){
    removeHint($(this),e);
  });
  $(".meaning").live("click focus", function(e){
    removeHint($(this),e);
  });
  $(".note-contents").live("click focus", function(e){
    removeHint($(this),e);
  });
/*
  $(".equation-contents>.content-editable").live("click focus", function(e){
    removeHint($(this),e);
  });
*/


  function addExerHintIfEmpty(ce,e) {
    if (ce.parent(".problem-contents").length && ce.text().trim() == '') {
      var ht = '<span class="hint-text exercise-hint-text">Type the text of your exercise here</span>';
      ce.prepend(ht);
    }
  }
  $(".problem-contents>.content-editable").live("blur", function(e){
    addExerHintIfEmpty($(this),e);
  });

  function addDefHintIfEmpty(ce,e) {
    if (ce.length && ce.text().trim() == '') {
      var ht = '<span class="hint-text definition-hint-text">Type the definition here</span>';
      ce.prepend(ht);
    }
  }
  $(".meaning").live("blur", function(e){
    addDefHintIfEmpty($(this),e);
  });


  function exerciseOptions(ex) {
    $("#exercise-options").data('exercise',ex).dialog("open");
    return false;
  }
  function exampleOptions(ex) {
    $("#example-options").data('example',ex).dialog("open");
    return false;
  }
  function equationOptions(eq) {
    $("#equation-options").data('equation',eq).dialog("open");
    return false;
  }
  function solutionOptions(so) {
    $("#solution-options").data('solution',so).dialog("open");
    return false;
  }
  function tableOptions(ta) {
    $("#table-options").data('table',ta).dialog("open");
    return false;
  }
  $(".edit-element-menu").livequery(function(){
    $(this).hoverIntent({
      over: function(e){
//      eeLeave($(this).closest(".edit-element"),e);    
      }, 
      out: function(e){
        $(this).remove();
      },
      timeout: 600,
    });
  });
  $(".edit-element").live("click", function(e){
    var elementtype = $(this).data("elementtype");
//    eeLeave($(this),e);
    if ($(this).find(".edit-element-menu").length) {
      $(this).find(".edit-element-menu").remove();
    } else {
      var opts = '<div class="edit-element-menu">\
        <ul>\
          <li class="edit-element-options" title="Set more advanced options on this ' + elementtype + '">All options for this ' + elementtype+ ' ...</li>\
          <li class="edit-element-unelement" title="Remove the \'' + elementtype + '\' formatting, reverting the content to basic paragraph(s), while retaining things like bold, italics, and links">Sweep away formatting</li>\
          <li class="edit-element-convert" title="Change the ' + elementtype+ ' to another type of element. We\'ll try our best not to lose too much in translation.">Convert element</li>\
        </ul>\
      </div>\
      ';
      $(this).append(opts);
      if (elementtype == 'solution') {
        $(this).find(".edit-element-unelement").remove();
        $(this).find(".edit-element-convert").remove();
      }
    }
    return false;
  });
  $(".glossary-options a").live("click", function(e){
    $("#glossary-confirm-move").data('definition',$(this).closest(".canvas-wrap")).dialog("open");
    return false;
  });
  $(".edit-element-options").live("click", function(e){
    var exercise = $(this).closest(".canvas.exercise");
    var example = $(this).closest(".canvas.example");
    var equation = $(this).closest(".canvas.equation");
    var solution = $(this).closest(".canvas.solution");
    var table = $(this).closest(".canvas.table");
    if (exercise.length) {
      exerciseOptions(exercise);
      return false;
      e.stopPropagation();
    } else if (example.length) {
      exampleOptions(example);
      return false;
      e.stopPropagation();
    } else if (equation.length) {
      equationOptions(equation);
      return false;
      e.stopPropagation();
    } else if (solution.length) {
      solutionOptions(solution);
      return false;
      e.stopPropagation();
    } else if (table.length) {
      tableOptions(table);
      return false;
      e.stopPropagation();
    }
    $(".edit-element-menu").remove();
    return false;
  });

  $(".edit-element-unelement").live("click", function(e){
//  $(".edit-element-menu").remove();
    var ee = $(this).closest(".edit-element");
    $(this).closest(".edit-element-menu").remove();
    eeLeave(ee,e);
    var elementtype = ee.data("elementtype");
    var origElem = ee.closest(".canvas-wrap");
    var origClone = origElem.mouseleave().clone();
    if (elementtype == 'table') {
      var ttl = origElem.find(".title");
      var contents = '';
      origElem.find("thead").each(function(e){
        contents += '<p contenteditable="true" class="para content-editable"><strong class="emphasis">';
        origElem.find("tr th").each(function(e){
          contents += $(this).html() + '<br/>';
        });
        contents += '</strong></p>';
      });
      origElem.find("tbody").each(function(e){
        contents += '<p contenteditable="true" class="para content-editable">';
        origElem.find("tr td").each(function(e){
          contents += $(this).html() + '<br/>';
        });
        contents += '</p>';
      });
      origElem.find("tfoot").each(function(e){
        contents += '<p contenteditable="true" class="para content-editable"><strong class="emphasis">';
        origElem.find("tr th").each(function(e){
          contents += $(this).html() + '<br/>';
        });
        contents += '</strong></p>';
      });
      var caption = origElem.find(".table-caption").html();
      if (caption.trim() == '' || caption.trim().indexOf("Add a table caption (optional)") > -1) {
        caption = '';
      } else {
        caption = '<p contenteditable="true" class="para content-editable">' + caption + '</p>';
      }
    } else if (elementtype == 'figure') {
      var ttl = '';
      if (origElem.find(".media-title-text").length > 0) ttl = origElem.find(".media-title-text").html();
      if (ttl.trim() == '' || ttl.trim().indexOf("Add a title for this image (optional)") > -1) {
        ttl = '';
      } else {
        ttl = '<p contenteditable="true" class="para content-editable"><strong class="emphasis">' + ttl + '</strong></p>';
      }
      var contents = origElem.find(".media-inner-plus-alt");
      var caption = '';
      if (origElem.find(".media-caption-text").length > 0) caption = origElem.find(".media-caption-text").html();
      if (caption.trim() == '' || caption.trim().indexOf("Add a caption for this image (optional)") > -1) {
        caption = '';
      } else {
        caption = '<p contenteditable="true" class="para content-editable">' + caption + '</p>';
      }
    } else if (elementtype == 'exercise') {
      var ttl = ee.parent().parent().children("[class*='-header']").find(".title");
      var contents = ee.parent().parent().children("[class*='-contents']");
      contents.find(".hint-text, .add-solution-2, .add-answer, .solution-toggle-show, .solution-toggle-hide, .solution-header").remove();
      contents.find(".solution").show();
      contents.find(".solution-contents").unwrap().unwrap().unwrap();
      contents = contents.html();
      var caption = '';
    } else if (elementtype == 'definition') {
      var ttl = ee.parent().parent().children("[class*='-header']").find(".term");
      var contents = ee.parent().parent().children("[class*='-contents']");
      contents.find(".hint-text, .add-meaning, .meaning-header").remove();
//      contents.find(".meaning").unwrap().unwrap().unwrap();
      contents = contents.html();
      var caption = '';
    } else {
      var title1 = ee.parent().parent().children("[class*='-header']");
      var title2 = ee.parent().parent().children().children("[class*='-header']"); // to account for things like .example-decoration
      var ttl = title1.add(title2).find(".title");
      var contents1 = ee.parent().parent().children("[class*='-contents']");
      var contents2 = ee.parent().parent().children().children("[class*='-contents']"); // to account for things like .example-decoration
      var contents = contents1.add(contents2);
      contents.find(".hint-text").remove();
      contents = contents.html();
      contents = '<p contenteditable="true" class="para content-editable">' + contents + '</p>';
      var caption = '';
    }
    $(".unelemented").contents().unwrap(); // any left around previously
    var unelemented = '<div class="unelemented" style="display: none"></div>';
    $("body").append(unelemented);
    $(".unelemented").append(ttl,contents,caption);
    origElem.slideUp("slow", function(){
      $(this).replaceWith($(".unelemented").hide())
      $(".unelemented").slideDown("slow", function(e){
        $(".undo-unelemented-2").remove();
        var undoUnelemented = '<div class="undo-unelemented-2"><span class="undo-unelemented-2-close" title="Dismiss this message"><img src="content_files/remove-element-08.png"/></span>Formatting of ' + elementtype + ' removed. <a href="#">Undo</a></div>';
        $("#editor").append(undoUnelemented);
        centerUE2($(".undo-unelemented-2"));
        $(".undo-unelemented-2").data("original",origClone);
      });
    });
/*
    origElem.fadeOut("slow", function(){
      $(this).replaceWith($(".unelemented").hide())
      $(".unelemented").fadeIn("slow", function(){
        $(".undo-unelemented-3").remove();
        var undoUnelemented = '<div class="undo-unelemented-3"><span class="undo-unelemented-3-close" title="Dismiss this message"><img src="content_files/remove-element-08.png"/></span>Formatting of ' + elementtype + ' removed. <a href="#">Undo</a></div>';
        $("#editor").append(undoUnelemented);
        centerUE2($(".undo-unelemented-3"));
        $(".undo-unelemented-3").data("original",origClone);
      });
    });
*/
//    $(".edit-element-menu").remove();
    return false;
  });
  $(".undo-unelemented-3-close").live("click", function(e){
    $(".unelemented").contents().unwrap();
    $(this).parent().remove();
  });
  $(".undo-unelemented-3 a").live("click", function(e){
    var original = $(this).parent().data("original");
    $(".unelemented").fadeOut("fast", function(){
      $(this).replaceWith(original.hide())
      original.fadeIn("fast");
    });
    $(this).parent().remove();
    return false;
  });

  $(".edit-element-convert").livequery(function(){
    $(this).hoverIntent({
      over: function(e){
        var elementtype = $(this).closest(".edit-element").data("elementtype");
        $(this).append('\
          <ul class="edit-element-convert-submenu" title="Change the ' + elementtype + ' to another type of element. We\'ll try our best not to lose too much in translation.">\
            <li class="ct-example">To an <strong>example</strong></li>\
            <li class="ct-exercise">To an <strong>exercise</strong></li>\
            <li class="ct-note">To a <strong>note</strong></li>\
            <li class="ct-definition">To a <strong>definition</strong></li>\
          </ul>\
        ');
        $(this).find(".ct-" + elementtype).remove();
      }, 
      out: function(e){
        $(".edit-element-convert-submenu").remove();
      },
      timeout: 500,
    });
  });

  $(".edit-element-convert").live("click", function(e){
    return false;
  });

//$(".unelement-element").live("click", function(e){
  $(".unelement-element-TEMPORARILY-DISABLED").live("click", function(e){ // see newer functions below
    ueLeave($(this),e);
    var origElem = $(this).closest(".canvas-wrap");
    var origClone = origElem.mouseleave().clone();
    var title1 = $(this).parent().parent().children("[class*='-header']");
    var title2 = $(this).parent().parent().children().children("[class*='-header']"); // to account for things like .example-decoration
//  var ttl = title1.add(title2).find(".title").html();
    var ttl = title1.add(title2).find(".title");
    var contents1 = $(this).parent().parent().children("[class*='-contents']");
    var contents2 = $(this).parent().parent().children().children("[class*='-contents']"); // to account for things like .example-decoration
    var contents = contents1.add(contents2).html();
//    $(".unelemented").contents().unwrap(); // any left around previously
    var unelemented = '<div class="unelemented"></div>';
    origElem.replaceWith(unelemented);
    $(".unelemented").append(ttl,contents);
    $(".undo-unelemented").remove();
    var undoUnelemented = '<div class="undo-unelemented"><span class="undo-unelemented-close" title="Dismiss this message"><img src="content_files/remove-element-08.png"/></span>Formatting of example removed. <a href="#">Undo</a></div>';
    $("#editor").append(undoUnelemented);
    centerUE($(".undo-unelemented"));
    $(".undo-unelemented").data("original",origClone);
//alert($(".undo-unelemented").data("original").text());
    return false;
  });
  function centerUE(ue){
    var ew = $("#editor").width();
    var uew = $(ue).width();
    ue.css("left", (ew - uew) / 2 + "px");
  }
  $(".undo-unelemented-close").live("click", function(e){
    $(".unelemented").contents().unwrap();
    $(this).parent().remove();
  });
  $(".undo-unelemented a").live("click", function(e){
    $(".unelemented").replaceWith($(this).parent().data("original"));
    $(this).parent().remove();
    return false;
  });
  function centerUE2(ue){
    var ew = $("#editor").width();
    var uew = $(ue).width();
    ue.css("left", (ew - uew) / 2 + "px");
  }

  // Functions for second broom attempt (-16.html instead of -15.html) below
/*
  $(".unelement-element").live("click", function(e){
    ueLeave($(this),e);
    var elementtype = $(this).data("elementtype");
    var origElem = $(this).closest(".canvas-wrap");
    var origClone = origElem.mouseleave().clone();
    if (elementtype == 'table') {
      var ttl = origElem.find(".title");
      var contents = '';
      origElem.find("thead").each(function(e){
        contents += '<p contenteditable="true" class="para content-editable"><strong class="emphasis">';
        origElem.find("tr th").each(function(e){
          contents += $(this).html() + '<br/>';
        });
        contents += '</strong></p>';
      });
      origElem.find("tbody").each(function(e){
        contents += '<p contenteditable="true" class="para content-editable">';
        origElem.find("tr td").each(function(e){
          contents += $(this).html() + '<br/>';
        });
        contents += '</p>';
      });
      origElem.find("tfoot").each(function(e){
        contents += '<p contenteditable="true" class="para content-editable"><strong class="emphasis">';
        origElem.find("tr th").each(function(e){
          contents += $(this).html() + '<br/>';
        });
        contents += '</strong></p>';
      });
      var caption = origElem.find(".table-caption").html();
      if (caption.trim() == '' || caption.trim().indexOf("Add a table caption (optional)") > -1) {
        caption = '';
      } else {
        caption = '<p contenteditable="true" class="para content-editable">' + caption + '</p>';
      }
    } else if (elementtype == 'figure') {
      var ttl = '';
      if (origElem.find(".media-title-text").length > 0) ttl = origElem.find(".media-title-text").html();
      if (ttl.trim() == '' || ttl.trim().indexOf("Add a title for this image (optional)") > -1) {
        ttl = '';
      } else {
        ttl = '<p contenteditable="true" class="para content-editable"><strong class="emphasis">' + ttl + '</strong></p>';
      }
      var contents = origElem.find(".media-inner-plus-alt");
      var caption = '';
      if (origElem.find(".media-caption-text").length > 0) caption = origElem.find(".media-caption-text").html();
      if (caption.trim() == '' || caption.trim().indexOf("Add a caption for this image (optional)") > -1) {
        caption = '';
      } else {
        caption = '<p contenteditable="true" class="para content-editable">' + caption + '</p>';
      }
    } else if (elementtype == 'exercise') {
      var ttl = $(this).parent().parent().children("[class*='-header']").find(".title");
      var contents = $(this).parent().parent().children("[class*='-contents']");
      contents.find(".hint-text, .add-solution-2, .add-answer, .solution-toggle-show, .solution-toggle-hide, .solution-header").remove();
      contents.find(".solution").show();
      contents.find(".solution-contents").unwrap().unwrap().unwrap();
      contents = contents.html();
      var caption = '';
    } else {
      var title1 = $(this).parent().parent().children("[class*='-header']");
      var title2 = $(this).parent().parent().children().children("[class*='-header']"); // to account for things like .example-decoration
      var ttl = title1.add(title2).find(".title");
      var contents1 = $(this).parent().parent().children("[class*='-contents']");
      var contents2 = $(this).parent().parent().children().children("[class*='-contents']"); // to account for things like .example-decoration
      var contents = contents1.add(contents2);
      contents.find(".hint-text").remove();
      contents = contents.html();
      contents = '<p contenteditable="true" class="para content-editable">' + contents + '</p>';
      var caption = '';
    }
    $(".unelemented").contents().unwrap(); // any left around previously
    var unelemented = '<div class="unelemented" style="display: none"></div>';
    $("body").append(unelemented);
    $(".unelemented").append(ttl,contents,caption);
//  origElem.slideUp("slow", function(){
//    $(this).replaceWith($(".unelemented").hide())
//    $(".unelemented").slideDown("slow");
//  });
    origElem.fadeOut("slow", function(){
      $(this).replaceWith($(".unelemented").hide())
      $(".unelemented").fadeIn("slow", function(){
        $(".undo-unelemented-2").remove();
        var undoUnelemented = '<div class="undo-unelemented-2"><span class="undo-unelemented-2-close" title="Dismiss this message"><img src="content_files/remove-element-08.png"/></span>Formatting of ' + elementtype + ' removed. <a href="#">Undo</a></div>';
        $("#editor").append(undoUnelemented);
        centerUE2($(".undo-unelemented-2"));
        $(".undo-unelemented-2").data("original",origClone);
//        $("#confirm-unelement").data("original",origClone).data("elementtype",elementtype).dialog("open");
      });
    });
    return false;
  });
*/
  $(".undo-unelemented-2-close").live("click", function(e){
    $(".unelemented").contents().unwrap();
    $(this).parent().remove();
  });
  $(".undo-unelemented-2 a").live("click", function(e){
    var original = $(this).parent().data("original");
    $(".unelemented").fadeOut("fast", function(){
      $(this).replaceWith(original.hide())
      original.fadeIn("fast");
    });
    $(this).parent().remove();
    return false;
  });


  $(".media-table-add div").live("click", function(e){
    $("#image-options").data('div',$(this)).data('e',e).dialog("open");
    return false;
  });

  $("#upload-image-link").live("click", function(e){
    $("#upload-image").click();
    $("#upload-url").hide();
    e.preventDefault();
  });

  $("#upload-image").live("change", function(e){
    $("#drag-image").css("background-image","url(content_files/cigarette-factory-200.jpg)");
    $(".image-forward").removeClass("disabled");
    $("#drag-image").removeClass("warning3").addClass("invisible");
    $("#drag-image").append('<div id="image-try-over">Change image</div>')
  });

  $("#image-try-over").live("click", function(e){
    $(this).remove();
    $("#drag-image").removeClass("invisible").css("background-image","none");
    $(".image-forward").addClass("disabled");
  });

  $("#upload-url-link").live("click", function(e){
    $("#upload-url").show();
    e.preventDefault();
  });

  $("#upload-url input[type='submit']").live("click", function(e){
    img = $(this).siblings().val();
    $("#drag-image").css("background-image","url(" + img + ")");
    $("#drag-image").removeClass("warning3").addClass("invisible");
    $(".image-forward").removeClass("disabled");
    $("#drag-image").append('<div id="image-try-over">Change image</div>')
    e.preventDefault();
  });


  $("#reuse-footnote-edit").live("click", function(e){
    var rft = $("#reuse-footnote-text");
    if ($(this).is(":checked") == true) {
      rft.attr("contentEditable","true");
      rft.removeClass("disabled");
    } else {
      rft.attr("contentEditable","false");
      rft.addClass("disabled");
    }
  });

  $("#reuse-author").live("keyup", function(e){
    $("#rft-text-1").show();
    $("#rft-author").show().text($(this).val().trim());
    $("#rft-text-2").show();
  });

  $("#reuse-url").live("keyup", function(e){
    $("#rft-url").show().find("a").attr("href",$(this).val().trim());
    $("#rft-text-3").show();
  });

  $("#reuse-license").live("change", function(e){
    if (this.selectedIndex != 0 && this.selectedIndex != this.length-1) {
      $("#rft-text-4").show();
      $("#rft-license").show().text($(this).val());
      $("#rft-text-5").show();
    } else {
      $("#rft-text-4").hide();
      $("#rft-license").hide();
      $("#rft-text-5").hide();
    }
  });



  $("#whats-mathtype-dialog").live("click", function(e){
    var helptext = $("#whats-mathtype-dialog-text");
    if (helptext.css("display") == 'none') {
       helptext.slideDown("fast", function(e){
         helptext.show();
       });
    } else {
       helptext.slideUp("fast", function(e){
         helptext.hide();
       });
    }
    e.preventDefault();
  });

  function mathHelpHideAllFirst(h,e) {
    if ( !$(".math-help-text").not(":hidden").length ) {
          mathHelpOpen(h,e);
    } else {
      $(".math-help-text").not(":hidden").each(function(e){
        $(this).animate({
          left: -250,
          height: 0,
        }, "fast", function(e){
          var hwrap = $(".math-help-text-wrap");
          $(this).css("height","auto");
          $(this).hide();
          if (h.attr("id") != this.id) {
            mathHelpOpen(h,e);
/*
          } else if ( $("input[name=math-type]:checked").val() == 'latex' ) {
            mathHelpOpen($("#math-error"),e);
*/
          }
        });
      });
    }
    e.preventDefault();
  }

  function mathHelpOpen(h,e) {
    var hwrap = $(".math-help-text-wrap");
    h.show();
    var hh = h.outerHeight();
    hwrap.css("height",hh + 17 + "px"); // 17 = padding + border + shadow 
    h.animate({
      left: 0,
      height: hh,
    }, "fast", function(e){
    });
  }

  $(".math-help-text-close").live("click", function(e){
    mathHelpHideAllFirst($(this).parent(),e);
  });
  $("#math-type-help, #math-type-help-2").live("click", function(e){
    mathHelpHideAllFirst($("#math-type"),e);
  });
  $("#math-editor-help").live("click", function(e){
    mathHelpHideAllFirst($("#math-editor-help-text"),e);
  });



  function cthListHelpEnter(ht,e) {
    if (!ht.is(":hidden")) {
/*
      ht.animate({
        left: -250,
        height: 0,
      }, "fast", function(e){
        ht.css("height","auto");
        ht.hide();
      });
*/
    } else {
      var hwrap = ht.parent();
      ht.show();
      var hh = ht.outerHeight();
      hwrap.css("height",hh + 17 + "px"); // 17 = padding + border + shadow 
       ht.animate({
        left: 0,
        height: hh,
      }, "fast", function(e){
      });
    }
    e.preventDefault();
  }
  function cthListHelpToggle(ht,e) {
    if (!ht.is(":hidden")) {
      ht.animate({
        left: -250,
        height: 0,
      }, "fast", function(e){
        ht.css("height","auto");
        ht.hide();
      });
    } else {
      var hwrap = ht.parent();
      ht.show();
      var hh = ht.outerHeight();
      hwrap.css("height",hh + 17 + "px"); // 17 = padding + border + shadow 
       ht.animate({
        left: 0,
        height: hh,
      }, "fast", function(e){
      });
    }
    e.preventDefault();
  }
  $(".cth-list-help-text-close, .ctt-list-help-text-close").live("click", function(e){
    cthListHelpToggle($(this).parent(),e);
  });
/*
  $(".cth-list-help a, .ctt-list-help a").live("mouseenter", function(e){
    cthListHelpEnter($(this).closest(".cth-list, .ctt-list").find(".cth-list-help-text, .ctt-list-help-text"),e);
  });
*/
  $(".cth-list-help a, .ctt-list-help a").live("click", function(e){
    cthListHelpToggle($(this).closest(".cth-list, .ctt-list").find(".cth-list-help-text, .ctt-list-help-text"),e);
  });


  function semanticHelpToggle(e) {
    var sha = $("#semantic-help-answer");
    if (!sha.is(":hidden")) {
      semanticHelpClose(e);
    } else {
      sha.show();
      var sh = sha.outerHeight();
      sha.parent().css("height",sh + 17 + "px"); // 17 = padding + border + shadow 
       sha.animate({
        left: 10,
        height: sh,
      }, "fast", function(e){
      });
    }
  }
  function semanticHelpClose(e) {
    var sha = $("#semantic-help-answer");
    if (!sha.is(":hidden")) {
      sha.animate({
        left: -600,
        height: 0,
      }, "fast", function(e){
        sha.css("height","auto");
        sha.hide();
        sha.parent().css("height","0");
      });
    }
  }
  $("#semantic-help-question, #semantic-help-answer-close").live("click", function(e){
    semanticHelpToggle(e);
    return false;
  });
  $("#semantic-help-answer").live("click", function(e){
    return false;
  });


$(function() {

  $(".table th, .table td").live("contextmenu", function(e){
    e.preventDefault();
    $(this).addClass("current-cell");
    $("#table-context-menu").show().css({"top": e.pageY + "px", "left": e.pageX + "px"});
    $(this).append('<div id="TableNew"></div>');
  });

/*
  $(".table th, .table td").contextMenu(
    "#table-context-menu", {
//      appendTo:$("#canvas"),
      beforeShow: function() {
        $(this).addClass("current-cell");
      },
      // Unsure why there's not just some afterShow option
      hideTransition: 'hide',
      hideSpeed:2,
      hideCallback: function() {
        $(this).removeClass("current-cell");
      },
    }
  ); 
*/
/*
  $(".table th, .table td").live("contextmenu", function(e){
    // Basically from Andrew Whitaker http://stackoverflow.com/questions/4495626/making-custom-right-click-context-menus-for-my-web-app
    var tableContextMenu = '\
      <div id="table-context-menu">\
        <ul class="menu-list disabled" id="table-contextmenu-insert">\
          <li class="table-add-row-before">Add new row before</li>\
          <li class="table-add-row-after">Add new row after</li>\
          <li class="table-add-column-before">Add new column before</li>\
          <li class="table-add-column-after">Add new column after</li>\
        </ul>\
        <ul class="menu-list disabled" id="table-contextmenu-delete">\
          <li class="table-delete-row">Delete row</li>\
          <li class="table-delete-column">Delete column</li>\
        </ul>\
        <ul class="menu-list disabled" id="table-contextmenu-options">\
          <li class="table-options-activate">Table options ...</li>\
        </ul>\
      </div>\
    ';
    $("body")
      .append(tableContextMenu)
      .css({top: e.pageY + "px", left: e.pageX + "px"})
      .show();
    e.preventDefault();
  });
*/

  $("#pedagog .node").draggable({
   appendTo: "#artboard",
   containment: "#artboard",
//   refreshPositions: true,
   scroll: true,
//    cursorAt: { top: 35, left: 200 },
//    cursorAt: { top: 40, left: -20 },
//    cursorAt: { right: -10, top: 25 },
    drag: function(){
      $(".droppable-all").not(".droppable-hover").css("height","1px");
    },
    helper: function(){
      var exercisehelper = '\
        <div class="dragged">\
          <div class="exercise">\
            <h2 class="exercise-header">\
              <span class="cnx_label">' + $(this).clone().children().remove().end().text() + ':</span>\
            </h2>\
            <div class="exercise-contents">\
              <div class="problem">\
                <div class="problem-contents">\
                  <div class="para">\
                    <i>Drag me to the desired location on the canvas.</i>\
                  </div>\
                </div>\
              </div>\
            </div>\
          </div>\
        </div>\
        ';
      return exercisehelper;
    },
    mouse: "move",
    revert: "invalid",
    opacity: "0.8",
    start: function(){
      $(".droppable-all").addClass("droppable-active");
      $("body").addClass("dragging");
      $("#pedagog .node").addClass("dragging");
      $("#canvas").addClass("dragging");
      $("#toolbar").addClass("no-drop");
      $(".canvas-wrap").unbind("mouseenter mouseleave");
    },
    stop: function(){
      $(".droppable-all").removeClass("droppable-active");
      $(".droppable-all").css("background-image","none"); // Unsure why this is needed.
      $("body").removeClass("dragging");
      $("#pedagog .node").removeClass("dragging");
      $("#canvas").removeClass("dragging");
      $("#toolbar").removeClass("no-drop");
//      $(".canvas-wrap").bind({
//        mouseenter: function(){
//          cwEnter($(this));
//        },
//        mouseleave: function(){
//          cwLeave($(this),"",e);
//        },
//      });
    },
  });

/*
  $(".canvas-wrap").draggable({
    appendTo: "#canvas",
    cursorAt: { top: 35, left: 200 },
    containment: "#canvas",
//    refreshPositions: true,
    handle: ".canvas-buddy",
    scroll: true,
    drag: function(){
      $(".droppable-all-existing").not(".droppable-hover").css("height","1px");
    },
//    mouse: "move",
    revert: "invalid",
    start: function(){
      $(".droppable-all-existing").addClass("droppable-active");
      $("body").addClass("dragging");
//      $("#pedagog .node").addClass("dragging");
      $("#canvas").addClass("dragging");
      $("#toolbar").addClass("no-drop");
      $(".canvas-wrap").die("mouseenter mouseleave");
    },
    stop: function(){
      $(".droppable-all-existing").removeClass("droppable-active");
      $(".droppable-all-existing").css("background-image","none"); // Unsure why this is needed.
      $("body").removeClass("dragging");
//      $("#pedagog .node").removeClass("dragging");
      $("#canvas").removeClass("dragging");
      $("#toolbar").removeClass("no-drop");
      $(".canvas-wrap").live("mouseenter", function(e){
        cwEnter($(this),e)
      });
      $(".canvas-wrap").live("mouseleave", function(e){
        cwLeave($(this),"",e)
      });
    },
  });
*/



  var droppableAllOptions = {
    accept: "#pedagog .node, .canvas-wrap",
    hoverClass: "droppable-hover",
    tolerance: "touch",
    over: function(event,ui){
//      $(".draggable-all").removeClass("one-and-only");
//      $(this).addClass("one-and-only");
//      $(".draggable-all").not($(this)).removeClass("one-and-only");
//      var oao1 = $(".one-and-only").last();
//      $(".one-and-only").not(oao1).removeClass("one-and-only");
//console.log($(".one-and-only").removeClass("one-and-only").first().attr("class"));
//      $(".one-and-only").removeClass("one-and-only").first().addClass("one-and-only");
//console.log($(".one-and-only").removeClass("one-and-only").first().attr("class"));
//console.log($(".one-and-only").length);
//console.log($(this).length);
      $(this).addClass("copy-draggable");
      var helperHeight = '';
      if (ui.draggable.hasClass("canvas-wrap")){
        helperHeight = ui.draggable.outerHeight();
//alert(helperHeight);
      } else {
        helperHeight = $(".dragged").outerHeight();
      }
      $(this).css("height", helperHeight + "px");
/*
      $(this).animate({
        height: helperHeight + "px",
      }, "fast");
*/
      $(".droppable-all").not(this).css("height","1px").removeClass("droppable-hover");
    },
    out: function(event,ui) {
      $("#canvas").removeClass("copy-draggable");
      $(this).css("height","1px");
    },
    drop: function(event,ui) {
//console.log($(this).attr("class"));
//     if ($(this).hasClass("one-and-only")) {
//      $(".droppable-all").not($(this)).droppable('disable');
      $(this).removeClass("copy-draggable");
      if (ui.draggable.hasClass("canvas-wrap")) {
        $(this).after(ui.draggable);
        ui.draggable.context.effect("highlight", { color: "#E5EEF5" }, 1000);
      } else {
        $("body").find(".dragged").remove();
        var semanticElem = $(ui.draggable).clone().children().remove().end().text();
        if (semanticElem.indexOf('Exercise') > -1) {
          semanticElem = 'Exercise';
        } else if (semanticElem.indexOf('Quesiton') > -1) {
          semanticElem = 'Question';
        } else if (semanticElem == 'Note to Reader') {
          semanticElem = 'Note';
        } else if (semanticElem == 'Definition') {
          semanticElem = 'Definition';
        } else if (semanticElem == 'Numbered Equation') {
          semanticElem = 'Equation'
        } else {
          semanticElem = semanticElem;
        }
        var semanticelem = semanticElem.toLowerCase();
        var semanticelem2 = '<div>' + semanticelem + '</div>';
        var elemnum = '';
        if (semanticelem == 'exercise') {
          elemnum = $(this).add($(".exercise")).index($(this)) + 1;
          semanticelem2 = $('\
            <div class="canvas-wrap" contenteditable="false">\
              <div class="exercise canvas canvas-unhovered">\
                <div class="canvas-inner">\
                  <h2 class="exercise-header">\
                    <span class="cnx_label">Exercise ' + elemnum + '</span>\
                    <strong class="title content-editable" style="display: none" contentEditable="true">\
                      <span class="hint-text">Add a title (optional)</span>\
                    </strong>\
                  </h2>\
                  <div class="exercise-contents">\
                    <div class="problem">\
                      <div class="problem-contents">\
                        <div class="droppable-all"/>\
                        <div class="para content-editable" contentEditable="true">\
                          <span class="hint-text exercise-hint-text">\
                            Type the text of your exercise here\
                          </span>\
                        </div>\
                        <div class="droppable-all"/>\
                      </div>\
                    </div>\
                    <div class="add-solution-2" style="display: block;">\
                      <a href="#asdf">Click to add a solution (optional)</a>\
                    </div>\
                  </div>\
                </div>\
              </div>\
            </div>\
            <div class="droppable-all"/>\
          ').hide();
/*
        } else if (semanticelem == 'question') {
          elemnum = $(this).add($(".question")).index($(this)) + 1;
          semanticelem2 = $('\
            <div class="canvas-wrap" contenteditable="false">\
              <div class="question canvas canvas-unhovered">\
                <div class="canvas-inner">\
                  <h2 class="question-header">\
                    <span class="cnx_label">Question ' + elemnum + '</span>\
                    <strong class="title content-editable" style="display: none" contentEditable="true">\
                      <span class="hint-text">Add a title (optional)</span>\
                    </strong>\
                  </h2>\
                  <div class="question-contents">\
                    <div class="problem">\
                      <div class="problem-contents">\
                        <div class="droppable-all"/>\
                        <div class="para content-editable" contentEditable="true">\
                          <span class="hint-text exercise-hint-text">\
                            Type the text of your question here\
                          </span>\
                        </div>\
                        <div class="droppable-all"/>\
                      </div>\
                    </div>\
                    <div class="add-answer" style="display: block;">\
                      <a href="#asdf">Click to provide an answer to the question (optional)</a>\
                    </div>\
                  </div>\
                </div>\
              </div>\
            </div>\
            <div class="droppable-all"/>\
          ').hide();
*/
        } else if (semanticelem == 'example') {
          elemnum = $(this).add($(".example")).index($(this)) + 1;
          semanticelem2 = $('\
            <div class="canvas-wrap" contenteditable="false">\
              <div class="example canvas canvas-unhovered">\
                <div class="canvas-inner">\
                  <div class="example-decoration">\
                  <h2 class="example-header">\
                    <span class="cnx_label">Example ' + elemnum + '</span>\
                    <strong class="title content-editable" style="display: none" contentEditable="true">\
                      <span class="hint-text">Add a title (optional)</span>\
                    </strong>\
                  </h2>\
                  <div class="example-contents">\
                    <div class="droppable-all"/>\
                    <div class="para content-editable" contentEditable="true">\
                      <span class="hint-text example-hint-text">\
                        Type the text of your example here\
                      </span>\
                    </div>\
                    <div class="droppable-all"/>\
                  </div>\
                  </div>\
                </div>\
              </div>\
            </div>\
            <div class="droppable-all"/>\
          ').hide();
        } else if (semanticelem == 'note') {
          elemnum = $(this).add($(".note")).index($(this)) + 1;
          semanticelem2 = $('\
            <div class="canvas-wrap" contenteditable="false">\
              <div class="note canvas canvas-unhovered">\
                <div class="canvas-inner">\
                  <div class="note-decoration">\
                  <h2 class="note-header">\
                    <span class="cnx_label">Note</span>\
                    <strong class="title content-editable" style="display: none" contentEditable="true">\
                      <span class="hint-text">Add a title (optional)</span>\
                    </strong>\
                  </h2>\
                  <div class="note-contents">\
                    <div class="droppable-all"/>\
                    <div class="para content-editable" contentEditable="true">\
                      <span class="hint-text note-hint-text">\
                        Type the text of your note here\
                      </span>\
                    </div>\
                    <div class="droppable-all"/>\
                  </div>\
                  </div>\
                </div>\
              </div>\
            </div>\
            <div class="droppable-all"/>\
          ').hide();
        } else if (semanticelem == 'definition') {
          elemnum = $(this).add($(".definition")).index($(this)) + 1;
          semanticelem2 = $('\
            <div class="canvas-wrap" contenteditable="false">\
              <div class="definition canvas canvas-unhovered">\
                <div class="canvas-inner">\
                  <h2 class="definition-header">\
                    <span class="cnx_label">Definition ' + elemnum + '</span>\
                    <span class="term content-editable" contentEditable="true">\
                      <span class="hint-text">Enter key term to be defined here (required) <img src="content_files/warning-01.png" class="term-required" title="You are required to have a key term"/ contentEditable="false"></span>\
                    </span>\
                  </h2>\
                  <div class="definition-contents content-editable" contenteditable="true">\
                    <ol class="content-editable" contenteditable="true">\
                      <li class="meaning">\
                        <span class="hint-text definition-hint-text">\
                          Type the definition here\
                        </span>\
                      </li>\
                    </ol>\
                  </div>\
                  <div class="glossary-options" style="display: none">\
                    <span>Optional: </span><a href="#">Move this definition to the glossary</a>\
                  </div>\
                </div>\
              </div>\
            </div>\
            <div class="droppable-all"/>\
          ').hide();
        } else if (semanticelem == 'equation') {
          elemnum = $(this).add($(".equation")).index($(this)) + 1;
          semanticelem2 = $('\
            <div class="canvas-wrap" contenteditable="false">\
              <div class="equation canvas canvas-unhovered">\
                <div class="canvas-inner">\
                  <div class="equation-contents">\
                    <div class="MathJax" contentEditable="false">\
                      <span class="hint-text">\
                        Enter your math notation here\
                      </span>\
                      <span class="ascii-notation"/>\
                      <span class="ascii-math"/>\
                    </div>\
                    <span class="equation-number">(' + elemnum + ')</span>\
                  </div>\
                </div>\
              </div>\
            </div>\
            <div class="droppable-all"/>\
          ').hide();
        }
        $(this).after(semanticelem2);
        var newelem = $(this).next();
        $(this).remove();
        newelem.find(".droppable-all").droppable( droppableAllOptions );
        newelem.next(".droppable-all").droppable( droppableAllOptions );
        addHandles(newelem,semanticelem);
        newelem.stop().show("slow");
        newelem.effect("highlight", { color: "#E5EEF5" }, 1000);
      }
      $("#canvas").removeClass("copy-draggable");
//      $(".droppable-all").droppable('enable');
//     } // end of "one-and-only" test condition
    },
  }

  $(".droppable-all").droppable( droppableAllOptions );




  $("#pedagog .node").mousedown(function(e){
    $(this).addClass("dragging");
  });
  $("#pedagog .node").mouseup(function(e){
    $(this).removeClass("dragging");
  });
  $("#pedagog .node").click(function(e){
    var exText = getSelectionText();
    var cls = $(this).clone().children().remove().end().text().trim().toLowerCase();
    if (cls == 'note to reader') cls = 'note';
    if (cls == 'definition') cls = cls;
    if (cls == 'numbered equation') cls = 'equation';
    if (cls.indexOf('exercise') > -1) cls = 'exercise';
    if (cls.indexOf('question') > -1) cls = 'question';
    if (exText != '') {
      var elemnum = '';
      pasteHtmlAtCaret('<div id="SemanticNew" class="canvas-wrap" contenteditable="false"><div class="canvas canvas-unhovered ' + cls + '"><div class="canvas-inner"><div class="' + cls + '-contents">' + exText + '</div></div></div></div>');
      var snci = $("#SemanticNew .canvas-inner")
      if (cls == 'example') {
        elemnum = snci.add($(".example")).index(snci);
        snci.prepend('<h2 class="example-header"><span class="cnx_label">Example ' + elemnum + '</span><strong class="title content-editable" style="display: none;" contenteditable="true"><span class="hint-text">Add a title (optional)</span></strong></h2>');
        snci.find(".example-contents").contents().wrap('<div class="para content-editable" contenteditable="true"></div>');
        snci.find(".para").before('<div class="droppable-all"/>').after('<div class="droppable-all"/>');
        snci.find(".droppable-all").droppable( droppableAllOptions );
        snci.contents().wrapAll('<div class="example-decoration"></div>')
      }
      if (cls == 'exercise') {
        elemnum = snci.add($(".exercise")).index(snci);
        snci.prepend('<h2 class="exercise-header"><span class="cnx_label">Exercise ' + elemnum + '</span><strong class="title content-editable" style="display: none;" contenteditable="true"><span class="hint-text">Add a title (optional)</span></strong></h2>');
        snci.find(".exercise-contents").contents().wrap('<div class="problem"><div class="problem-contents"><div class="para content-editable" contenteditable="true"></div></div></div>');
        snci.find(".para").before('<div class="droppable-all"/>').after('<div class="droppable-all"/>');
        snci.find(".droppable-all").droppable( droppableAllOptions );
        snci.find(".exercise-contents").append('<div class="add-solution-2" style="display: none"><a href="#asdf">Click to add a solution (optional)</a></div>');
      }
/*
      if (cls == 'question') {
        elemnum = snci.add($(".question")).index(snci);
        snci.prepend('<h2 class="question-header"><span class="cnx_label">Question ' + elemnum + '</span><strong class="title content-editable" style="display: none;" contenteditable="true"><span class="hint-text">Add a title (optional)</span></strong></h2>');
        snci.find(".question-contents").contents().wrap('<div class="problem"><div class="problem-contents"><div class="para content-editable" contenteditable="true"></div></div></div>');
        snci.find(".para").before('<div class="droppable-all"/>').after('<div class="droppable-all"/>');
        snci.find(".droppable-all").droppable( droppableAllOptions );
        snci.find(".question-contents").append('<div class="add-answer" style="display: none"><a href="#asdf">Click to provide an answer to the question (optional)</a></div>');
      }
*/
      if (cls == 'note') {
        snci.prepend('<h2 class="note-header"><span class="cnx_label">Note</span></h2>');
//        snci.find(".note-contents").addClass("content-editable");
//        snci.find(".note-contents").attr("contenteditable","true");
        snci.find(".note-contents").contents().wrap('<div class="para content-editable" contenteditable="true"></div>');
        snci.find(".para").before('<div class="droppable-all"/>').after('<div class="droppable-all"/>');
        snci.find(".droppable-all").droppable( droppableAllOptions );
        snci.contents().wrapAll('<div class="note-decoration"></div>')
      }
      if (cls == 'definition') {
        elemnum = snci.add($(".definition")).index(snci);
        snci.prepend('<h2 class="definition-header"><span class="cnx_label">Definition ' + elemnum + ':</span><span class="term content-editable" contenteditable="true"><span class="hint-text">Enter key term to be defined here (required) <img src="content_files/warning-01.png" class="term-required" title="You are required to have a key term." contentEditable="false"/></span></span></h2>');
        snci.find(".definition-contents").contents().wrap('<ol content-editable" contenteditable="true"><li class="meaning"></li></ol>');
//        snci.find(".definition-contents").append('<li class="add-meaning" style="display: none"><a href="#asdf">Click to provide another meaning (optional)</a></div>');
        snci.find(".definition-contents").after('\
                  <div class="glossary-options" style="display: none">\
                    <span>Optional: </span><a href="#">Move this definition to the glossary</a>\
                  </div>\
        ');
      }
      if (cls == 'equation') {
        elemnum = snci.add($(".equation")).index(snci);
        snci.append('<span class="equation-number">(' + elemnum + ')</span>');
        snci.find(".equation-contents").addClass("content-editable");
        snci.find(".equation-contents").attr("contenteditable","true");
      }
      $("#SemanticNew").after('<div class="droppable-all"/>');
      $("#SemanticNew").next(".droppable-all").droppable( droppableAllOptions );
      addHandles($("#SemanticNew"),cls);
      $("#SemanticNew").removeAttr("id").effect("highlight", { color: "#C5DAE9" }, 1500);
    } else {
      var msg = "To add a new " + cls + " to your document, either: <br/><br/>\u00A0\u00A0\u2022\u00A0Select and highlight text, then click the button again, or<br/>\u00A0\u00A0\u2022\u00A0Drag and drop a new " + cls + " into the document.";
      nonselectionClickOpen(msg,e);
    }
  });

  function nonselectionClickOpen(msg,e){
    var box = $("#semantic-nonselection-click");
    box.find("p").html(msg);
    if (box.is(":hidden")) {
      box.slideDown("fast");
    }
  }

  $("#semantic-nonselection-click").live("click", function(e){
     $("#semantic-nonselection-click").slideUp("fast", function(){
     });
     return false;
  });

  // The droppable for moving around existing elements. Tried to combine w/ the other droppable, but couldn't get .data() to pass through. Using hack based on 2nd class.
/*
  $(".droppable-all-existing").droppable({
    accept: ".canvas-wrap",
    hoverClass: "droppable-hover",
    tolerance: "touch",
    over: function(event,ui){
      $(this).addClass("copy-draggable");
      helperHeight = ui.draggable.outerHeight();
      $(this).animate({
        height: helperHeight + "px",
      }, "fast");
      $(".droppable-all-existing").not(this).css("height","1px").removeClass("droppable-hover");
    },
    out: function(event,ui) {
      $("#canvas").removeClass("copy-draggable");
      $(this).css("height","1px");
    },
    drop: function(event,ui) {
      $(this).after(ui.draggable);
      ui.draggable.effect("highlight", { color: "#E5EEF5" }, 1000);
      $("#canvas").removeClass("copy-draggable");
    },
  });
*/

});

$(function() {


  $("#exercise-options").dialog({
    width: 600,
    autoOpen: false,
    modal: true,
    zIndex: 500,
/*
    drag: function(){
      $(".draggable-all").unbind("mouseenter mouseleave");
      $(".draggable-all").unbind("mouseenter mouseleave");
      $(".draggable-all").off("mouseenter mouseleave");
      $(".draggable-all").undelegate("mouseenter mouseleave");
    },
*/
    open: function(){
      $(this).data("exercise").addClass("element-being-edited");
    },
    close: function(){
      $(this).data("exercise").removeClass("element-being-edited");
      $(".edit-element-menu").remove();
    },
    buttons: {
      "Save Changes": function() {
        $( this ).dialog("close");
      },
      Cancel: function() {
        $( this ).dialog("close");
      }
    }
  });

  $("#example-options").dialog({
    width: 600,
    autoOpen: false,
    modal: true,
    zIndex: 500,
    open: function(){
      $(this).data("example").addClass("element-being-edited");
    },
    close: function(){
      $(this).data("example").removeClass("element-being-edited");
      $(".edit-element-menu").remove();
    },
    buttons: {
      "Save Changes": function() {
        $(this).dialog("close");
      },
      Cancel: function() {
        $(this).dialog("close");
      }
    }
  });

  $("#equation-options").dialog({
    width: 600,
    autoOpen: false,
    modal: true,
    zIndex: 500,
    open: function(){
      $(this).data("equation").addClass("element-being-edited");
    },
    close: function(){
      $(this).data("equation").removeClass("element-being-edited");
      $(".edit-element-menu").remove();
    },
    buttons: {
      "Save Changes": function() {
        $(this).dialog("close");
      },
      Cancel: function() {
        $(this).dialog("close");
      }
    }
  });
  $("#solution-options").dialog({
    width: 600,
    autoOpen: false,
    modal: true,
    zIndex: 500,
    open: function(){
      $(this).data("solution").addClass("element-being-edited");
    },
    close: function(){
      $(this).data("solution").removeClass("element-being-edited");
      $(".edit-element-menu").remove();
    },
    buttons: {
      "Save Changes": function() {
        $(this).dialog("close");
      },
      Cancel: function() {
        $(this).dialog("close");
      }
    }
  });
  $("#table-options").dialog({
    width: 600,
    autoOpen: false,
    modal: true,
    zIndex: 500,
    open: function(){
      $(this).data("table").addClass("element-being-edited");
    },
    close: function(){
      $(this).data("table").removeClass("element-being-edited");
      $(".edit-element-menu").remove();
    },
    buttons: {
      "Save Changes": function() {
        $(this).dialog("close");
      },
      Cancel: function() {
        $(this).dialog("close");
      }
    }
  });

  $("#glossary-confirm-move").dialog({
    width: 600,
    autoOpen: false,
    modal: true,
    zIndex: 500,
    open: function(){
      $(this).data("definition").children().addClass("element-being-edited");
    },
    close: function(){
      $(this).data("definition").children().removeClass("element-being-edited");
    },
    buttons: {
      "Yes, move to glossary": function() {
        var def = $(this).data("definition");
        $(this).dialog("close");
        var defclone = def.clone();
        cwLeave(defclone,'','');
        defclone.appendTo("#sidebar");
        var defpos = def.position();
        def.css("visibility","hidden");
        defclone.css("position","absolute");
        defclone.css("left",defpos.left - 20 + 'px');
        defclone.css("top", defpos.top - $(window).scrollTop() - 53 + 'px');
        defclone.css("background-color", "#ffffff");
        defclone.css("border", "1px solid #bbbbbb");
        defclone.css("width", def.width() + "px");
        defclone.css("height", def.height() + "px");
        defclone.css("font-size", "1em");
        defclone.css("overflow", "hidden");
        defclone.find("h2,h3,h4,h5,h6").css("margin", "0");
        defclone.find("h2,h3,h4,h5,h6").css("font-size", "1em");
        var defblock = $("#definition-block");
        var defblockpos = defblock.position();
        $(".canvas-wrap").die("mouseenter mouseleave"); // Temporarily kill (turn back on when animation ends)
        defclone.animate({
          left: defblockpos.left + defblock.outerWidth() - 10 + 'px',
//          top: defblockpos.top + 80 + 'px', // why the extra pixels ... I'm not sure yet!
          top: defblockpos.top + 20 + 'px',
//          height: 0,
//          opacity: '.5',
//          width: defclone.outerWidth() / 6 + 'px',
//          height: defclone.outerHeight() / 3 + 'px',
          width: defblock.outerHeight() + 'px',
          height: defblock.outerHeight() + 'px',
        },1400, function(){
          $(this).remove();
          $(".canvas-wrap").live("mouseenter", function(e){
            cwEnter($(this),e);
          });
          $(".canvas-wrap").live("mouseleave", function(e){
            cwLeave($(this),"",e);
          });
          $("#definition-block .node").effect("highlight", { color: "#C5DAE9" }, 1400);
        });
        def.slideUp("slow", function(){
          $(this).remove();
        });
      },
      Cancel: function() {
        $(this).dialog("close");
      }
    }
  });

  $("#image-options").dialog({
    width: 700,
    autoOpen: false,
    modal: true,
    zIndex: 500,
    open: function(){
    },
    close: function(){
      unSelectIcon($("#toolbar-image"),$(this).data('e'));
      resetImageDialogs();
      $(".edit-element-menu").remove();
    },
    buttons: {
      "Back": {
        text: 'Back',
        class: 'image-back', 
        click: function() {
          $("#image-options-step-2").hide();
          $("#image-options-step-1").show();
          $(".image-back").hide();
          $(".image-forward").text("Next").removeClass("disabled");
        }
      }, 
      "Next": {
        text: 'Next',
        class: 'image-forward disabled', 
        click: function() {
          // On the first step (choosing an image, caption, alt text)
          if ($("#image-options-step-1").is(":visible")) {
            if ($(".image-forward").hasClass("disabled")) {
              $("#drag-image").addClass("warning3");
              return false;
            } else {
              var reuseUrl = $("#upload-url input[type='text']").val();
              $("#reuse-url").val(reuseUrl);
              if (reuseUrl != '') $("#rft-url").show().find("a").attr("href",reuseUrl.trim());
              $("#image-options-step-1").hide();
              $("#image-options-step-2").show();
              $(".image-back").show();
              $(".image-forward").text("Insert Image");
              if (!$("input[name='img-perms']:checked").val()) $(".image-forward").addClass("disabled");
            }
          // On the second step (image source)
          } else {
            if ($(".image-forward").hasClass("disabled")) {
              $("#img-perms-required").addClass("warning");
              return false;
            } else {
              var div = $(this).data("div");
              var alt = $("#enter-alt input").val().trim();
              var altwarn = '';
              if (alt == '') {
                altwarn = '<img class="alt-warning" src="content_files/warning-01.png" title="This image is missing a description for the visually impaired.  Click to provide one." contentEditable="false"/>';
              }
              var captionText = $("#image-dialog-caption input").val().trim();
              var captionHtml = '\
                <div class="media-caption" style="display: block;">\
                  <span class="cnx_label">Figure 1</span>\
                  <div class="media-caption-removable">\
                    <span class="media-caption-close" title="Remove caption"><img src="content_files/remove-element-08.png"/></span>\
                    <span class="hint-text">Add a caption for this image (optional)</span>\
                  </div>\
                  <div style="clear: both\;"></div>\
                </div>\
              ';
              if (captionText != '') {
                captionHtml = '\
                  <div class="media-caption" style="display: block;">\
                    <span class="cnx_label">Figure 1:</span>\
                    <div class="media-caption-removable">\
                      <span class="media-caption-close" title="Remove caption"><img src="content_files/remove-element-08.png"/></span>\
                      <div class="media-caption-text content-editable" contenteditable="true">' + captionText + '</div>\
                    </div>\
                    <div style="clear: both\;"></div>\
                  </div>\
                ';
              }
              var selectedImg = $("#drag-image").css("background-image").trim();
              if (selectedImg.charAt(4) == "'" || selectedImg.charAt(4) == '"') {
                selectedImg = selectedImg.substring(5,selectedImg.length - 2);
              } else {
                selectedImg = selectedImg.substring(4,selectedImg.length - 1); // Chrome doesn't include quotes as part of .css("background-image"), apparently
              }
              selectedImg = '<img src="' + selectedImg + '" class="image content-editable" contenteditable="true" width="200" alt="' + alt + '"/>'; // The width for KEF.
              var imgWrap = '<span class="media-inner-plus-alt">\
                ' + altwarn + '\
                  <span class="media-inner content-editable" contentEditable="true">\
                  ' + selectedImg + '\
                  <span class="image-options" contenteditable="false">\
                    <span class="image-add-options">\
                      <label class="image-options-add">Add:</label>\
                      <a href="#asaefafedfas" class="image-options-title">Title</a>\
                      &#183;\
                      <a href="#asdsdfasdfs" class="image-options-caption">Caption</a>\
                    </span>\
                    <a href="#adsfasasdfas" class="image-options-options">\
                      <img src="content_files/options-05.png" style="vertical-align: bottom\;"> \
                      More options ...\
                    </a>\
                  </span>\
                </span>\
              </span>\
              ';
              if (div.attr("id") == "ImageNew") {
                // As a new figure somewhere in the document.
                div.replaceWith('\
                <div class="canvas-wrap" id="ImageNew" contenteditable="false">\
                  <div class="canvas canvas-unhovered figure">\
                    <div class="canvas-inner">\
                <div class="media-block" contenteditable="false">\
                  <div class="media-title">\
                    <span class="media-title-close" title="Remove title"><img src="content_files/remove-element-08.png"/></span>\
                    <div class="hint-text">Add a title for this image (optional)</div>\
                  </div>\
                  <table class="media-table" contentEditable="false">\
                    <tbody>\
                      <tr>\
                        <td class="media-table-add">\
                          <div>\
                            Click to add another image here\
                          </div>\
                        </td>\
                        <td style="width: 200px\; padding: 0 16px\;">\
                          ' + imgWrap + '\
                        </td>\
                        <td class="media-table-add">\
                          <div>\
                            Click to add another image here\
                          </div>\
                        </td>\
                      </tr>\
                    </tbody>\
                  </table>\
                  ' + captionHtml + '\
                </div>\
                    </div>\
                  </div>\
                </div>\
                ');
                addHandles($("#ImageNew"),'figure');
                $("#ImageNew").removeAttr("id");
              } else {
                // As a subfigure next to an existing one 
                if (div.closest("td").index() == 0) {
                  div.closest("td").after('<td style="width: 200px\; padding: 0 16px\;">' + imgWrap + '</td>');
                } else {
                  div.closest("td").before('<td style="width: 200px\; padding: 0 16px\;">' + imgWrap + '</td>');
                }
              }
              $(this).dialog("close");
            }
          }
        }
      },
      Cancel: function() {
        $(this).dialog("close");
      }
    }
  });


  $("#enter-alt input").live("keyup", function(e){
    if ($(this).val().trim() != '') {
      $("#alt-warning-upload").hide();
    } else {
      $("#alt-warning-upload").show();
    }
  });

  function resetImageDialogs() {
      $("#ImageNew").remove();
      // Set form back to empty
      $("#image-options-step-2").hide();
      $("#image-options-step-1").show();
      $("#image-dialog-title input").val('');
      $("#image-dialog-caption input").val('');
      $("#drag-image").css("background-image","none");
      $("#drag-image").removeClass("invisible warning3");
      $("#image-try-over").remove();
      $("#upload-url").hide();
      $("#upload-url input[type='text']").val('');
//      $("#image-size").hide();
      $("#enter-alt input").val('');
      $("#alt-warning-upload").show();
      $(".image-forward").addClass("disabled");
      $(".image-forward").text("Next");
      $(".image-back").hide();
      $("#image-options").removeData("ip");
      $("input[name='img-perms']").each(function(e){
        this.checked = false;
      });
      $("#img-perms-required").removeClass("warning");
//      $("#select-image-required").removeClass("warning");
      $("#drag-image").removeClass("warning3");
//      $("#reuse-info").hide();
      $("#reuse-author").val('');
      $("#reuse-url").val('');
      $("#reuse-license")[0].selectedIndex = 0;
      $("#include-in-footnote").attr("checked", true);
      $("#reuse-footnote-edit").attr("checked", false);
      $("#reuse-footnote-text").addClass("disabled");
      $("#reuse-footnote-text").attr("contentEditable","false");
      $("#reuse-footnote-text span").hide();
  }

  $("#link-options").dialog({
/* 
   TODO: 
   .cnxns
   "preview this link" link
   make newly-contstructed links editable and unlinkable
*/
    width: 600,
    autoOpen: false,
    modal: true,
    resizable: true,
    zIndex: 500,
    open: function(){
      var linkText = $(this).data("link").clone().children().remove().end().text(); // clone...end to remove children text
      var linkURL = $(this).data("link").attr("href");
      $("#link-text-input").val(linkText);
      $("#ltw-webpage-url").val(linkURL);
      if (true) { // this clearly needs to change
        $("#ltw-webpage").attr("checked", true);
        $("#ltw-webpage-url").focus();
      } else {
        $("#ltw-place").attr("checked", true);
      }
      var lbl = '';
      var ttl = '';
      var txt = '';
      $(".section-header:visible, .figure:visible, .table:visible, .example:visible, .rule:visible, .note:visible, .exercise:visible, .equation:visible").each(function(e){
        // get label
        if ($(this).hasClass("equation")) {
          lbl = 'Equation ' + $(this).find(".equation-number").text().trim().replace('(','').replace(')','');
        } else if ($(this).hasClass("section-header")) {
          lbl = $(this).find(".cnx_label").text().trim() // doubtful that this will exist, but possible.
        } else if ($(this).hasClass("table")) {
          lbl = $(this).find(".table-text").find(".cnx_label").text().trim();
        } else if ($(this).hasClass("figure")) {
          lbl = $(this).find(".media-caption").find(".cnx_label").text().trim();
        } else {
          lbl = $(this).children().children("[class*='-header']").find(".cnx_label").text().trim();
        }
        if (lbl.length && lbl != '') {
          lbl = '<span class="cnx_label">' + lbl + ' </span>';
        } else {
          lbl = '';
        }
        // get title
        if ($(this).hasClass("section-header")) {
          ttl = $(this).find(".title").text().trim();
        } else if ($(this).hasClass("figure")) {
          ttl = $(this).find(".media-title-text").text().trim();
        } else {
          ttl = $(this).children().children("[class*='-header']").find(".title").clone().children().remove().end().text().trim(); // the .clone()....end() part to remove the 'Add a title' child
        }
        if (ttl.length && ttl != '') {
          ttl = '<strong class="title">' + ttl + ' </strong>';
        } else {
          ttl = '';
        }
        // get text
        if ($(this).hasClass("table")) {
//          txt = $(this).find("thead, tbody, tfoot").text().trim();
          txt = $(this).find("thead, tbody").text().trim();
        } else if ($(this).hasClass("section-header")) {
          txt = '';
        } else if ($(this).hasClass("equation")) {
          txt = '';
        } else if ($(this).hasClass("figure")) {
          txt = $(this).find(".media-caption-text").text().trim();
        } else {
          txt = $(this).children().children("[class*='-contents']").text().trim();
        }
        if (txt.length && txt != '') {
          txt = '<span class="txt">' + txt + '</span>';
        } else {
          txt = '';
        }
        // put it all together
        $("#link-parts").append('<div class="linkable-part">' + lbl + ttl + txt + '</div>');
        var classes = new Array("section-header","figure","table","example","rule","note","exercise","equation");
        for (var i=0; i < classes.length; i++) {
          if ($(this).hasClass(classes[i])) {
            $(".linkable-part").last().addClass("linkable-" + classes[i]);
          }
        }
      });
    },
    close: function(){
      // remove the hooks used to identify the currently-edited link
      $("#LinkNew").removeAttr("id");
      $(".LinkNew").removeClass("LinkNew");
      // reset values to default/empty
      $("#link-text-input").val('');
      $("#ltw-webpage-url").val('');
      $("#ltw-webpage-url").removeClass("disabled");
      $("#ltw-webpage-url").removeProp("disabled");
      $("#ltw-webpage").attr("checked", false);
      $("#ltw-place").attr("checked", false);
      $("#link-parts").empty();
      $("#link-parts").addClass("disabled");
      $("#link-parts-filters li").removeClass("selected");
      // return the toolbar icon to normal
      unSelectIcon($("#toolbar-link"),$("#link-options").data('e'));
    },
    buttons: {
      "Submit": {
        text: 'Submit',
        class: '', 
        click: function() {
          // apply the new link values
          var newLinkText = $("#link-text-input").val();
          var newLinkURL = $("#ltw-webpage-url").val();
          $("#LinkNew, .LinkNew").replaceWith('<a href="' + newLinkURL + '" class="link">' + newLinkText + '</a>')
          // Close the dialog (and everything that entails);
          $(this).dialog("close");
        }
      },
      Cancel: function() {
        $(this).dialog("close");
      }
    }
  });

  $("#link-parts, #link-parts-filters, #ltw-place").on("click", function(e){
    $("#ltw-place").attr("checked", true);
    $("#link-parts").removeClass("disabled");
    if (this.id == 'ltw-place') {
      $("#lp-all").click();
    }
    $("#ltw-webpage-url").addClass("disabled");
    $("#ltw-webpage-url").prop("disabled", true);
  });
  $("#ltw-place").on("click", function(e){
    $("#ltw-place").attr("checked", true);
    $("#link-parts").removeClass("disabled");
  });

  $(".linkable-part").live("mouseenter", function(e){
    $(this).addClass("hovered");
  });
  $(".linkable-part").live("mouseleave", function(e){
    $(this).removeClass("hovered");
  });
  $(".linkable-part").live("click", function(e){
    $(".linkable-part.selected").removeClass("selected");
    $(this).addClass("selected");
    $("#ltw-place").attr("checked", true);
    if (!$("#link-parts-preview").length) {
      $("#link-parts").after('<div id="link-parts-preview"><a href="#">Preview this link</a></div>');
    }
  });
  $("#ltw-webpage, #ltw-webpage-url").live("click", function(e){
    $(".linkable-part").removeClass("selected");
    $("#ltw-webpage").attr("checked", true);
    $("#ltw-webpage-url").removeClass("disabled");
    $("#ltw-webpage-url").prop("disabled", false);
    $("#link-parts").addClass("disabled");
    $("#link-parts-filters li").removeClass("selected");
    $("#link-parts-preview").remove();
  });
  $("#link-parts-preview a").live("click", function(e){
    return false;
  });
  $("#ltw-webpage-test a").live("click", function(e){
    window.open($("#ltw-webpage-url").val(), '_blank', 'width=800, height=600');
    return false;
  });

  $("#link-parts-filters li").live("click", function(e){
    var filter = this.id.substring(3,this.id.length - 1); // e.g. convert "lp-headers" to "header"
    if (filter != 'heade') { // "Show:"
      $("#link-parts .nothing-to-display").remove();
      $(".linkable-part").removeClass("selected");
      $("#link-parts-preview").remove();
      $("#link-parts div").hide();
      $("#link-parts-filters .selected").removeClass("selected");
      $(this).addClass("selected");
      if (filter == 'al') {  // "All"
        $("#link-parts div").show();
        if (!$("#link-parts div").length) {
          $("#link-parts").append('<div class="nothing-to-display">There are no other elements to link to</div>');
        }
      } else if (filter == 'othe') { // "Other"
        $("#link-parts .linkable-rule, #link-parts .linkable-exercise, #link-parts .linkable-note, #link-parts .linkable-equation, #link-parts .linkable-example").show();
        if (!$("#link-parts .linkable-rule, #link-parts .linkable-exercise, #link-parts .linkable-note, #link-parts .linkable-equation, #link-parts .linkable-example").length) {
          $("#link-parts").append('<div class="nothing-to-display">There are no other elements to link to</div>');
        }
      } else {
        var filter2 = "#link-parts div.linkable-" + filter;
        $(filter2).show();
        if (!$(filter2).length) {
          if (filter == "section-header") {
            $("#link-parts").append('<div class="nothing-to-display">There are no section headings to link to</div>');
          } else {
            $("#link-parts").append('<div class="nothing-to-display">There are no ' + filter + 's to link to</div>');
          }
        }
      }
    }
  });

  $("#ascii-or-latex").dialog({
    width: 600,
    autoOpen: false,
    modal: true,
    zIndex: 500,
    open: function(){
    },
    close: function(){
        $(this).data("e").stopPropagation();
    },
    buttons: {
      "OK": function() {
        $(this).dialog("close");
        var aol = $("input[name=ascii-or-latex-radio]:checked").attr("id");
        $("[class*='-header']").die("mouseenter mouseleave"); // Turning hovers off (temporarily)
        $(".canvas-wrap").die("mouseenter mouseleave"); // Have to do this one separately from above, apparently
        $(".MathJax").die("mouseenter mouseleave");
        $("table caption").die("mouseenter mouseleave");
        cwLeave($(".canvas-wrap"),"special",e);
//        mathEditorRemove();
        $("#toolbar-math").addClass("selected");
        var e = $(this).data("e");
        var exText = $(this).data("exText");
        mathClickNew2(aol,exText,e);
        e.stopPropagation();
      },
      Cancel: function() {
        $(this).dialog("close");
        var exText = $(this).data("exText");
        if (exText.trim() == '&nbsp\;') {
          $("#MathJaxNew").remove();
        } else {
          $("#MathJaxNew").replaceWith(exText);
        }
        $("#toolbar-math").removeClass("selected");
        e.stopPropagation();
      }
    }
  });

/*
  $(".emphasis,dfn.term").addClass("edhint");
*/

  $("#hints-checkbox").click(function(e){
/*
    if ( $(this).is(":checked") ) {
      $(".emphasis,dfn.term").addClass("edhint");    
    } else {
      $(".emphasis,dfn.term").removeClass("edhint");
    }
*/
    if ( $(this).is(":checked") ) {
      $("#hints").addClass("selected");
      cthEnter($(".convert-to-header, .section-header"),e);
      $(".convert-to-header, .section-header").die("mouseenter mouseleave")
    } else {
      $("#hints").removeClass("selected");
      cthLeave($(".convert-to-header, .section-header"),e);
      $(".convert-to-header, .section-header").live("mouseenter", function(e){
        cthEnter($(this),e);
      });
      $(".convert-to-header, .section-header").live("mouseleave", function(e){
        cthLeave($(this),e);
      });
    }
    e.stopPropagation();
  });


  function cthEnter(cth,e) {
    if (!cth.find(".cth-list").length) {
//      cth.children().append('<span class="edhint" contentEditable="false"><img src="helper_files/math-hint-03.png"/></span>');
//      cth.children().append('<span class="edhint" contentEditable="false" title="Show menu to see more options"><img src="content_files/menu-hint-chevrons-10.png"/></span>');
      cth.children().append('<span class="edhint" contentEditable="false" title="Show menu to see more options"><span class="chevrons">&nbsp;</span><img src="content_files/menu-hint-right-edge-01.png"/></span>');
    }
  }
  function cthLeave(cth,e) {
    cth.children().children('.edhint').remove();
  }
  $(".convert-to-header, .section-header").live("click", function(e){
    cthLeave($(this),e);
  });
  $(".convert-to-header .edhint, .section-header .edhint").live("click", function(e){
    if ($(this).next(".cth-list").length) {
      $(this).next(".cth-list").remove();
    } else {
      $(this).after('<ul class="cth-list" contentEditable="false"></ul>')
      $(this).next(".cth-list").append('<li class="cth-list-help"><a href="#" title="What\'s this?  Click to find out more about this feature.">(?)</a>Is this a heading? Choose level:</li>');
      $(this).next(".cth-list").append('<li class="cth-list-help-text-wrap">\
          <div class="cth-list-help-text">\
            <span class="cth-list-help-text-close"><img src="content_files/remove-element-08.png"/></span>\
            <p>\
              Section headings help readers understand the flow of the content and help visually-impaired learners listen to the document. \
              Section headings show up in the table of contents and you can easily make links to them.\
            </p>\
            <p style="display: none">\
              <strong>Why did this show up here?</strong>\
            </p>\
            <p style="display: none>\
              The text above this menu is a line of bold text. Often bold suggests a section heading. This menu provides a quick way to convert to a heading (or back to plain text).\
            </p>\
          </div>\
      ');
//      var emText = $(this).closest(".convert-to-header").find(".emphasis").clone().children().remove().end().text();
      var ish2 = $(this).closest("h2").length ? true : false;
      var ish3 = $(this).closest("h3").length ? true : false;
      var prevh2 = ish2 ? $(this).add($("h2.section-header:visible")).index($(this)) - 1 : $(this).add($("h2.section-header:visible")).index($(this));
      var prevh3 = ish3 ? $(this).add($("h3.section-header:visible")).index($(this)) - 1 : $(this).add($("h3.section-header:visible")).index($(this));
      $(this).next(".cth-list").append('<li class="cth-list-item cth-list-h2"><span class="cth-level">Section heading</span></li>');
      // if ($(this).preceding("h2.section-header").length)
//      if ($(this).add($("h2.section-header:visible")).index($(this))) {
      $(this).next(".cth-list").append('<li class="cth-list-item cth-list-h3 disabled" title="You cannot add a subsection at this level of the document"><span class="cth-level">Subsection heading</span></li>');
      if (prevh2 > 0) {
        $(this).next(".cth-list").find(".cth-list-h3").removeClass("disabled");
        $(this).next(".cth-list").find(".cth-list-h3").removeAttr("title");
      }
//      if ($(this).add($("h3.section-header:visible")).index($(this))) {
      $(this).next(".cth-list").append('<li class="cth-list-item cth-list-h4 disabled" title="You cannot add a subsubsection at this level of the document"><span class="cth-level">Subsubsection heading</span></li>');
      if (prevh3 > 0) {
        $(this).next(".cth-list").find(".cth-list-h4").removeClass("disabled");
        $(this).next(".cth-list").find(".cth-list-h4").removeAttr("title");
      }
      $(this).next(".cth-list").append('<li class="cth-list-item cth-list-regular"><span class="cth-level">Just bold <span style="font-weight: normal">(not a heading)</span></span></li>');
      if ($(this).closest(".section-header:visible").length) {
        $(this).next(".cth-list").find("cth-list-regular").removeClass("disabled");
      }
      if ($(this).closest("h2:visible").length) {
        $(this).next(".cth-list").find(".cth-list-h2").addClass("selected");
      } else if ($(this).closest("h3:visible").length) {
        $(this).next(".cth-list").find(".cth-list-h3").addClass("selected");
      } else if ($(this).closest("h4:visible").length) {
        $(this).next(".cth-list").find(".cth-list-h4").addClass("selected");
      } else {
        $(this).next(".cth-list").find(".cth-list-regular").addClass("selected");
      }
      $(this).closest(".convert-to-header, .section-header").find(".edhint").remove();
    }
  });
  $(".cth-list-item").live("click", function(e){
    var cvt = $(this).closest(".convert-to-header, .section-header");
    var cls = $(this).removeClass("selected").attr("class");
    var level = cls.substring(cls.length -2, cls.length); // may result in "ar" for regular text, as opposed to h2, h3, h4
    cvt.find(".cth-list").remove();
    cvt.find(".edhint").remove();
    var content = cvt.children(".emphasis, .title").contents();
    if (level == 'ar') { // Change back to regular text
      content.unwrap().unwrap().wrap('<div class="para content-editable convert-to-header" contenteditable="true"><em class="emphasis"></em></div>');
    } else {
      content.unwrap().unwrap().wrap('<' + level + ' class="section-header"><strong class="title content-editable" contenteditable="true"></strong></' + level + '>');
    }
    content.parent().parent().effect("highlight", { color: "#C5DAE9" }, 800);
    if ($("#hints-checkbox").is(":checked")) {
      cthEnter(content.closest(".convert-to-header, .section-header"),e);
    }
  });


  $("dfn.term, .emphasis").live("click", function(e){
    cttLeave($(this),e);
  });

  $("dfn.term .edhint, .emphasis .edhint").live("click", function(e){
    if ($(this).next(".ctt-list").length) {
      $(this).next(".ctt-list").remove();
    } else {
      $(this).after('<ul class="ctt-list" contentEditable="false"></ul>')
      $(this).next(".ctt-list").append('<li class="ctt-list-help">\
         <a href="#" title="What\'s this?  Click to find out more about this feature.">(?)</a>\
         <span class="ctt-list-title">Quick converter.</span> The above text is:\
        </li>');
      $(this).next(".ctt-list").append('<li class="ctt-list-help-text-wrap">\
          <div class="ctt-list-help-text">\
            <span class="ctt-list-help-text-close"><img src="content_files/remove-element-08.png"/></span>\
            <p>\
              If you mark emphasized words as terms, you can easily attach definitions to these terms, and include the terms automatically in system-generated indeces.\
            </p>\
            <p>\
              <strong>Why did this show up here?</strong>\
            </p>\
            <p>\
              This menu provides a quick way to change the style emphasized words or phrases, or mark them as key \
              terms, taking advantage of extra features that key terms support.\
            </p>\
          </div>\
      ');
      $(this).next(".ctt-list").append('<li class="ctt-list-item ctt-list-term"><span class="ctt-level">key term</span></li>');
      $(this).next(".ctt-list").append('<li class="ctt-list-item ctt-list-regular"><span class="ctt-level">just emphasis <span style="font-weight: normal">(not a term)</span></span></li>');
      if ($(this).closest("dfn.term").length) {
        $(this).next(".ctt-list").find(".ctt-list-term").addClass("selected");
      } else {
        $(this).next(".ctt-list").find(".ctt-list-regular").addClass("selected");
      }
      $(this).closest("dfn.term, .emphasis").find(".edhint").remove();
    }
  });

  function preventSelection(){  // Found this on stackoverflow, but no longer remember exactly where in order to attribute it. Doh!
var sel ;
if(document.selection && document.selection.empty){
document.selection.empty() ;
} else if(window.getSelection) {
sel=window.getSelection();
if(sel && sel.removeAllRanges)
sel.removeAllRanges() ;
}
  }

  $(".ctt-list").live("click", function(e){
    preventSelection();
    return false;
  });
  $(".ctt-list-item").live("click", function(e){
    preventSelection();
    $(this).parent().children().removeClass("selected");
    $(this).addClass("selected");
    if ($(".ctt-list-help-text").is(":visible")) {
      cthListHelpToggle($(".ctt-list-help-text"),e);
    }
    cttLiSubActivate($(this),e);
    return false;
  });
  function cttLiSubActivate(cttli,e){
    var cvt = cttli.closest("dfn.term, .emphasis");
/* REPLACING $(this) with cttli
    if ($(this).hasClass("ctt-list-term")) {
        $(".ctt-list-emphasis-submenu").remove();
        $(this).append('\
          <ul class="ctt-list-submenu ctt-list-term-submenu">\
            <li class="define-here"><strong>Define now</strong> (optional)</li>\
          </ul>\
        ');
        cvt.wrapInner('<dfn class="term"></dfn>');
        cvt.children().unwrap();
    } else {
        $(".ctt-list-term-submenu").remove();
        $(this).append('\
          <ul class="ctt-list-submenu ctt-list-emphasis-submenu">\
            <li class="ctt-bold"><b>Bold</b></li>\
            <li class="ctt-italics"><i>Italics</i></li>\
            <li class="ctt-underline"><u>Underline</u></li>\
          </ul>\
        ');
        var typeOfEm = 'em';
        if ($(this).closest("i.emphasis").length) {
          typeOfEm = 'i';
          $(".ctt-italics").addClass("selected");
        } else if ($(this).closest("u.emphasis").length) {
          typeOfEm = 'u';
          $(".ctt-undeline").addClass("selected");
        } else {
          typeOfEm = 'em';
          $(".ctt-bold").addClass("selected");
        }
        cvt.wrapInner('<' + typeOfEm + ' class="emphasis"></' + typeOfEm + '>');
        cvt.children().unwrap();
    }
*/
    if (cttli.hasClass("ctt-list-term")) {
        $(".ctt-list-emphasis-submenu").remove();
        cttli.append('\
          <ul class="ctt-list-submenu ctt-list-term-submenu">\
            <li class="define-here"><strong>Define now</strong> (optional)</li>\
          </ul>\
        ');
        cvt.wrapInner('<dfn class="term"></dfn>');
        cvt.children().unwrap();
    } else {
        $(".ctt-list-term-submenu").remove();
        cttli.append('\
          <ul class="ctt-list-submenu ctt-list-emphasis-submenu">\
            <li class="ctt-bold"><b>Bold</b></li>\
            <li class="ctt-italics"><i>Italics</i></li>\
            <li class="ctt-underline"><u>Underline</u></li>\
          </ul>\
        ');
        var typeOfEm = 'em';
        if (cttli.closest("i.emphasis").length) {
          typeOfEm = 'i';
          $(".ctt-italics").addClass("selected");
        } else if (cttli.closest("u.emphasis").length) {
          typeOfEm = 'u';
          $(".ctt-underline").addClass("selected");
        } else {
          typeOfEm = 'em';
          $(".ctt-bold").addClass("selected");
        }
        cvt.wrapInner('<' + typeOfEm + ' class="emphasis"></' + typeOfEm + '>');
        cvt.children().unwrap();
    }
  }
  function cttLiSubRemove(cttli,e){
    cttli.find("ul").remove();
  }
  $(".ctt-list-item.selected").live("mouseenter", function(e){
//  $(".ctt-list-item").live("mouseenter", function(e){
    cttLiSubActivate($(this),e);
  });
  $(".ctt-list-item.selected").live("mouseleave", function(e){
    cttLiSubRemove($(this),e);
  });
  $(".define-here").live("click", function(e){
    var cvt = $(this).closest("dfn.term, .emphasis");
    var cvtp = cvt.parent();
    cvt.find(".ctt-list").remove();
    cvt.find(".edhint").remove();
    var cvtt = cvt.text();
    var elemnum = cvtp.add($(".definition")).index(cvtp) + 1;
    cvt.contents().unwrap().wrap('<a href="Definition ' + elemnum + ': ' + cvtt + '" class="term cnxn"></a>');
    var newelem = $('\
            <div class="canvas-wrap" contenteditable="false">\
              <div class="definition canvas canvas-unhovered">\
                <div class="canvas-inner">\
                  <h2 class="definition-header">\
                    <span class="cnx_label">Definition ' + elemnum + '</span>\
                    <span class="term content-editable" contentEditable="true">' + cvtt + '</span>\
                  </h2>\
                  <div class="definition-contents content-editable" contenteditable="true">\
                    <ol class="content-editable" contenteditable="true">\
                      <li class="meaning">\
                        <span class="hint-text definition-hint-text">\
                          Type the definition here\
                        </span>\
                      </li>\
                    </ol>\
                  </div>\
                  <div class="glossary-options" style="display: none">\
                    <span>Optional: </span><a href="#">Move this definition to the glossary</a>\
                  </div>\
                </div>\
              </div>\
            </div>\
    ').hide();
    cvtp.after(newelem);
    newelem = cvtp.next();
    addHandles(newelem,'definition');
    newelem.stop().show("slow");
    newelem.effect("highlight", { color: "#E5EEF5" }, 1000);
    return false;
  });
  $(".ctt-list-emphasis-submenu li").live("click", function(e){
    var cvt = $(this).closest("dfn.term, .emphasis");
    $(this).siblings().removeClass("selected");
    $(this).addClass("selected");
    var typeOfEm = 'em';
    if ($(this).text().indexOf('talic') > 0) typeOfEm = 'i';
    if ($(this).text().indexOf('nderline') > 0) typeOfEm = 'u';
    cvt.wrapInner('<' + typeOfEm + ' class="emphasis"></' + typeOfEm + '>');
    cvt.children().unwrap();
    return false;
  });
  function cttEnter(ctt,e) {
    if (!ctt.find(".ctt-list").length) {
//      ctt.append('<span class="edhint" contentEditable="false"><img src="helper_files/math-hint-03.png"/></span>');
//      ctt.append('<span class="edhint" contentEditable="false" content="Show menu to see more options"><img src="content_files/menu-hint-chevrons-10.png"/></span>');
      ctt.append('<span class="edhint" contentEditable="false" title="Show menu to see more options"><span class="chevrons">&nbsp;</span><img src="content_files/menu-hint-right-edge-01.png"/></span>');
    }
  }
  function cttLeave(ctt,e) {
    ctt.children('.edhint').remove();
  }


  $(".cth-list").livequery(function(){
    $(this).hoverIntent({
      over: function(e){
      }, 
      out: function(e){
        $(this).remove();
      },
      timeout: 600,
    });
  });
  $(".ctt-list").livequery(function(){
    $(this).hoverIntent({
      over: function(e){
      }, 
      out: function(e){
        $(this).remove();
      },
      timeout: 600,
    });
  });
  $(".convert-to-header, .section-header").livequery(function(){
    $(this).hoverIntent({
      over: function(e){
        cthEnter($(this),e);
      }, 
      out: function(e){
        $(this).find(".cth-list").remove();
        cthLeave($(this),e);
      },
      timeout: 400,
    });
  });
  $("dfn.term, .emphasis").livequery(function(){
    $(this).hoverIntent({
      over: function(e){
        cttEnter($(this),e);
      }, 
      out: function(e){
        $(this).find(".ctt-list").remove();
        cttLeave($(this),e);
      },
      timeout: 400,
    });
  });


  function imageOptionsPlacement(img,io,e) {
    // this centers the .image-options box under 
    var iow = io.outerWidth();
    var imgw = img.outerWidth();
/*
    if (imgw > iow) {
      io.css("left","0");
    } else {
*/
      io.css("left", (iow / 2 - imgw / 2) * -1 );
/*
    }
*/
  }

/*
  $(".media-inner").resizable({
    aspectRatio: true,
    start: function(e){
      console.log("asdf");
    },
    handles: "n, e, s, w, ne, se, sw, nw",
    helper: "image-resize",
    containment: "parent",
  });
*/

/*
  $(".media-inner").mousemove(function(e){
      var io = $(this).children(".image-options");
      imageOptionsPlacement($(this).children(".image"),io,e);
      io.show();
  });
*/

  function mediaInnerEnter(mi,e){
    var io = mi.children(".image-options");
    imageOptionsPlacement(mi.children(".image"),io,e);
    io.show();
  }
  function mediaInnerLeave(mi,e){
    mi.children(".image-options").hide();
  }
  $(".media-inner").live("mouseenter", function(e){
    mediaInnerEnter($(this),e);
  });
  $(".media-inner").live("mouseleave", function(e){
    mediaInnerLeave($(this),e);
  });


/*
  $(".media-inner").hoverIntent({
    over: function(e){
      var io = $(this).children(".image-options");
      imageOptionsPlacement($(this).children(".image"),io,e);
      io.show();
    },
    out: function(e){
      $(this).children(".image-options").hide();
    },
    timeout: 400,
  });
*/

  $(".image-options-options, .image-options .already-added").live("click", function(e){
    return false;
  });

  function imageOptionsTitleOrCaption(iol,mb,mi) {
/*
    mi.off("mouseenter"); // Temporarily turning off so that this doesn't pop open again when things are moving around
    if (!iol.closest(".canvas-wrap").children(".figure").length) {
      mb.wrap('<div class="canvas-wrap" contenteditable="false"><div class="figure canvas canvas-hovered"><div class="canvas-inner"></div></div></div>')
      addHandles(iol.closest(".canvas-wrap"),'figure');
    }
    iol.closest(".canvas-inner").children(".canvas-buddy, .canvas-buddy-2").show();
*/
    iol.closest(".image-options").hide();
    iol.addClass("already-added");
    iol.attr("title","This has already been added");
  }

  $(".image-options-title:not('.already-added')").live("click", function(e){

    var mb = $(this).closest(".media-block");
    var mi = $(this).closest(".media-inner");
    imageOptionsTitleOrCaption($(this),mb,mi);
    var mt = mb.find(".media-title");
    mt.addClass("hovered");
    mt.find(".media-title-close").show();

/*
    var mc = mb.find(".media-caption");
    if (mc.hasClass("just-title")) {
      mc.slideDown("fast", function(e){
        var mcb = mc.offset().top + mc.outerHeight();
        var sb = $(window).scrollTop() + $(window).height();
        if (mcb > sb) {
          $('body,html').animate({
            scrollTop: mcb - $(window).height() + 10, // I got confused here, so adding an extra 10 which makes it seem to work :-p
          }, 500);
        }
*/
/*
        mi.on("mouseenter", function(e){ // Turning back on
          mediaInnerEnter(mi,e);
        });
*/
/*
      });
    }
*/

    mt.slideDown("fast", function(e){

      var imgw = mb.find(".image").outerWidth();
      if (mt.outerWidth() < imgw) mt.css("width",imgw - 28 + "px");
      mi.on("mouseenter", function(e){ // Turning back on
        mediaInnerEnter(mi,e);
      });
    });

    return false;

  });

  $(".image-options-caption:not('.already-added')").live("click", function(e){

    var mb = $(this).closest(".media-block");
    var mc = mb.find(".media-caption");

    $(this).closest(".image-options").hide();
    $(this).addClass("already-added");
    $(this).attr("title","This has already been added");

    addColonToLabel(mc);

    var mcr = mb.find(".media-caption-removable");
    mcr.slideDown("fast", function(){
      mc.addClass("hovered");
    });

    return false;

  });

  $(".media-caption").live("click", function(e){
    var mb = $(this).closest(".media-block");
    if (!$(this).find(".media-caption-text").length) {
      addColonToLabel($(this));
      $(this).find(".hint-text").replaceWith('<div class="content-editable media-caption-text" contentEditable="true">&nbsp\;</div>');
      mb.find(".image-options-caption").addClass("already-added");
      mb.find(".image-options-caption").attr("title","This has already been added");
    }
    $(this).find(".media-caption-text").focus();
    return false;
  });

  $(".media-caption").live("mouseenter", function(e){
    $(this).addClass("hovered");
    $(this).find(".media-caption-removable").show();
  });

  $(".media-caption").live("mouseleave", function(e){
    var mb = $(this).closest(".media-block");
    $(this).removeClass("hovered");
    var mct = $(this).find(".media-caption-text");
    if (mct.length && mct.text().trim() == '') {
      mct.replaceWith('<span class="hint-text">Add a caption for this image (optional)</span>');
      removeColonFromLabel($(this));
      mb.find(".image-options-caption").removeClass("already-added");
      mb.find(".image-options-caption").removeAttr("title");
    }
    $(this).find("*").blur();
    $(this).blur();
  });

  $(".media-caption-close").live("click", function(e){
    var mb = $(this).closest(".media-block");
    var mc = $(this).closest(".media-caption");
    var mcr = mc.find(".media-caption-removable");
    mcr.slideUp("fast", function(){
      if (mc.find(".media-caption-text").length) {
        mc.find(".media-caption-text").replaceWith('<span class="hint-text">Add a caption for this image (optional)</span>');
        removeColonFromLabel(mc);
      }
    });
    mb.find(".image-options-caption").removeClass("already-added");
    mb.find(".image-options-caption").removeAttr("title");
    return false;
  });

  function addColonToLabel(mc) {
    var mcl = mc.find(".cnx_label");
    var mclt = mcl.text().trim();
    if (mclt.substr(mclt.length - 1) != ":") {
      mcl.text(mclt + ": ");
    }
  }
  function removeColonFromLabel(mc) {
    var mclt = mc.find(".cnx_label").text().trim();
    if (mclt.substr(mclt.length - 1) == ":") {
      mc.find(".cnx_label").text(mclt.substring(0, mclt.length - 1));
    }
  }

  $(".media-title").live("click", function(e){
//    $(this).removeClass("empty");
    if (!$(this).find(".media-title-text").length) {
      $(this).find(".hint-text").remove();
      $(this).append('<div class="content-editable media-title-text" contentEditable="true">&nbsp\;</div>');
    }
    $(this).find(".media-title-text").focus();
    return false;
  });
  $(".media-title").live("mouseenter", function(e){
    $(this).addClass("hovered");
  });
  $(".media-title").live("mouseleave", function(e){
    $(this).removeClass("hovered");
    var mtt = $(this).find(".media-title-text");
    if (mtt.length && mtt.text().trim() == '') {
      mtt.remove();
//      $(this).addClass("empty");
      $(this).append('<span class="hint-text">Add a title for this image (optional)</span>');
    }
    $(this).find("*").blur();
    $(this).blur();
  });
  $(".media-title-close").live("click", function(e){
    var mb = $(this).closest(".media-block");
    $(this).parent().slideUp();
    $(this).parent().addClass("hovered");
    if($(this).siblings(".media-title-text").length) {
      $(this).siblings(".media-title-text").remove();
      $(this).parent().append('<span class="hint-text">Add a title for this image (optional)</span>');
    }
    mb.find(".image-options-title").removeClass("already-added");
    mb.find(".image-options-title").removeAttr("title");

/*
    if (mb.find(".media-caption").hasClass("just-title")) {
       mb.find(".cnx_label").addClass("clear active");
    }
*/

    return false;
  });

/*
  $(".clear").live("mouseenter", function(e){ // dunno why .on() doesn't work!
    $(this).addClass("active");
  });
  $(".clear").live("mouseleave", function(e){
    $(this).removeClass("active");
  });
  $(".clearer").on("mouseenter", function(e){
    $(this).siblings(".cnx_label_text").css("visibility","hidden");
    $(this).closest(".media-caption").css("border-top-color","transparent");
    cwLeave($(this).closest(".canvas-wrap"),"",e);
  });
  $(".clearer").on("mouseleave", function(e){
    $(this).siblings(".cnx_label_text").css("visibility","visible");
    $(this).closest(".media-caption").css("border-top-color","#999");
    cwEnter($(this).closest(".canvas-wrap"),e);
  });
  $(".clearer").on("click", function(e){
    $(this).closest(".canvas-inner").find(".canvas-buddy, .canvas-buddy-2").remove();
    $(this).closest(".canvas-inner").children().unwrap().unwrap().unwrap();
    $(this).parent().removeClass("clear active");
    $(this).siblings(".cnx_label_text").css("visibility","visible");
    $(this).closest(".media-caption").css("border-top-color","#999");
    $(this).closest(".media-caption").hide();
  });
*/

/*
  $(".image-options-inline").live("click", function(e){
    if ($(this).hasClass("not-selected")) {
      $(this).removeClass("not-selected");
      $(this).addClass("selected");
      $(this).siblings(".image-options-block").removeClass("selected");
      $(this).siblings(".image-options-block").addClass("not-selected");
      var mb = $(this).closest(".media-block");
      mb.addClass("inline");
      mb.find(".media-title").hide();
      mb.find(".media-caption").hide();
//      mb.find(".image-add-options").hide();
      mb.find(".image-add-options").addClass("disabled");
      mb.find(".image-add-options").attr("title","These options are disabled when the image is positioned inline with text");
    }
    return false;
  });
  $(".image-options-block:not('.selected')").live("click", function(e){
    if ($(this).hasClass("not-selected")) {
      $(this).removeClass("not-selected");
      $(this).addClass("selected");
      $(this).siblings(".image-options-inline").removeClass("selected");
      $(this).siblings(".image-options-inline").addClass("not-selected");
      var mb = $(this).closest(".media-block");
      mb.removeClass("inline");
//      mb.find(".image-add-options").show();
      mb.find(".image-add-options").removeClass("disabled");
      mb.find(".image-add-options").find("a").removeAttr("title");
    }
    return false;
  });
*/

  $(".alt-warning").live("click", function(e){
/*
    $(this).siblings(".image").removeAttr("contentEditable").blur();
    $(this).parent().removeAttr("contentEditable").blur();
    $("*[contentEditable]").removeAttr("contentEditable").blur();
    $(this).siblings().add($(this).siblings().children("img")).removeAttr("contentEditable").blur();
*/
    $("#alt-text").data("alt-warning",$(this)).dialog("open");
    return false;
  });

  $("#alt-text").dialog({
    width: 600,
    autoOpen: false,
    modal: true,
    zIndex: 500,
    open: function(){
    },
    close: function(){
    },
    buttons: {
      "OK": function() {
        $(this).dialog("close");
        var altEntered = $("#alt-text").find("textarea").val().trim();
        $("#alt-text").find("textarea").val('');
        if (altEntered.length) {
          $(this).data("alt-warning").replaceWith('<span id="thanks">Thanks!</span>');
          $("#thanks").fadeOut(1450, function(e){
            $(this).remove();
          });
        }
        return false;
      },
      Cancel: function() {
        $(this).dialog("close");
        $("#alt-text").find("textarea").val('');
        return false;
      }
    }
  });

  $(".undo-unelemented a").live("click", function(e){
    $(this).parent().remove();
    return false;
  });

  $("#confirm-unelement").dialog({
    width: 600,
    autoOpen: false,
    modal: true,
    zIndex: 500,
    open: function(){
      var elementtype = $(this).data("elementtype");
      $(this).find("p").html('You have removed the special ' + elementtype + ' formatting, reverting the content to regular paragraphs(s). <strong>Keep this change?</strong>');
    },
    close: function(){
      var original = $(this).data("original");
      $(".unelemented").fadeOut("fast", function(){
        $(this).replaceWith(original.hide())
        original.fadeIn("fast");
      });
//    $(".unelemented").replaceWith($(this).data("original"));
      return false;
    },
    buttons: {
      "OK": function() {
        $(".unelemented").contents().unwrap();
        $(this).dialog("close");
      },
      Cancel: function() {
        $(this).dialog("close");
      }
    }
  });


  $(".media-table-add").live("mouseenter", function(e){
        if ($(this).outerWidth() > 172) {
          $(this).siblings(".media-table-add").find("div").css({
            "display": "block",
            "visibility": "hidden",
          })
          $(this).find("div").show();
        }
  });
  $(".media-table-add").live("mouseleave", function(e){
        $(this).find("div").hide();
        $(this).siblings(".media-table-add").find("div").css({
          "display": "none",
          "visibility": "visible",
        })
  });

/*
  $(".media-table-add").livequery(function(){
    $(this).hoverIntent({
      over: function(e){
      }, 
      out: function(e){
      },
      interval: 300,
    });
  });
*/

  $(".link, .cnxn").live("click", function(e){
//    $("#toolbar-unlink").removeClass("disabled");
    href = $(this).attr("href");
    $(this).append('\<div class="link-options" contenteditable="false">\
        <div class="link-information">\
          <a href="#" class="edit-link-icon" title="Change the link\'s text, location, or other properties"><img src="content_files/edit-link-03.png"/></a>\
          <a href="#" class="edit-link" title="Change the link\'s text, location, or other properties">Edit link</a>\
          <a href="#" class="unlink-link-icon" title="Remove the link, leaving just the text"><img src="content_files/unlink-link-02.png"/></a>\
          <a href="#" class="unlink-link" title="Remove the link, leaving just the text">Unlink</a>\
          <a href="' + href + '" target="_blank" class="visit-link" title="Visit the link in a new window or tab">' + href + '</a>\
          <a href="' + href + '" target="_blank" class="visit-link-icon" title="Visit the link in a new window or tab" style="text-decoration: none;"><img src="helper_files/external-link-03.png"/></a>\
        </div>\
      </div>');
    return false;
  });

  $(".unlink-link, .unlink-link-icon").live("click", function(e){
    var lnk = $(this).closest(".link, .cnxn");
    lnk.replaceWith(lnk.clone().children().remove().end().text());
  });

  $(".link-options").live("click", function(e){
    return false;
  });

  $(".visit-link").live("click", function(e){
    window.open($(this).attr("href"), "_blank");
    return false;
  });

  $("#canvas").on("mouseup", function(e){
    activateToolbar(e);
  });
  $("#canvas").on("keyup", function(e){
    var key = e.keyCode || e.which;
    if (key == 37 || key == 38 || key == 39 || key == 40) {
      activateToolbar(e);
    }
  });

  // Turn different things on and off in toolbar depending on cursor location (currently only on mouseup, not arrow movements)
  function activateToolbar(e) {
    var cn = $(getSelectionContainerElement());
    if (cn.closest(".edhint").length) { // I don't think this is even going to work since .edhint is generated by JS and getSelectionContainerElement() doesn't do well with JS-generated elements
      $("#toolbar-bold").removeClass("selected");
      e.stopPropagation();
    } else {
/*
      if (cn.closest(".link").length || cn.closest(".cnxn").length) {
        $("#toolbar-unlink").removeClass("disabled");
      } else {
        $("#toolbar-unlink").addClass("disabled");
      }
*/
      if (cn.closest(".term").length || cn.closest(".emphasis").length) {
        $("#toolbar-bold").addClass("selected");
      } else {
        $("#toolbar-bold").removeClass("selected");
      }
      if (cn.closest(".table").length) {
        $("#toolbar-table").addClass("disabled");
      } else {
        $("#toolbar-table").removeClass("disabled");
      }
    }
  }

  $(".solution-toggle").live("click", function(e){
    var exer = $(this).closest(".exercise");
    var sol = exer.find(".solution").parent();
    var sts = exer.find(".solution-toggle-show");
    if (sol.is(":hidden")) {
      sts.slideUp("fast");
      sol.slideDown("fast");
    } else {
      sts.slideDown("fast");
      sol.slideUp("fast");
    }
  });
  $(".solution-toggle-hide").live("mouseover", function(e){
    $(this).attr("title","When viewed on the web, solutions will be hidden by default.  Click here to preview how that will appear.");
  });
  $(".answer-toggle").live("click", function(e){
    var ques = $(this).closest(".question");
    var ans = ques.find(".solution").parent();
    var ats = ques.find(".answer-toggle-show");
    if (ans.is(":hidden")) {
      ats.slideUp("fast");
      ans.slideDown("fast");
    } else {
      ats.slideDown("fast");
      ans.slideUp("fast");
    }
  });
  $(".answer-toggle-hide").live("mouseenter", function(e){
    $(this).attr("title","When viewed on the web, answers will be hidden by default.  Click here to preview how that will appear.");
  });

  $("#image-dialog-title .hint-link, #image-dialog-caption .hint-link").live("click", function(e){
    $(this).hide();
    $(this).siblings().show();
    $(this).siblings().children().eq(1).focus();
  });

  $("#image-dialog-title-close, #image-dialog-caption-close").live("click", function(e){
    $(this).parent().hide();
    $(this).siblings().text('\xa0');
    $(this).parent().parent().children(".hint-link").show();
  });


  $(".exercise-header>.cnx_label").live("click", function(e){
    preventSelection();
    $("[class*='-header']").die("mouseenter mouseleave");
    var num = $(this).text().match(/[0-9]+/);
    var label = $(this).text().trim().split(" ")[0];
    $(this).parent().append('<span class="label-list">\
      <span class="cnx_label">Exercise</span>\
      <span class="cnx_label">Homework</span>\
      <span class="cnx_label">Problem</span>\
      <span class="cnx_label">Question</span>\
      <span class="cnx_label">Task</span>\
    </span>\
    ');
    $(this).parent().find(".label-list .cnx_label").each(function(e){
      var txt = $(this).text().trim();
      if (label == txt) $(this).addClass("current");
      $(this).text(txt + " " + num);
    });
    e.stopPropagation();
  });
  $(".exercise-header").livequery(function(){
    $(this).hoverIntent({
      over: function(e){
      }, 
      out: function(e){
        removeLabelList();
      },
      timeout: 500,
    });
  });
  $(".exercise-header .label-list .cnx_label").live("click", function(e){
    preventSelection();
    var txt = $(this).text();
    $(this).closest(".exercise-header").children(".cnx_label").text(txt);
    removeLabelList();
    e.stopPropagation();
  });

  $(".solution-header>.cnx_label").live("click", function(e){
    preventSelection();
    $("[class*='-header']").die("mouseenter mouseleave");
    var label = $(this).text().trim().split(" ")[0];
    $(this).parent().append('<span class="label-list">\
      <span class="cnx_label">Solution</span>\
      <span class="cnx_label">Answer</span>\
    </span>\
    ');
    $(this).parent().find(".label-list .cnx_label").each(function(e){
      var txt = $(this).text().trim();
      if (label == txt) $(this).addClass("current");
    });
    e.stopPropagation();
  });
  $(".solution-header").livequery(function(){
    $(this).hoverIntent({
      over: function(e){
      }, 
      out: function(e){
        removeLabelList();
      },
      timeout: 500,
    });
  });
  $(".solution-header .label-list .cnx_label").live("click", function(e){
    preventSelection();
    var txt = $(this).text();
    $(this).closest(".solution-header").children(".cnx_label").text(txt);
    $(this).closest(".exercise").find(".solution-toggle-show").find(".solution-toggle").text("[ Show " + txt + " ]");
    $(this).closest(".exercise").find(".solution-toggle-hide").find(".solution-toggle").text("[ Hide " + txt + " ]");
    removeLabelList();
    e.stopPropagation();
  });

  $(".note-header>.cnx_label").live("click", function(e){
    preventSelection();
    $("[class*='-header']").die("mouseenter mouseleave");
    var label = $(this).text().trim().split(" ")[0].split(":")[0];
    $(this).parent().append('<span class="label-list">\
      <span class="cnx_label">Note</span>\
      <span class="cnx_label">Aside</span>\
      <span class="cnx_label">Warning</span>\
      <span class="cnx_label">Tip</span>\
      <span class="cnx_label">Important</span>\
    </span>\
    ');
    $(this).parent().find(".label-list .cnx_label").each(function(e){
      var txt = $(this).text().trim();
      if (label == txt) $(this).addClass("current");
    });
    e.stopPropagation();
  });
  $(".note-header .label-list .cnx_label").live("click", function(e){
    preventSelection();
    var txt = $(this).text();
    $(this).closest(".note-header").children(".cnx_label").text(txt);
    removeLabelList();
    e.stopPropagation();
  });
  $(".note-header").livequery(function(){
    $(this).hoverIntent({
      over: function(e){
      }, 
      out: function(e){
        removeLabelList();
      },
      timeout: 500,
    });
  });

  $(".definition-header>.cnx_label").live("click", function(e){
    preventSelection();
    $(this).blur();
    $("[class*='-header']").die("mouseenter mouseleave");
    var label = $(this).text().trim().split(" ")[0].split(":")[0];
    $(this).parent().append('<span class="label-list">\
      <span class="cnx_label">Definition</span>\
      <span class="cnx_label">Key Term</span>\
    </span>\
    ');
    $(this).parent().find(".label-list .cnx_label").each(function(e){
      var txt = $(this).text().trim();
      if (label == txt) $(this).addClass("current");
    });
    e.stopPropagation();
  });
  $(".definition-header").livequery(function(){
    $(this).hoverIntent({
      over: function(e){
      }, 
      out: function(e){
        removeLabelList();
      },
      timeout: 500,
    });
  });
  $(".definition-header .label-list .cnx_label").live("click", function(e){
    preventSelection();
    var txt = $(this).text();
    $(this).closest(".definition-header").children(".cnx_label").text(txt);
    removeLabelList();
    e.stopPropagation();
  });

  $(".example-header>.cnx_label").live("click", function(e){
    preventSelection();
    $("[class*='-header']").die("mouseenter mouseleave");
    var num = $(this).text().match(/[0-9]+/);
    var label = $(this).text().trim().split(" ")[0];
    $(this).parent().append('<span class="label-list">\
      <span class="cnx_label">Example</span>\
      <span class="cnx_label">Case in point</span>\
      <span class="cnx_label">Case Study</span>\
      <span class="cnx_label">Demonstration</span>\
      <span class="cnx_label">Illustration</span>\
    </span>\
    ');
    $(this).parent().find(".label-list .cnx_label").each(function(e){
      var txt = $(this).text().trim();
      if (label == txt) $(this).addClass("current");
      $(this).text(txt + " " + num);
    });
    e.stopPropagation();
  });
  $(".example-header").livequery(function(){
    $(this).hoverIntent({
      over: function(e){
      }, 
      out: function(e){
        removeLabelList();
      },
      timeout: 500,
    });
  });
  $(".example-header .label-list .cnx_label").live("click", function(e){
    preventSelection();
    var txt = $(this).text()
    $(this).closest(".example-header").children(".cnx_label").text(txt);
    removeLabelList();
    e.stopPropagation();
  });

  function removeLabelList(ll,e) {
    preventSelection();
    $(".label-list").remove();
    $("[class*='-header']").live("mouseenter", function(e){
      headerEnter($(this),e);
    });
/*
    $("[class*='-header']").live("mouseleave", function(e){
      headerLeave($(this),desctitle,e);
    });
*/
  }

});

</script>


<style type="text/css">

#editor{
  background-color: #bbb;
  background-color: #c7c7c7;
  background-color: #ccc;
}
#content{
  padding-left: 0em;
  padding-right: 0em;
  padding-bottom: 0em;
padding-top: 0;
}
#pageheader-wrap{
  margin-top: -10px;
  margin-left: 2em;
  margin-right: 2em;
display: none;
}

#workflownav-wrap, #header-wrap{
  display: none;
}

#toolbar{
  height: 42px;
  background-image: url(toolbar/toolbar-bg-01.png);
  background-repeat: repeat-x;
  background-position: 0 0;
  background-color: #fff;
  padding: 0 1em;
  border-bottom: 1px solid #aaa;
  position: relative;
  z-index: 1;
clear: both;
  white-space: nowrap;
position: fixed;
top: 0;
width: 100%;
z-index: 530;
  box-shadow: 0 0 5px #bbb;
  font-size: .9em;
  font-family: tahoma,verdana,arial,helvetica,sans-serif;

  /* following two are part of a hack learned from PatrikAkerstrand at http://stackoverflow.com/questions/5078239/how-to-remove-the-space-between-inline-block-elements */
  letter-spacing: -.31em;
  word-spacing: -.43em;
}

#icon-set{
  padding: 4px 0;
}
.toolbar-function{
  position: relative;
  letter-spacing: normal;
  word-spacing: normal;
  height: 33px;
  width: 33px;
  display: inline-block;
}
.toolbar-function.toolbar-dd{
  width: 17px;
  margin-right: 3px;
}
.toolbar-icon{
  background-image: url(toolbar/toolbar-sprite-08.png);
  outline: 0;
  height: 33px;
  width: 33px;
  display: inline-block;
  letter-spacing: normal;
  word-spacing: normal;
  background-position: -23px -66px;
}
.toolbar-dd .toolbar-icon{
  background-image: url(toolbar/arrow-down-black-06.png);
  width: 17px;
  background-position: 0 0;
}

.disabled a{
  cursor: default;
}

.separator{
  width: 19px;
  height: 33px;
  background-image: url(toolbar/toolbar-sprite-08.png);
  background-position: -3px 0;
  display: inline-block;
  letter-spacing: normal;
  word-spacing: normal;
}

.iconlike{
  padding: 0 6px 0 0;
  display: inline-block;
  letter-spacing: normal;
  word-spacing: normal;
vertical-align: middle;
  height: 48px;
}

.iconlike select{
  width: 9em;
  font-family: tahoma,verdana,arial,helvetica,sans-serif;
}

.iconlike input{
  font-family: tahoma,verdana,arial,helvetica,sans-serif;
}

a.menu-like{
  padding: .3em .4em;
  color: black;
  text-decoration: none;
  white-space: nowrap;
display: block;
}

.menu-like:hover{
  background-color: #ccc;
  background-color: #fff;
}

#hints{
  float: right;
  padding: 1.2em .4em 0;
  padding: .9em 0;
  margin-right: 22px;
}

#hints label{
  font-weight: normal;
}

#hints.selected label{
  background-image: url(content_files/header-hint-07.png);
  background-repeat: repeat-x;
  background-position: left bottom;  
  padding-bottom: .3em;
}

#icon-set{
  padding-right: 10em;
}

#toolbar-undo a                   { background-position: -518px 0; }
#toolbar-undo.disabled a          { background-position: -518px -33px; }
#toolbar-undo.hovered a           { background-position: -518px -66px; }
#toolbar-undo.selected a          { background-position: -518px -99px; }
#toolbar-redo a                   { background-position: -287px 0; }
#toolbar-redo.disabled a          { background-position: -287px -33px; }
#toolbar-redo.hovered a           { background-position: -287px -66px; }
#toolbar-redo.selected a          { background-position: -287px -99px; }
#toolbar-bold a                   { background-position: -56px 0; }
#toolbar-bold.disabled a          { background-position: -56px -33px; }
#toolbar-bold.hovered a           { background-position: -56px -66px; }
#toolbar-bold.selected a          { background-position: -56px -99px; }
#toolbar-italics a                { background-position: -155px 0; }
#toolbar-italics.disabled a       { background-position: -155px -33px; }
#toolbar-italics.hovered a        { background-position: -155px -66px; }
#toolbar-italics.selected a       { background-position: -155px -99px; }
#toolbar-underline a              { background-position: -485px 0; }
#toolbar-underline.disabled a     { background-position: -485px -33px; }
#toolbar-underline.hovered a      { background-position: -485px -66px; }
#toolbar-underline.selected a     { background-position: -485px -99px; }
#toolbar-superscript a            { background-position: -419px 0; }
#toolbar-superscript.disabled a   { background-position: -419px -33px; }
#toolbar-superscript.hovered a    { background-position: -419px -66px; }
#toolbar-superscript.selected a   { background-position: -419px -99px; }
#toolbar-subscript a              { background-position: -386px 0; }
#toolbar-subscript.disabled a     { background-position: -386px -33px; }
#toolbar-subscript.hovered a      { background-position: -386px -66px; }
#toolbar-subscript.selected a     { background-position: -386px -99px; }
#toolbar-link a                   { background-position: -188px 0; }
#toolbar-link.disabled a          { background-position: -188px -33px; }
#toolbar-link.hovered a           { background-position: -188px -66px; }
#toolbar-link.selected a          { background-position: -188px -99px; }
#toolbar-unlink a                 { background-position: -551px 0; }
#toolbar-unlink.disabled a        { background-position: -551px -33px; }
#toolbar-unlink.hovered a         { background-position: -551px -66px; }
#toolbar-unlink.selected a        { background-position: -551px -99px; }
#toolbar-unorderedlist a          { background-position: -584px 0; }
#toolbar-unorderedlist.disabled a { background-position: -584px -33px; }
#toolbar-unorderedlist.hovered a  { background-position: -584px -66px; }
#toolbar-unorderedlist.selected a { background-position: -584px -99px; }
#toolbar-orderedlist a            { background-position: -254px 0; }
#toolbar-orderedlist.disabled a   { background-position: -254px -33px; }
#toolbar-orderedlist.hovered a    { background-position: -254px -66px; }
#toolbar-orderedlist.selected a   { background-position: -254px -99px; }
#toolbar-indent a                 { background-position: -650px 0; }
#toolbar-indent.disabled a        { background-position: -650px -33px; }
#toolbar-indent.hovered a         { background-position: -650px -66px; }
#toolbar-indent.selected a        { background-position: -650px -99px; }
#toolbar-unindent a               { background-position: -683px 0; }
#toolbar-unindent.disabled a      { background-position: -683px -33px; }
#toolbar-unindent.hovered a       { background-position: -683px -66px; }
#toolbar-unindent.selected a      { background-position: -683px -99px; }
#toolbar-table a                  { background-position: -452px 0; }
#toolbar-table.disabled a         { background-position: -452px -33px; }
#toolbar-table.hovered a          { background-position: -452px -66px; }
#toolbar-table.selected a         { background-position: -452px -99px; }
#toolbar-image a                  { background-position: -122px 0; }
#toolbar-image.disabled a         { background-position: -122px -33px; }
#toolbar-image.hovered a          { background-position: -122px -66px; }
#toolbar-image.selected a         { background-position: -122px -99px; }
#toolbar-math a                   { background-position: -221px 0; }
#toolbar-math.disabled a          { background-position: -221px -33px; }
#toolbar-math.hovered a           { background-position: -221px -66px; }
#toolbar-math.selected a          { background-position: -221px -99px; }
#toolbar-olist-options .toolbar-icon                  { background-image: url(toolbar/arrow-down-black-06.png); background-position: 0 0; }
#toolbar-olist-options.disabled .toolbar-icon         { background-image: url(toolbar/arrow-down-black-06.png); background-position: 0 0; }
#toolbar-olist-options.hovered .toolbar-icon          { background-image: url(toolbar/arrow-down-black-07.png); background-position: 0 0; }
#toolbar-olist-options.selected .toolbar-icon         { background-image: url(toolbar/arrow-down-black-08.png); background-position: 0 0; }
#toolbar-table-options .toolbar-icon                  { background-image: url(toolbar/arrow-down-black-06.png); background-position: 0 0; }
#toolbar-table-options.disabled .toolbar-icon         { background-image: url(toolbar/arrow-down-black-06.png); background-position: 0 0; }
#toolbar-table-options.hovered .toolbar-icon          { background-image: url(toolbar/arrow-down-black-07.png); background-position: 0 0; }
#toolbar-table-options.selected .toolbar-icon         { background-image: url(toolbar/arrow-down-black-08.png); background-position: 0 0; }


.btn-toolbar [class^="icon-"]{
  height: 30px !important;
  width: 31px !important;
  background-image: url(toolbar/toolbar-sprite-08.png);
}
.dropdown-toggle{
  height: 33px;
  width: 6px
}
.icon-table-insert{ background-position: -453px -2px; }
.icon-unordered-list{ background-position: -585px -2px; }
.icon-ordered-list{ background-position: -255px -2px; }
.icon-indent-list{ background-position: -651px -35px; }
.icon-unindent-list{ background-position: -684px -35px; }
.btn{
  font-size: 1em;
  line-height: normal;
  padding: 0;
}
.dropdown-menu{
  box-shadow: 0 3px 5px rgba(0,0,0,.12);
}
.btn:hover .icon-table-insert{ background-position: -453px -68px; }
.btn:hover .icon-unordered-list{ background-position: -585px -68px; }
.btn:hover .icon-ordered-list{ background-position: -255px -68px; }
.btn:hover .icon-indent-list{ background-position: -651px -35px; }
.btn:hover .icon-unindent-list{ background-position: -684px -35px; }

#toolbar-table.selected .toolbar-icon{
  box-shadow: 2px 2px 2px #aaa;
}
/*
#toolbar-table-options.selected a{
  box-shadow: 2px 2px 2px #aaa;
}
*/
.toolbar-dd.selected .toolbar-icon{
  box-shadow: 2px 2px 2px #aaa;
}

#editor-mode{
  font-size: .85em;
  position: relative;
  z-index: 2;
  height: 30px;
background-color: #666;
display: none;
}

#editor-mode ul, #editor-mode li{
  margin: 0;
  padding: 0;
  display: block;
}

#editor-mode ul{
  position: absolute;
  right: 17px;
  bottom: 0;
}

#editor-mode li{
  float: right;
  padding: .35em 0 .4em;
}

#editor-mode a{
  padding: .5em 1em;
  padding: .35em 1em .4em;
  border: 1px solid #aaa;
  background-color: #eee;
  background-color: #ccc;
  text-decoration: none;
  color: black;
  outline: 0;
  margin-left: -1px;
  color: #666;
font-weight: bold;
}

#editor-mode a:hover{
  color: #000;
}

#editor-mode .current a{
  color: black;
  cursor: default;
  background-color: #fff;
  border-bottom: 1px solid #fff;
  font-weight: bold;
}

#sidebar{
  float: left;
  position: fixed;
  margin: 1em 25px;
  margin: 0 25px 1em;
  width: 200px;
  font-family: tahoma,verdana,arial,helvetica,sans-serif;
}

#sidebar dl{
  background-color: #eee;
  margin: 0 0 15px;
  padding: 0;
  border: 1px solid #aaa;
  box-shadow: 0px 0px 5px #9f9f9f;
  box-shadow: 0px 0px 5px #aaa;
  box-shadow: 0px 0px 5px #bbb;
background-color: transparent;
box-shadow: none;
border-width: 0;
}

#sidebar dt{
  margin: 0;
  font-weight: bold;
/*
  background-image: url(toolbar/toolbar-bg-01.png);
  background-repeat: repeat-x;
  background-position: 0 0;
  background-color: #999;
  background-color: #666;
  background-color: #888;
  border-bottom: 1px solid #333;
*/
  border-bottom: 1px solid #666;
  border-bottom: 1px solid #999;
  color: white;
  color: #000;
/*
margin-bottom: .5em;
border-radius: .5em;
*/
/*
border-top-left-radius: .5em;
border-top-right-radius: .5em;
*/
  font-family: tahoma,verdana,arial,helvetica,sans-serif;
  font-weight: normal;
  font-size: 1.3em;
  margin-top: 0;
/*
  padding: .3em .7em;
*/
  padding: 0 0 .1em;
  margin-bottom: .5em;
}

#sidebar dt a{
  text-decoration: none;
  color: black;
  color: white;
  display: block;
  padding: .25em .5em;
  padding: .25em 1.5em .25em .5em;
  background-image: url(toolbar/arrow-down-white-02.png);
  background-repeat: no-repeat;
  background-position: right .35em;
}

#sidebar dd{
  margin: 0;
/*
  padding: .5em 1em;
padding: .75em .75em !important;
  background-color: #ccc;
  background-color: #eee;
background-color: transparent;
background-color: #ddd;
border: 1px solid #999;
*/
border-top-width: 0;
/*
border-bottom-left-radius: .5em;
border-bottom-right-radius: .5em;
*/
}

#artboard{
  overflow: auto;
}

#canvas{
  margin: 1em 25px 2em 250px;
  background-color: #fff;
  border: 1px solid #aaa;
  padding: 2em;
padding: 30px;
  box-shadow: 0px 0px 10px #9f9f9f;
  cursor: text;
  min-height: 100%;
/*
position: relative;
*/
}



/* =============== from earlier mock-ups (edited) ================ */


.example, .definition .example, .rule .example, #canvas .note{
  margin: 0;
  padding: 0;
}

#canvas .note{
  border-color: transparent;
}

.canvas-wrap{
  margin: 1em -20px;
  margin: 1em -10px 1em -10px;
}

.canvas-wrap .canvas-wrap{
  padding-left: 0;
  padding-right: 0;
  margin: 0 .5em 0 1em;
margin: 0 .5em 0 0;
margin: 0 .5em 0 -10px;
margin: 0 -36px 0 -11px;
}

.canvas{
  border: 1px solid transparent;
}
#canvas .canvas-hovered{ /* #canvas ancestor only for override issues */
  border-color: #bbb #ccc;
  border-color: #c8c8c8;
  border-style: dotted;
}


.title .hint-text, .term .hint-text{
  display: none;
}
.header-hovered .hint-text{
  display: inline;
}
.definition-header .hint-text{
  display: inline !important;
}
/*
.header-hovered.definition-header .hint-text img{
  display: none;
}
*/
.definition-header .hint-text img{
  vertical-align: middle;
  padding-left: .75em;
  cursor: default;
}

.solution.canvas, .proof.canvas, .statement{
  margin-left: 1.5em;
margin-left: 0;
}

.canvas-inner{
  position: relative;
  min-height: 35px;
  padding: .5em;
  padding-left: .75em;
  padding: .5em 1em;
  padding: .5em 30px .5em .75em;
  padding: .5em 25px .5em 20px;
  padding: .5em 25px .5em 10px;
  padding: .5em 35px .5em 10px;
}

/*
.active{
  border: 1px dotted #bbb !important;
  background-image: url('source-files/cursor-01.gif');
  background-repeat: no-repeat;
  background-position: .75em 1em;
}
*/

.equation-number{
  right: 1em;
  top: 40%;
  right: 30px;
  right: 25px;
}

.canvas-buddy{
  position: absolute;
  left: 47%;
  top: -4px;
  height: 13px;
  width: 50px;
  cursor: url(content_files/openhand.cur), default;
  display: none;
  overflow: hidden;
}

.dragging{
  cursor: url(content_files/closedhand.cur), default !important;
}

.canvas-buddy a{
}

.canvas-buddy img{
  display: block;
}

/*
.nodrag{
  cursor: not-allowed !important;
}

.nodrag img{
  opacity: .5;
}
*/

.canvas-buddy-2{
  position: absolute;
  top: 0;
  left: auto;
  right: 0;
  display: none;
  height: 100%;
  background-color: #f7f7f7;
  border-left: 1px solid #ddd;
  width: 19px;
}

.canvas-buddy a, .canvas-buddy-2 a{
  text-decoration: none;
}

.section-header{
  position: relative;
  padding: 0;
  border-width: 0;
}

.cth-list-item{
  color: #369;
}

.cth-list-h2{
  letter-spacing: -1px;
}

h3.section-header, .cth-list-h3{
  font-size: 1.25em !important;
  letter-spacing: normal;
}

h4.section-header, .cth-list-h4{
  font-size: 1em !important;
  letter-spacing: normal;
}

.cth-list-regular{
  color: #000;
  letter-spacing: normal;
}

.remove-element{
  position: absolute;
  top: 1px;
  left: 1px;
  cursor: pointer;
  right: 15px;
}
.drag-element{
/*
cursor: move;
cursor: grab;
cursor: -moz-grab;
cursor: -webkit-grab;
cursor: url(https://mail.google.com/mail/images/2/openhand.cur), grab, -moz-grab, -webkit-grab, move, default;
*/
cursor: url(content_files/openhand.cur), default;
}
/*
.nodrag .drag-element{
  cursor: not-allowed;
}
*/
.edit-element, .unelement-element{
  position: absolute;
  top: 25px;
  cursor: pointer;
  padding: 2px;
left: 1px;
  height: 13px;
  width: 13px;
  height: 14px;
  width: 14px;
/*
  overflow: hidden;
*/
}
.edit-element img, .unelement-element img{
  width: 13px;
  height: 13px;
  width: 14px;
  height: 14px;
  float: left;
}
.unelement-element{
  top: 49px;
}

.to-remove *{
  color: #999 !important;
  color: #bbb !important;
  background-color: transparent !important;
}
.to-remove .edhint, .to-remove .table table, .to-remove .table td, .to-remove .table th{
  border-color: #bbb !important;
}
.to-remove table{
  border-color: #bbb !important;
}

.to-remove img{
  opacity: .25;
}
.to-remove .remove-element img{
  opacity: 1;
}

tr td.current-cell, tr th.current-cell{
  background-image: url("content_files/test-server-background.png") !important;
  background-color: #E5EEF5;  
}

.table-to-remove img{
  opacity: .25;
}
td.table-to-remove, th.table-to-remove, 
tr.table-to-remove td, tr.table-to-remove th{
  color: #bbb;
  background-image: url("content_files/delete-table-element-01.png");
  background-color: #888 !important;
}

.add-row-before{
  border-top: 15px solid #C5DAE9;
}
.add-row-after{
  border-bottom: 15px solid #C5DAE9;
}
th.add-column-before, td.add-column-before{
  border-left: 30px solid #C5DAE9 !important;
}
th.add-column-after, td.add-column-after{
  border-right: 30px solid #C5DAE9 !important;
}



.active>div>.canvas-buddy, .active>div>.canvas-buddy-2{
  display: block;
/*
  border-style: solid;
  border-color: #999;
  background-color: #ddd;
  border-style: solid;
*/
/*
  opacity: .5;
*/
}
/*
.active>div>.canvas-buddy{
  opacity: .75;
}
.active>div>.canvas-buddy:hover, .active>div>.canvas-buddy-2:hover{
  opacity: 1;
}
*/

#canvas .section-header, .cth-list-h2{
  font-size: 1.65em;
}
#canvas .section .section .section-header, .cth-list-h3{
  font-size: 1.25em;
}

.cnx_label{
  cursor: default;
}

.dragged .cnx_label{
  font-size: .65em !important;
}

.exercise{
  margin: 0;
  padding: 0;
}

.add-solution{
  margin: -.5em 20px 1em 3em;
  margin: -.5em 20px 1em 3em;
  margin: -1.5em 20px .5em 3em;
  margin: 0 0 .5em 2em;
  border: 1px dashed #ccc;
  padding: .5em 1em;
  padding: .2em .5em;
  cursor: text;
visibility: hidden;
}

#canvas .add-solution a{
  color: #888;
  text-decoration: none;
  cursor: text;
}

.add-meaning,
.add-answer,
.add-solution-2{
  margin: 0 0 .5em 3em;
margin: 0 0 .5em;
  border: 1px dashed #ccc;
  padding: .2em .5em;
  cursor: text;
  display: none;
}

#canvas .add-solution-2 a, #canvas .add-answer a, .hint-text, .math-source-hint-text, #canvas .add-meaning a{
  color: #888;
  color: #555;
  text-decoration: none;
  cursor: default;
  cursor: pointer;
  cursor: text;
  font-style: italic;
  font-weight: normal;
}

/*
.exercise-header .hint-text, .example-header .hint-text, .add-solution-2, .add-answer, .add-meaning{
  font-size: .85em;
}

.table-caption-hint-text{
  font-size: .95em;
}
*/

.exercise-hint-text, .example-hint-text, .note-hint-text, .definition-hint-text{
  display: block;
  margin: 1.25em 0 1.5em;
  font-size: 1.1em;
}

.definition-hint-text{
  margin: 0;
}

.MathJax .hint-text{
  cursor: default;
}

.math-source-hint-text{
  font-family: tahoma;
}

.drag{
  position: absolute;
  margin-top: 0;
  margin-left: 680px;
  width: 150px;
  border: 1px solid #bbb;
  border-left-width: 0;
  z-index: 3;
  background-color: #f2f2f2;
  padding: 10px;
}

.drag ul, .drag li{
  margin: 0;
  padding: 0;
  list-style: none;
  float: left;
}

.drag ul a{
  width: 55px;
  text-decoration: none;
  border-radius: 4px;
  border: 1px solid #ccc;
  margin: .5em .5em 0em 0;
  display: block;
  padding: .25em .5em;
  background-color: #e3e3e3;
  color: #000;
cursor: url(content_files/openhand.cur), default;
}

.drag ul a:hover{
  background-color: #fff;
}

.drag h2{
  font-size: 1.15em;
  margin-bottom: .25em;
  color: #666;
}

.drag .help{
  float: right;
}

.add-glossary{
  clear: both;
  font-size: .9em;
  padding-top: .5em;
}

.add-glossary span{
  clear: both;
  margin-top: .5em;
  border-top: 1px solid #bbb;
  padding-top: .75em;
  display: block;
}

/* ============== end earlier mock-ups =============== */

#pedagog ul, #pedagog li, #pedagog dd{
  padding:  0;
  margin: 0;
  list-style-type: none;
  clear: right;
  position: relative;
}

/*
#pedagog dd{
  margin-left: 1em;
}
*/

#pedagog .node, #pedagog .pedagog-glossary{
  padding: .5em;
  display: block;
  background-color: #eee;
  border-bottom: 1px solid #999;
  text-decoration: none;
  color: black;
border-radius: 7px;
border: 1px solid #999;
margin-bottom: .5em;
padding-left: .75em;
  position: relative;
  z-index: 1;
  box-shadow: 0 0 #aaa;
}

#pedagog .node{
cursor: url(content_files/openhand.cur), default;
}

.plus{
  visibility: visible;
  color: #999;
  display: none;
}

#pedagog .hovered .node{
  background-color: #C5DAE9;
/*
-webkit-transform: skew(-15deg);
-moz-transform: skew(-15deg);
-o-transform: skew(-15deg);
-ms-transform: skew(-15deg);
margin-left: .25em;
z-index: 2;
*/
/*
  left: .4em;
  top: .2em;
  box-shadow: -.4em -.2em #aaa;
*/
}
#pedagog .hovered .count{
  background-color: #DFE7EC;
/*
-webkit-transform: skew(-15deg);
-moz-transform: skew(-15deg);
-o-transform: skew(-15deg);
-ms-transform: skew(-15deg);
margin-left: .25em;
position: relative;
z-index: 3;
*/
/*
  left: .4em;
  top: .2em;
  position: relative;
  z-index: 2;
*/
}

#pedagog node.pedagog-click{
  background-color: #ccc;
}

#pedagog .count{
  float: right;
/*
  padding: .5em 0;
*/
  color: #666;
  font-size: 1em;
  background-color: #eee;
  border-left: 1px dotted #bbb;
  position: relative;
border: 1px solid #999;
  border-left: 1px dotted #bbb;
border-top-right-radius: 7px;
border-bottom-right-radius: 7px;
}

#pedagog .count-total{
  text-decoration: none;
  color: #000;
  padding: .5em;
  float: right;
padding: .5em;
}

#pedagog .count-total-hover{
  background-color: #555;
  color: white;
  border: 1px solid #555;
  margin-top: -1px;
  margin-left: -1px;
}

.zero{
  display: none;
}

.count-arrow{
  background-image: url(helper_files/gray-arrow-01.png);
  background-repeat: no-repeat;
  background-position: 100% center;
  position: absolute;
  left: 100%;
  top: -1px;
  z-index: 451;
}

.node-list{
  display: none;
  position: absolute;
  left: 100%;
  top: -1px;
  background-color: white;
  white-space: nowrap;
  padding: .75em 1.5em;
  border: 1px solid #aaa;
  box-shadow: 0px 0px 5px #aaa;
  box-shadow: 2px 2px 5px -2px #aaa;
  z-index: 450;
}

.node-list a{
  color: #369;
}

.node-list strong{
  color: black;
  display: block;
  margin-bottom: .5em;
}

.pedagog-glossary{
  background-color: #e3e3e3 !important;
  cursor: default;
background-color: transparent !important;
border-width: 0 !important;
padding: .5em 0 0 !important;
}

.glossary-container{
  display: none;
}

.convert-to-header .emphasis, .section-header .title{
  display: inline-block;
  position: relative;
  padding-bottom: 10px;
  margin-bottom: -10px;
}

dfn.term, .emphasis{
  position: relative !important;
  padding-bottom: 10px;
}

/*
dfn.term *, .emphasis *{
*/
.ctt-list, .ctt-list-item, .ctt-list-item-submenu{
/* The following to prevent everythign in the dropdown list from suddenly getting selected when an item is clicked. */
/* Hmmm, they don't seem to work unless on the above element, which prevents selecting that text. */
-moz-user-select: none !important;
-khtml-user-select: none !important;
user-select: none !important;
}

.emphasis .edhint, .section-header .edhint, .term .edhint{
  width: 100%;
  height: 15px;
  height: 20px;
  position: absolute;
  top: 100%;
  left: 0;
  z-index: 3;
/*
  border-bottom: 1px dashed #FF9900;
*/
  background-image: url(content_files/header-hint-07.png);
  background-repeat: repeat-x;
  background-image: url(content_files/menu-hint-03.png);
  background-repeat: no-repeat;
  background-position: 0 1px;
  background-position: 0 5px;
  background-position: 0 0;
  cursor: default;
  margin-top: -10px;
  cursor: pointer !important;
-moz-user-select: none;
-khtml-user-select: none;
user-select: none;
}

.section-header .edhint{
  margin-top: -12px;
}

.chevrons{
  width: 100%;
  height: 100%;
  display: block;
  background-image: url(content_files/menu-hint-chevrons-middle-01.png);
  background-repeat: no-repeat;
  background-position: center 0;
}

.convert-to-header .edhint img, .title .edhint img, .term .edhint img, .emphasis .edhint img{
/*
  float: right;
*/
  position: absolute;
  right: 0;
  top: 0;
  margin-top: -1px;
  margin-top: 1px;
  margin-top: 5px;
  margin-top: 5px;
  margin-top: 0;
  margin-right: -7px;
  margin-right: -5px;
  padding-right: 1.35em;
  margin-right: -1.35em;
  paddin-bottom: .5em;
}

/*
.emphasis.edhinted{
  box-shadow: 3px 3px 3px #eee;
  display: inline-block;
}
*/

.cth-list, .cth-list li, .ctt-list, .ctt-list li{
  display: block;
  padding: 0;
  margin: 0 !important;
  list-style-type: none;
  white-space: nowrap;
}
.cth-list, .ctt-list{
  position: absolute;
  z-index: 4;
  top: 100%;
  left: 0;
  margin-top: 1px !important;
  margin-top: -9px !important;
  padding: .3em !important;
  background-color: #fff;
  border: 1px solid #999;
  min-width: 100%;
  box-shadow: 3px 3px 3px #eee;
  background-color: #fff;
  /* undo effects of ancestors */
  font-weight: normal;
  font-style: normal;
  text-decoration: none;
  color: black;
  letter-spacing: normal;
}
h2 .cth-list{
  font-size: .6em;
}
h3 .cth-list{
  font-size: .8em;
}
h4 .cth-list{
  font-size: 1em;
}
.cth-level{
  display: block;
}

.ctt-list-title{
  font-size: .85em;
  text-transform: uppercase;
  font-weight: bold;
  color: #777;
  padding-right: .5em;
}

li.cth-list-item, li.ctt-list-item, .ctt-list-submenu li{
  border: 1px solid #ccc;
  margin-top: -1px !important;
  font-weight: bold;
  padding: .5em 0 .5em 30px;
  cursor: pointer;
  background-color: #E5EEF5;
  white-space: nowrap;
  position: relative;
}

.ctt-list-submenu li{
  border-color: #bbb;
}

li.cth-list-item:hover, li.ctt-list-item:hover, .ctt-list-submenu li:hover{
  background-color: #C5DAE9;
  border-color: #1B86D2;
  z-index: 5;
}

li.cth-list-item.selected, li.ctt-list-item.selected{
  background-image: url(content_files/checkmark-01.png);
  background-repeat: no-repeat;
  background-position: 6px center;
}

.ctt-list .ctt-level{
  display: block !important;
  padding-right: 30px;
  box-sizing: border-box;
}
.ctt-list-item.selected .ctt-level{
  background-image: url(toolbar/right-arrow-01.png);
  background-repeat: no-repeat;
  background-position: right center;
}

.ctt-list-term{
  position: relative;
  z-index: 5;
}
.ctt-list-submenu{
  position: absolute;
  left: 100%;
  top: 0;
  margin: 0 !important;
  box-shadow: 3px 3px 3px #eee;
}

.ctt-list-submenu li{
  padding-left: 1em;
  padding-right: 1em;
  margin: 0;
  font-weight: normal;
  z-index: 3 !important;
}

li.cth-list-item.disabled, 
li.cth-list-item.disabled:hover, 
li.ctt-list-item.disabled, 
li.ctt-list-item.disabled:hover{
  color: #bbb;
  background-color: #eee;
  border-color: #ccc;
  cursor: default;
  cursor: not-allowed;
}

li.cth-list-help, li.ctt-list-help{
  letter-spacing: normal;;
  padding-bottom: .5em;
  padding-left: .15em;
  white-space: nowrap;
  padding-right: 2em;
}

li.cth-list-help a, li.ctt-list-help a{
  float: right;
  margin-right: -2em;
}

li.cth-list-help-text-wrap, li.ctt-list-help-text-wrap{
  position: absolute;
  left: 100%;
  top: -1px;
  margin-top: -1px;
  margin-left: 1px;
  width: 279px; /* 250 + padding + border + shadow */
  white-space: normal;
  overflow: hidden;
}

.cth-list-help-text, .ctt-list-help-text{
  background-color: white;
  padding: 6px 12px 0;
  border: 1px solid #999;
  width: 250px;
  box-shadow: 3px 3px 3px #ccc;
  position: absolute;
  left: -250px;
  top: 0;
  height: auto;
  display: none;
}

.cth-list-help-text-close, .ctt-list-help-text-close{
  float: right; 
  margin-left: 1.25em;
  font-weight: normal;
  font-size: 1.4em;
  margin-top: 0em;
  cursor: pointer;
}

.cth-list-help-text p, .ctt-list-help-text p{
  margin: .3em 0 .75em !important;
}

.section{
  margin-top: 0;
}

.note-contents{
  display: inline;
}

.equation-contents, .table .canvas-inner{
  text-align: center;
  padding-top: .75em;
}

.table .canvas-inner{
  padding-top: 1.25em;
}

.table th{
  background-color: #f3f3f3;
}

.para{ 
/*
 margin: .5em 0 !important;
*/
}

.droppable-all, .droppable-all-existing{
  position: absolute;
  width: 100%;
  height: 1px;
  border: 1px dashed transparent;
  border-width: 1px 0;
  margin-top: -.4em;
}

.droppable-active{
  background-repeat: repeat-x;
  background-position: center center;
}

/*
.droppable-all-existing.canvas-wrap{
  background-color: #f0f;
}
*/

.droppable-hover{
  background-color: #C5DAE9;
  cursor: copy;
  border: 1px dashed #1b86d2;
  position: relative;
  z-index: 3;
  margin: .5em 0;
  left: -1px;
}

.dragged{
  position: relative;
  z-index: 4;
  border: 1px solid #666;
  padding: .5em 1em;
  width: 400px;
  background-color: white;
  border-radius: 7px;
/*
-webkit-transform: skew(-15deg);
-moz-transform: skew(-15deg);
-o-transform: skew(-15deg);
-ms-transform: skew(-15deg);
*/
}

.dragged h2, .dragged .para{
  margin: 0 !important;
}

.dragged .exercise{
  margin: 0;
}

.dragged *{
  display: inline !important;
}

.no-drop{
  cursor: no-drop !important;
}
.copy-draggable{
  cursor: copy !important;
}

.content-editable, .content-editable-2{
  outline: 0;
}

.ui-dialog{
  font-size: 1em;
  font-family: tahoma, verdana, arial, helvetica, sans-serif;
  box-shadow: 0px 0px 5px #aaa;
padding: 0;
}

.ui-dialog .ui-widget-header{
  background-image: none;
  background-color: #C5DAE9;
  border-width: 0 0 1px;
}

.element-being-edited{
  background-color: #E5EEF5 !important;
  border-color: #C5DAE9;
}

.ui-dialog .ui-dialog-buttonpane{
  border-top-width: 0;
  margin-top: 0;
  padding-top: 0;
}

.element-options hr{
  height: 1px;
  background-color: #ddd;
  color: #ddd;
  border-width: 0;
  margin: 1em 0;
}

.element-options-tabs, .element-options-tabs li{
  display: block;
  margin: 0;
  padding: 0;
  list-style-type: none;
}

.element-options-tabs{
  margin: 1em 0 0;
  padding: 4px 0 3px;
}

.element-options-tabs li{
  font-size: .85em;
  float: left;
  border: 1px solid #888;
  border-bottom-width: 0;
  margin-right: -1px;
}

.element-options-tabs a{
  padding: 5px 1em 5px;
  position: relative;
  z-index: 609;
  text-decoration: none;
  display: block;
  color: #444;
  font-weight: bold;
  outline: 0;
  background-color: #f3f3f3;
}

.element-options-tabs li.selected a{
  z-index: 611;
  border-bottom: 1px solid #fff;
  background-color: #fff;
  color: #000;
}

.element-options-contents{
  margin: -1px 0 .5em;
  border: 1px solid #888;
  padding: 1em 1em 1em;
  position: relative;
  z-index: 610;
  clear: left;
  top: -1px;
}

span.cnx_label{
  font-size: .9em;
  color: #369;
  text-transform: uppercase;
  font-weight: bold;
  font-family: arial, helvetica, sans-serif;
}

.element-options fieldset{
  margin: 1em 0 0;
}

.element-options legend{
  font-weight: bold;
}

clear-text-from-input{
  color: #666;
}

#canvas .problem, #canvas .commentary{
  margin: 0;
}

.MathJax{
  cursor: default;
  position: relative;
  padding: .5em .2em;
  padding: .4em 0;
  border: 1px solid transparent;
display: inline-block;
}

.MathJaxText, .math-style{
  font-style: italic;
  font-size: 1.3em;
  font-family: serif; 
}

.MathJax.selected{
  background-color: #E5EEF5;
  background-color: #c5dae9 !important;
  background-color: #D4E3EE !important;
  background-color: #D9E7F1 !important;
  border: 1px dotted #C5DAE9 !important;
  border: 1px dotted #1B86D2 !important;
}

.MathJax.hovered{
  background-color: #E5EEF5;
/*
  background-color: #f3f3f3;
  background-color: #f9f9f9;
*/
  border: 1px dotted #ddd;
}

.ascii-notation{
  display: none;
}

/*
.asciimath{
  font-family: courier new;
}
*/

.MathJax.errored .ascii-notation, .MathJax.errored .MathJaxText{
  color: #c00;
}

.MathJax.unmathified{
  background-color: transparent !important;
  border-color: #999 !important;
}

.MathJax.unmathified .ascii-notation, .MathJax.unmathified .MathJaxText{
  color: #000;
}

.MathJax.to-remove{
  border-color: #c8c8c8 !important;
  background-color: #f7f7f7 !important;
}


.math-icon{
  display: none;
}

.math-icon-message{
  display: none;
  border: 1px solid #444;
  background-color: #f2f2f2 !important;
  color: #000 !important; /* because of .to-remove class */
  padding: .1em .5em !important;
  position: absolute;
  z-index: 2;
  left: 130%;
  top: 0;
  font-size: .85em;
  white-space: nowrap;
  border-radius: 3px;
}

.math-icon-message-close{
  font-weight: bold;
  padding-right: .3em;
  font-size: 1.1em;
  vertical-align: baseline;
}

.math-icon.hovered{
  background-image: url(content_files/remove-element-07.png) !important;
}

.math-icon.hovered .math-icon-message{
  display: block;
}

#math-icon-edit .math-icon-message{
  top: auto;
  bottom: 0;
  right: 130%;
  left: auto;
}

.MathJax #math-icon-clear{
  position: absolute;
right: -24px;
width: 24px;
right: -20px;
width: 20px;
height: 50%;
min-height: 20px;
top: -1px;
  background-image: url(content_files/remove-element-01.png);
  background-repeat: no-repeat;
  background-position: right top;
  cursor: pointer;
}

.MathJax #math-icon-edit{
  position: absolute;
left: -20px;
width: 20px;
height: 100%;
top: 2px;
  background-image: url(content_files/pencil-02.png);
  background-repeat: no-repeat;
  background-position: right bottom;
cursor: pointer;
}

/*
.MathJax *{
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  user-select: none;
}
*/

.math-editor{
  width: 350px;
  width: 400px;
  width: 500px;
  width: 520px;
  border: 1px solid #1b86d2;
  background-color: #c5dae9;
  position: absolute;
  z-index: 400;
left: -50%;
left: -150px;
  bottom: -30%;
  bottom: 100%;
  padding: 10px;
  box-shadow: 0px 0px 5px #aaa;
  text-align: left;
/*
   -moz-user-select: none !important;
   -moz-user-focus: none !important;
*/
  font-weight: normal;
}

/*
.math-editor *{
  position: relative;
  z-index: 402;
}
*/

.math-editor:after { /* Taken from "sandeep" at http://stackoverflow.com/questions/9450733/css-triangle-custom-border-color */
  content: '';
  display: block;
  position: absolute;
  z-index: 401;
bottom: -14px;
right: 200px;
right: 250px;
right: 260px;
  width: 25px;
  height: 25px;
  background: #C5DAE9;
  border-right:1px solid #1b86d2;
  border-bottom:1px solid #1b86d2;
  -moz-transform:rotate(45deg);
  -webkit-transform:rotate(45deg);
}

#math-editor-help{
  float: right;
  position: relative;
  z-index: 404;
  font-size: .85em;
  padding-left: 10px;
}

.math-source{
  border: 1px inset #1b86d2;
  background-color: #fff;
  padding: .1em .3em;
  margin-bottom: .5em !important;
  cursor: text;
  margin-right: 4em;
  display: block;
  font-family: courier new;
}

.math-source-wrap{
  position: relative;
  z-index: 403;
}

/*
#math-advanced{
  margin-top: .5em;
  padding-top: .5em;
  border-top: 1px solid #A1B2BF;
  clear: both;
  display: none;
}

#math-advanced label{
  padding-right: .5em;
}

#math-advanced input{
  padding: 0;
  vertical-align: top;
  margin: 0;
}
*/

.math-help{
  padding-left: 0em;
  cursor: pointer;
  font-size: .85em;
}

.math-help-text-wrap{
  position: absolute;
  left: 100%;
  top: 0;
  margin-top: -1px;
  margin-left: 1px;
  width: 279px; /* 250 + padding + border + shadow */
  overflow: hidden;
}

.math-help-text{
  background-color: white;
  padding: 6px 12px;
  border: 1px solid #999;
  width: 250px;
  box-shadow: 3px 3px 3px #ccc;
  position: absolute;
  left: -250px;
  top: 0;
  height: auto;
  display: none;
  line-height: normal;
}

#math-error{
  border: 1px solid #c00;
  background-color: #FFF6D1;
  border-bottom: 0;
  background-color: #fee;
  color: #c00;
  position: absolute;
  bottom: 100%;
  display: none;
  padding: 6px 12px;
  width: 100%;
  left: 0;
/*
  box-shadow: -3px -3px 3px #ccc;
*/
}

.math-help-text-close{
  float: right; 
  margin-left: 1.25em;
  font-weight: normal;
  font-size: 1.4em;
  margin-top: -.1em;
  cursor: pointer;
}

/*
.math-help-text a{
  color: #444 !important;
}
*/

#math-done{
  text-align: right;
/*
  position: relative;
  z-index: 403;
*/
  margin-top: .5em;
}

.math-done{
  border: 1px outset #999 !important;
  font-size: 1em;
  padding: .15em .5em !important;
}


#cheat-sheet-activate, #unmathify-activate{
  font-size: 1em;
  font-weight: normal;
  padding-left: 1em;
}
#unmathify-activate{
  font-size: .85em;
}
#cheat-sheet-activate label, #unmathify-activate label, #radio_plain_label{
  font-weight: normal;
}

.math-options{
  float: left;
}

.math-options .math-help{
  padding-left: .5em;
  padding-right: 1.5em;
}

/*
.math-editor-help{
  text-align: right;
  font-size: .85em;
}
*/

#cheat-sheet-wrap{
  width: 100%;
  position: fixed;
  bottom: 0;
  color: #ddd;
  display: none;
  z-index: 454;
}

#cheat-sheet{
  border-top: 1px solid black;
/*
  border-top-left-radius: 10px;
  border-top-right-radius: 10px;
*/
  padding: .5em 1em 1em;
  background-color: #444;
display: none;
/*
  box-shadow: -5px 0 10px #999;
*/
  box-shadow: -10px 0 10px #bbb;
}

#cheat-sheet-close{
  float: right;
  cursor: pointer;
}

#cheat-sheet-open{
  float: right;
  background-color: #444;
  padding: .25em 1em;
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
  cursor: pointer;
}

#cheat-sheet-title{
  margin-bottom: .75em;
}

#cheat-sheet-type{
  float: left;
  white-space: nowrap;
  margin-right: 1em;
}

#cheat-sheet-type label{
  font-weight: normal;
}

.cheat-sheet-values{
  background-color: #fff;
  overflow-x: auto;
  color: #000;
}

.cheat-sheet-values table{
  font-family: courier new, courier;
  border-width: 0;
  border-collapse: collapse;
}
.cheat-sheet-values td{
  border-width: 0;
  border-right: 1px solid #444;
  border-bottom: 1px solid #ccc;
  text-align: center;
  white-space: nowrap;
}

.icon-flyout{
  position: absolute;
  top: 33px;
  left: 0;
  background-color: #e2e2e2;
  border: 1px solid #b9b9b9;
  border-bottom-color: #999;
  border-right-color: #999;
  box-shadow: 0px 0px 5px #aaa;
  box-shadow: 3px 3px 5px #aaa;
  box-shadow: 2px 2px 3px #aaa;
  padding: .75em;
}

.icon-flyout-dd{
  padding: 0;
  left: auto;
  right: 0;
  border-color: #b9b9b9;
}

.icon-flyout:before{
  content: "";
  position: absolute;
  top: -4px;
  left: 0;
  width: 31px;
  height: 5px;
  background-color: #e2e2e2;
}

.icon-flyout-dd:before{
  left: auto;
  right: 0;
  width: 15px;
}

/*
.selected .toolbar-icon{
  box-shadow: 3px 3px 5px #aaa;
}
*/

.flyout-options{
  margin-bottom: .75em;
}

/*
#table-flyout-flyout{
  display: none;
  position: absolute;
z-index: 2;
  left: 98%;
  box-shadow: 0px 0px 3px #aaa;
  top: .5em;
  background-color: #e2e2e2;
  border: 1px solid #b9b9b9;
  border-bottom-color: #999;
  border-right-color: #999;
  padding: .75em;
  cursor: auto;
}
*/

#table-flyout label{
  font-weight: normal;
}

#table-flyout table{
  border: 1px solid #555;
  border-collapse: collapse;
}

#table-flyout td{
  border: 1px solid #777;
width: 1.4em;
height: 1.4em;
max-width: 1.4em;
min-width: 1.4em; 
max-height: 1.4em; 
min-height: 1.4em;
width: 15px;
height: 17px;
max-width: 15px;
min-width: 17px; 
max-height: 15px; 
min-height: 17px;
overflow: hidden;
  cursor: default;
}

#table-flyout td.header{
  border: 1px solid #000;
  background-color: #cfcfcf;
}

#table-flyout td.hovered{
  background-color: #C5DAE9;
}

#table-flyout td.header.hovered{
  background-color: #B3C6D4;
}

#table-dimensions{
  text-align: center;
  margin-top: .5em;
}

.temporarily-hide{
  display: block !important;
  height: 0 !important;
  width: 0 !important;
  overflow: hidden !important;
  position: absolute !important;
  left: -10000px;
  top: -10000px;
  padding: 0 !important;
  border-width: 0 !important;
  margin: 0 !important;
}

.table-temp-empty.activated, .image-temp{
  background-color: #D9E7F1;
  border: 1px dotted #1B86D2;
  background-color: #1b86d2;
  position: absolute;
  width: 20px;
  height: 20px;
  display: inline-block;
  opacity: .25;
  margin-left: -8px;
  border-radius: 10px;
}

.table-temp-text, #LinkNew, .LinkNew{
  background-color: #D9E7F1;
  border: 1px dotted #1B86D2;
}

.table-examples{
  margin-top: .3em;
}

.table-examples td{
  vertical-align: top;
  text-align: center;
padding: 0 .75em;
}

.table-examples table{
  margin: auto;
}

div.table-example{
  margin-top: .5em;
}

.table-examples .table-example table{
  font-size: .9em;
  margin-top: 0;
  border-collapse: collapse;
  border: 2px solid #000;
}
.cell-examples .table-example table{
  border-width: 1px;
}

.table-examples .table-example td{
  margin-top: 0;
  border-bottom: 1px solid #333;
  border-right: 1px solid #333;
padding: 0 .1em;
}
.cell-examples .table-example.none td{
  border-bottom: 1px dotted #ddd;
  border-right: 1px dotted #ddd;
}

.table-examples .table-example td.te-right{
  border-right-width: 0;
}
.table-examples .table-example td.te-bottom{
  border-bottom-width: 0;
}

.menu-list, .menu-list li{
  margin: 0;
  padding: 0;
  list-style-type: none;
  display: block;
}

.menu-list{
  border-top: 1px solid #ccc;
  padding: .5em 0;
  margin: 0 .75em;
}

.menu-list li{
  padding: .5em .75em;
  cursor: pointer;
  margin: 0 -.75em;
}

.menu-list li.hovered{
  background-color: #f8f8f8;
  background-color: #fff;
  background-color: #E5EEF5;
  background-color: #C5DAE9;
}

.menu-list.disabled li{
/*
  color: #aaa;
*/
  opacity: .5;
  cursor: default;
}

/*
#table-flyout-new{
  border-top-width: 0;
  position: relative;
}
*/

#table-flyout-insert{
  border-top-width: 0;
}

#table-flyout-options li, #table-contextmenu-options li{
  padding-left: 28px;
  background-image: url(content_files/options-05.png);
  background-repeat: no-repeat;
  background-position: .75em center;
}

/*
#table-flyout-new .list-text{
  display: block;
  background-image: url(toolbar/right-arrow-01.png);
  background-position: right center;
  background-repeat: no-repeat;
}
*/

.media-block{
  text-align: center;
  position: relative;  
  display: block;
  margin: .5em auto;
  min-width: 50%;
}

.media-block.inline{
  display: inline;
}

.media-inner-plus-alt{
  position: relative;
  display: inline-block;
  cursor: default;
}

.image-options{
  display: none;
  position: absolute;
top: 100%;
left: 0;
  padding: .5em 1.5em;
  background-color: white;
  white-space: nowrap;
/*
  min-width: 100%;
*/
border: 1px solid #bbb;
  z-index: 3;
  margin-left: -1px;
text-align: center;
  margin-top: -.5em;
  font-size: .9em;
  box-shadow: 0 2px 2px #aaa;
background-color: #f2f2f2;
}

.image-options a{
  text-decoration: none;
}

.image-options .already-added{
  color: black !important;
  cursor: default;
}

.image-options .disabled label, .image-options .disabled a{
  color: #555 !important;
  cursor: help;
  text-decoration: none;
}

.image-options-options{
  padding-left: 1.25em;
  border-left: 1px solid #999;
  margin-left: .75em;
}

.image-options label{
  font-weight: normal;
}

.alt-warning, #thanks{
  position: absolute;
  right: 10px;
  right: -26px;
  top: 10px;
  top: 4px;
  right: -20px;
  cursor: pointer;
}

#thanks{
  color: white;
  background-color: #3c3;
  background-color: #292;
  background-color: #C5DAE9;
  border: 1px solid #1B86D2;
  color: black;
  padding: .25em 1em;
  right: auto;
  left: 100%;
}

.media-title, .media-caption{
  display: none;
  width: 60%;
}

.media-title{
  border: 1px dashed transparent;
  margin: 0 auto .5em;
  padding: .5em 12px;
  border-bottom: 1px solid #999;
}
.media-caption{
  margin: .5em auto 0;
  text-align: left;
  border-top: 1px solid #999;
  position: relative;
}

.media-title .hint-text, .media-caption-removable{
  padding-right: 2em;
}

/*
.media-caption.just-title .media-caption-removable{
  display: none;
}

.media-caption.just-title{
  text-align: center;
}

.media-caption.just-title .cnx_label{
  float: none;
}
*/

.media-caption .cnx_label{
  float: left;
  padding: .5em 12px .5em;
  padding: .55em 3px .55em 0;
  display: inline-block;
  border: 1px solid transparent;
}

.media-caption-removable{
  padding: .5em 12px .5em 3px;
  border: 1px dashed transparent;
  border-top-width: 0;
  overflow: hidden;
  display: block;
}

.hovered .media-caption-removable{
  border: 1px dashed #ccc;
  border-top-width: 0;
}

.media-caption .hint-text{
  display: none;
}
.media-caption.hovered .hint-text{
  display: inline;
}

.media-title.hovered{
  border: 1px dashed #ccc;
  border-bottom: 1px solid #999;
}

.media-title-close, .media-caption-close{
  float: right;
  cursor: pointer;
  display: none;
}

.media-caption.hovered .media-caption-close, .media-title.hovered .media-title-close{
  display: block;
}

.media-caption-text, .media-title-text{
  padding-right: 2em;
}

.media-title-text{
  font-weight: bold;
}

.media-training-wheels{
  width: 250px;
  border: 1px solid #1b86d2;
  background-color: #c5dae9;
  position: absolute;
  z-index: 400;
  right: 100%;
  top: 0;
  margin-right: 17px;
  padding: 10px;
  box-shadow: 0px 0px 5px #aaa;
  text-align: left;
  line-height: normal;
}

.media-training-wheels:after { /* Taken from "sandeep" at http://stackoverflow.com/questions/9450733/css-triangle-custom-border-color */
  content: '';
  display: block;
  position: absolute;
  z-index: 401;
top: 3px;
right: -11px;
  width: 20px;
  height: 20px;
  background: #C5DAE9;
  border-right:1px solid #1b86d2;
  border-bottom:1px solid #1b86d2;
  -moz-transform:rotate(-45deg);
  -webkit-transform:rotate(-45deg);
}

.media-tw-close{
  float: right;
  cursor: pointer;
  padding-left: 2em;
  font-weight: bold;
  position: relative;
  z-index: 403;
}

.media-tw-header{
  font-weight: bold;
  margin: 0 0 .5em;
}

.media-tw-explanation{
  font-size: .9em;
}

.image-resize{
  border: 1px solid #000;
}

.media-table{
  border: 0;
  width: 100%;
  border-collapse: collapse;
}
.media-table td{
  border: 1px solid transparent; /* 1px transparent due to some stupid chrome/jquery bug */
  padding: 0;
  position: relative;
}
.media-table-add{
  vertical-align: middle;
  text-align: center;
  width: *%;
}
.media-table-add div{
  display: none;
  border: 1px dotted #ccc;
  margin: auto;
  min-height: 40px;
  line-height: 2em;
  padding: .75em 0;
  width: 150px;
  text-align: center;
  cursor: pointer;
  color: #888;
}

#image-options{
  padding-top: .5em;
}

#drag-image{
  margin: .5em 0 1em;
  padding: 1em;
  border: 2px dashed #999;
  text-align: center;
  background-repeat: no-repeat;
  background-position: center top;
  position: relative;
}

#drag-image.invisible *{
  visibility: hidden;
}

#image-try-over{
  position: absolute;
  visibility: visible !important;
  right: 0;
  top: 0;
  padding: .4em 1em;
  box-shadow: -3px 3px 3px #eee;
  color: #666;
  font-size: .85em;
  background-color: #fff;
  border: 1px dotted #aaa;
  border-width: 0 0 1px 1px;
  cursor: pointer;
}

#drag-image-here{
  font-weight: normal;
  margin: 1em 0 2em;
  margin: 2em 0 1em;
  color: #999;
  font-size: 1.3em;
}

#drag-image-here, #drag-image-alternatives{
/*
  text-shadow: 0px 0px 1px #fff, 0 0 2px #fff, 0 0 3px #fff, 0 0 4px #fff;
*/
  text-shadow: 1px 1px 0 #fff, -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff;
/*
  text-shadow: 2px 2px 0 #fff, -2px -2px 0 #fff, 2px -2px 0 #fff, -2px 2px 0 #fff;
  text-shadow: 2px 2px 1px #fff, -2px -2px 1px #fff, 2px -2px 1px #fff, -2px 2px 1px #fff;
*/
}

.dia-alt{
  margin: .5em 0;
}

#upload-image{
  overflow: hidden;
  width: 0;
  height: 0;
}

#upload-image-link, #upload-url-link{
  outline: none;
}

#upload-url{
  margin: -.5em 0 .5em;
}

#reuse-info{
  padding: .5em 0 .5em 3em;
}

#reuse-info input, #reuse-info select{
  border-width: 1px;
}

#reuse-info .disabled{
  background-color: #e3e3e3;
}

.cnx_label.clear.active{
  position: relative;
}

.clearer{
  display: none;
}

.cnx_label.clear.active .clearer{
  display: block;
  position: absolute;
right: 100%;
width: 24px;
min-height: 16px;
bottom: .5em; /* padding on this label? */
  background-image: url(content_files/broom-02.png);
  background-repeat: no-repeat;
  background-position: left bottom;
  cursor: pointer;
}

#reuse-footnote-text{
  padding: .2em;
  border: 1px inset #666;
  min-height: 3em;
}

#reuse-footnote-text.disabled{
  background-color: #e3e3e3;
}

#reuse-footnote-text span{
  display: none;
}

.image-back{
  float: left;
  display: none;
}
.ui-dialog-buttonset{
  float: none !important;
  text-align: right;
  padding-left: 1em;
}

#enter-alt{
  margin-bottom: .5em;
  margin-top: 2.5em;
}

.image-forward.disabled{
  color: #888;
}

#image-size{
  display: none;
  text-align: center;
  margin: .7em 0 1.5em;
}

.link-radio{
  float: left;
}

.link-value{
  padding-left: 2.5em;
}

#link-locations{
  margin-top: 1em;
}

.link-location{
  clear: left;
  margin-top: .5em;
}

#ltw-webpage-url{
  margin-top: .25em;
  border-width: 1px;
  padding: 1px 0;
}
#ltw-webpage-url.disabled{
  background-color: #ddd;
  color: #888;
  border-width: 1px;
}

#ltw-webpage-test, #link-parts-preview{
  text-align: right;
  position: relative;
  padding-top: .25em;
}
#ltw-webpage-test a, #link-parts-preview a{
  font-size: .85em;;
  color: #369;
}

#link-parts-filters, #link-parts-filters li{
  display: block;
  margin: 0;
  padding: 0;
  list-style-type: none;
}

#link-parts-filters{
/*
  text-align: center;
*/
  margin: .25em 0 0;
/*
  width: 100%;
  top: 0;
  border: 1px solid #999;
  border-bottom-width: 0;
  border-bottom: 1px solid #bbb;
  padding: .4em 0 .5em;
  box-shadow: 0 3px 3px #ccc;
  background-color: #f6f6f6;
  background-color: #f3f3f3;
*/
}

#link-parts-filters li{
  display: inline-block;
  padding: 0 .75em 0 1em;
padding: 0 .2em 0 .45em;
  border-left: 1px solid #999;
  cursor: pointer;
  text-decoration: underline;
  color: #369;
}

#link-parts-filters #lp-all, #link-parts-filters #lp-header{
  border-left-width: 0;
}

#link-parts-filters #lp-header{
  cursor: auto;
  text-decoration: none;
  padding-right: 0;
  font-weight: normal;
  color: black;
padding: 0;
}

#link-parts-filters .selected{
  font-weight: bold;
  color: black;
  cursor: default;
  text-decoration: none;
}

#link-parts.disabled{
  display: none;
/*
  background-color: #ddd;
  color: #888;
*/
}
#link-parts.disabled .cnx_label{
/*
  color: #888;
*/
}

#link-parts{
  border: 1px solid #999;
  border: 1px dotted #777;
/*
  border-top-width: 0;
*/
  max-height: 135px;
  overflow: auto;
  width: 100%;
  margin: 0;
  margin-top: .5em;
}

.linkable-part, .nothing-to-display{
  width: 96%;
  line-height: 1.3em;
  height: 1.3em;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  border-top: 1px dotted #bbb;
  margin-top: -1px;
  padding: .5em 2%;
  vertical-align: 0;
  cursor: pointer;
}

.linkable-part math, .linkable-part math *{
/*
  line-height: 1.3em !important;
  vertical-align: middle !important;
  height: 1.3em !important;
  overflow: hidden;
*/
  vertical-align: top;
}

.linkable-part.hovered{
  background-color: #E5EEF5;
}
.linkable-part.selected{
  background-color: #C5DAE9;
}

.nothing-to-display{
  color: #666;
  font-style: italic;
}

.table-title{
  margin-bottom: .5em;
}

.required2{
}

.required2.warning{
  color: #ee7700;
  font-weight: bold;
}

#drag-image.warning3{
  border-color: #e70 !important;
  border-width: 3px !important;
}

.solution-toggle-hide, .solution-toggle-show, .answer-toggle-hide, .answer-toggle-show{
  text-align: center;
}

.solution-toggle, .answer-toggle{
  cursor: pointer;
}

.note-decoration, .example-decoration{
  margin: .5em 3em;
  border: 1px solid #666;
  border-top-color: #ccc;
  border-left-color: #ccc;
  padding: .75em 1em;
}

.example-decoration{
  padding: 1em 10px .25em;
  border-left: 0;
  border-right: 0;
  border-color: #ccc;
  background-color: #f3f3f3;
  margin: .5em 0;
}

.link, .cnxn{
  position: relative;
}

.link-options{
  position: absolute;
  top: 100%;
  left: 0;
  border: 1px solid #999;
  border-radius: 8px; 
  display: inline-block;
  padding: .25em 1.25em;
  background-color: white;
  z-index: 10;
  box-shadow: 2px 2px 2px #aaa;
  line-height: 33px;
  color: #000;
  font-weight: normal;
}

.link-information{
  white-space: nowrap;
}
.link-information a{
  color: #369 !important;
}

.edit-link, .unlink-link{
  padding-left: .1em;
  padding-right: .8em;
  border-right: 1px solid #888;
}

.edit-link-icon, .unlink-link-icon, .visit-link-icon{
  text-decoration: none;
}

.unlink-link-icon, .visit-link{
  padding-left: .4em;
}

#image-dialog-title, #image-dialog-caption{
  margin: 1em 0;
}

#image-dialog-title .hint-link, #image-dialog-caption .hint-link, .link-options a, .link-options a img{
/*
  text-align: center;
*/
  cursor: pointer !important;
}

#image-dialog-title-close, #image-dialog-caption-close{
  float: right;
  cursor: pointer;
}

#image-dialog-title-text, #image-dialog-caption-text{
  margin-right: 1.5em;
  border: 1px dashed #ccc;
  padding: .15em .25em;
}

#image-dialog-title-text{
  font-weight: bold;
}

.hint-link{
  color: #369;
  text-decoration: underline;
  cursor: pointer;
}


.exercise-header, .solution-header, .note-header, .example-header, .definition-header{
  position: relative;
}

.exercise-header .cnx_label, .solution-header .cnx_label, .note-header .cnx_label, .example-header .cnx_label, .definition-header .cnx_label{
/*
  padding-right: 12px;
*/
  padding-right: 6px;
  padding-left: 12px;
  background-image: url(content_files/blue-square-01.png);
  background-repeat: no-repeat;
  background-position: 100% .15em;
  background-position: 0 .15em;
  background-position: 0 .1em;
}
.canvas-hovered .exercise-header .cnx_label, .canvas-hovered .solution-header .cnx_label, .canvas-hovered .note-header .cnx_label, .canvas-hovered .example-header .cnx_label, .canvas-hovered .definition-header .cnx_label{
  background-image: url(content_files/downArrow.gif);
}

.label-list{
  position: absolute;
  top: -5px;
/*
  top: 100%;
*/
  left: -21px;
  background-color: white;
  border: 1px solid #ddd;
  box-shadow: 1px 1px 3px #ccc;
  z-index: 3;
  min-width: 10em;
}

.label-list .cnx_label{
  display: block;
  padding: 5px 10px;
  padding-left: 20px;
  border-bottom: 1px dotted #ddd;
  cursor: pointer;
  background-image: none !important;
}

.label-list .cnx_label:hover{
  background-color: #e5eef5;
}

.label-list .current{
  background-image: url(content_files/read.png) !important;
  background-repeat: no-repeat !important;
  background-position: 5px center !important;
}

#semantic-help{
  text-align: right;
  margin-top: -.25em;
  position: relative;
}
#semantic-help a{
  color: #369;
}
#semantic-help-question{
  padding-left: 25px;
  background-image: url(content_files/left-up-arrow-01.png);
  background-repeat: no-repeat;
  background-position: 0 3px;
  color: #2A537D;
}
#semantic-help-answer-wrap{
  position: absolute;
  left: 100%;
  top: 0;
  margin-top: -65%;
  width: 641px; /* 600 + padding + border + shadow */
  white-space: normal;
  overflow: hidden;
  z-index: 400;
text-align: left;
}
#semantic-help-answer{
  background-color: white;
  padding: 10px 12px 0;
  border: 1px solid #999;
  width: 600px;
  box-shadow: 0px 0px 5px #aaa;
  position: absolute;
  left: -600px;
  top: 0;
  height: auto;
  display: none;
}
#semantic-help-answer-close{
  float: right;
  margin-left: 1.25em;
  font-weight: normal;
  font-size: 1.2em;
  margin-top: -.4em;
  cursor: pointer;
}
.sh-section-opener{
  margin-bottom: .5em;
  font-weight: bold;
}
.plusminus{
  display: none;
}

#table-context-menu{
  background-color: #fff;
  box-shadow: 0px 3px 3px #ddd;
  border: 1px solid #bbb;
  font-family: tahoma,verdana,arial,helvetica,sans-serif;
  position: absolute;
  z-index: 1000;
}
#table-contextmenu-insert{
  border-top: 0;
}



.toolbar-dropdown{
  position: relative;
}

.dropdown-toggle{
  display: inline-block;
  height: 33px;
  width: 17px;
  background-image: url(toolbar/arrow-down-black-06.png);
  background-position: 0px 0px;
  background-repeat: no-repeat;
  margin-right: 2px;
  cursor: pointer;
/*
  border-left: 1px dotted #aaa;
  border-right: 1px dotted #aaa;
*/
}
.toolbar-dropdown.selected .dropdown-toggle{
/*
  box-shadow: rgba(0, 0, 0, 0.15) 0px 2px 4px 0px inset, rgba(0, 0, 0, 0.05) 0px 1px 2px 0px;
  background-color: rgb(230, 230, 230);
*/
  background-image: url(toolbar/arrow-down-black-09.png);

}

.dropdown-toggle:hover{
/*
  background-color: #a8d6f3;
  background-color: #aad7f4;
  background-color: #ddeffa;
*/
  background-image: url(toolbar/arrow-down-black-07.png);
}

.dropdown-menu{
  display: inline-block;
  display: none;
  position: absolute;
  top: 100%;
  right: 0;
  margin-top: -3px;
  margin-right: 2px;
  border: 1px solid #b9b9b9;
/*
  border-bottom-color: #999;
  border-right-color: #999;
*/
}
.dropdown-menu, .toolbar-dropdown.selected .dropdown-toggle{
  background-color: #e2e2e2;
  box-shadow: 0px 0px 5px #aaa;
  box-shadow: 3px 3px 5px #aaa;
  box-shadow: 2px 2px 3px #aaa;
  letter-spacing: normal;
  word-spacing: normal;
}
.dropdown-menu:before{
  content: "";
  position: absolute;
  top: -4px;
  right: -1px;
  right: 0;
  width: 15px;
  height: 5px;
  background-color: #e2e2e2;
/*
  border-right: 1px solid #999;
*/
}

.ordered-list-type li{
  position: relative;
}
.ordered-list-type-bullet{
  position: absolute;
  width: 3.5em;
  text-align: right;
}
.ordered-list-type-label{
  margin-left: 4em;
}

.ordered-list-type .header{
  padding: 5px 2em 10px 1em;
  color: #888;
  font-weight: bold;
  border-bottom: 1px solid #ccc;
}

.menu-list li.header.hovered{
  background-color: transparent;
}

.menu-list li.header{
  cursor: auto;
}

.undo-unelemented, .undo-unelemented-2, .undo-unelemented-3{
  position: fixed;
  top: 42px;
  background-color: #F9EDBE;
  border: 1px solid #F0C36D;
  padding: .1em 1em;
  box-shadow: 2px 2px 2px #aaa;
  z-index: 551;
}
.undo-unelemented-close, .undo-unelemented-2-close, .undo-unelemented-3-close{
  float: right;
  margin-left: 1em;
  cursor: pointer;
}
.undo-unelemented a, .undo-unelemented-2 a, .undo-unelemented-3 a{
  color: #000;
  cursor: pointer;
}

.edit-element-menu{
  position: absolute;
  right: -1px;
  top: 20px;
  right: 20px;
  top: -1px;
  right: -1px;
  text-align: left;
}

.edit-element-menu ul, .edit-element-menu li{
  display: block !important;
  margin: 0 !important;
  padding: 0 !important;
  list-style-type: none;
}

.edit-element-menu ul{
  border: 1px solid #bbb;
  background-color: #f7f7f7;
  text-decoration: none;
  color: #333;
  box-shadow: 2px 2px 2px #aaa;
}

.edit-element-menu li{
  padding: .5em 1em .5em 30px !important;
  border-top: 1px solid #ddd;
  white-space: nowrap;
  background-repeat: no-repeat;
  background-position: .45em .45em;
  position: relative;
  z-index: 2;
}

.edit-element-menu li:hover{
  background-color: #C5DAE9;
}

.edit-element-menu li:first-child{
  border-top: 0;
}

.edit-element-menu a{
  color: #369;
  text-decoration: underline;
}

.edit-element-options{ background-image: url(content_files/options-09.png); }
.edit-element-unelement{ background-image: url(content_files/broom-04.png); }
.edit-element-convert{ background-image: url(toolbar/left-arrow-01.png); background-position: .45em .7em !important; }
.edit-element-convert{ background-image: url(toolbar/left-arrow-01.png); background-position: .45em center !important; }
.edit-element-options:hover{ background-image: url(content_files/options-08.png); }
.edit-element-unelement:hover{ background-image: url(content_files/broom-01.png); }

.edit-element-convert-submenu{
  position: absolute;
  right: 100%;
  top: 0;
  z-index: 1;
}
.edit-element-convert-submenu li{
  padding-left: 1em !important;
}

.definition-contents li{
  margin: .5em 0 .5em 1em !important;
}
.definition-contents ol{
  margin: 1em 0 !important;
}

.glossary-options{
/*
  padding-top: .5em;
  margin: .5em 1em .5em;
  margin: .5em 0;
  border-top: 1px dashed #ccc;
*/
  margin-bottom: .5em;
/*
  color: #555;
*/
  text-align: right;
}

/*
.glossary-options label{
  font-weight: normal;
}
*/

.glossary-options input{
  color: #555;
  border: 1px solid #ddd !important;
  border-right-color: #999 !important;
  border-bottom-color: #999 !important;
}

.glossary-options a, .glossary-options span{
  font-size: .85em;
}
.glossary-options span{
/*
  font-style: italic;
*/
  color: #555;
}

.helper{
  border: 1px solid #E8E8A5;
  background-color: #ffffb5;
  padding: .75em 1em;
  box-shadow: 2px 2px 2px #aaa;
  z-index: 400;
}

#pedagog .helper{
  margin-left: 1em;
  position: absolute;
  left: 100%;
  top: 0;
  width: 400px;
}

.helper-how{
  font-size: .85em;
}

.helper-how li{
  margin: 0 0 .35em 1em !important;
  list-style-type: disc;
}

#semantic-nonselection-click{
  margin-top: 1em;
  display: none;
  font-size: .85em;
}

#semantic-nonselection-click-close{
  margin: 0 0 .5em 2em;
  float: right;
  cursor: pointer;
}

</style>


  </head>

  <body>
    
    
    <div id="table-context-menu" style="display: none;">
      <ul class="menu-list" id="table-contextmenu-insert">
        <li class="table-add-row-before">Add new row before</li>
        <li class="table-add-row-after">Add new row after</li>
        <li class="table-add-column-before">Add new column before</li>
        <li class="table-add-column-after">Add new column after</li>
      </ul>
      <ul class="menu-list" id="table-contextmenu-delete">
        <li class="table-delete-row">Delete row</li>
        <li class="table-delete-column">Delete column</li>
      </ul>
      <ul class="menu-list" id="table-contextmenu-options">
        <li class="table-options-activate">Table options ...</li>
      </ul>
    </div>


  <div id="header-wrap">
    <div id="header-container">
      <div id="header-functions">
        <div id="expertmode">
          <span id="expand-advanced" style="display: inline;">
            &#171;
                  </span>
          <span id="basic-message" style="display: none;">
            <span class="link-like">Switch to advanced mode</span>
          </span>
          <span id="advanced-message" style="display: none;">
            You are in advanced mode. 
            <span class="link-like">Return to basic mode.</span>
          </span>
        </div>
        <div id="status">
          <span id="user-id">You are logged in as: <strong>starkenbury</strong></span>.
          <a href="#" target="_top">Sign out.</a>
        </div>
      </div>
      <div id="header">
        <img class="cnxlogo" src="helper_files/connexions_icon.png"/>
        <h1><a href="#">OERPub</a></h1>
      </div>

    </div>
  </div>

  <div id="workflownav-wrap">
    <div id="workflownav-container">
      <div id="back-steps">
        <input type="button" class="button" value="&#171; Back: Return to start page" id="back-to-chooser-2"
               title="Return to the previous screen to choose a different import or editing option" 
               onclick="window.location = 'choose-27.html'"/>
      </div>
      <div id="forward-steps">
        <input type="button" class="button forward-button" value="Next Step &#187;" id="show-neworexisting"
               title="Select whether this will be used for a new module or to override the contents of an existing module" />
      </div>
    </div>
  </div>


  <div id="ie6-container-wrap">
    <div id="container">
      <div id="content">


        <div id="pageheader-wrap">

          <div id="module-actions">
            <div class="advanced" style="display: none;">
              <h2 class="advanced-label">
                Advanced
              </h2>
              <strong>Module actions: </strong>
              <a title="Save a ZIP file containing the module's XML and metadata to your local computer." 
                 id="download-copy" href="#asdfaasdf" style="color: black; text-decoration: none;">
               <span class="button" style="margin-left: 0;">Download a copy</span>
              </a>
              <a title="Make changes to the module by editing its XML code." 
                 id="edit-xml" href="#asdfaasdf" style="color: black; text-decoration: none;">
               <span class="button" style="margin-left: 0;">Edit XML</span>
              </a>
            </div>
          </div>


          <div id="page-title">
            <h1>
              Edit:
              <span class="metatitle">
                Conversion of Cooking_with_spam.doc
              </span>
            </h1>
          </div>

          <div id="page-description">
            <p class="forminfo">
              Make any changes you would like to the module below.
            </p>
          </div>

        </div>










<div id="editor-mode">
  <ul>
    <li id="xml-mode">
      <a href="#">Edit XML Source</a>
    </li>
    <li id="visual-mode" class="current">
      <a href="#">Edit Visually</a>
    </li>
  </ul>
</div>

        <div id="editor">


<div id="artboard">

<div id="artboard-inner">


<div id="toolbar">
  <div class="btn-toolbar2" style="margin: 0;">

  <span class="iconlike" id="hints">
    <input type="checkbox" id="hints-checkbox"/>
    <label for="hints-checkbox" class="checkbox"/>Show hints</label>
  </span>

 <div id="icon-set">
  <span class="iconlike">
    <input type="submit" value="Saved" disabled="disabled"/>
  </span>
  <span class="iconlike">
    <input type="submit" value="Preview"/>
  </span>
<!--
  <span class="iconlike">
    <input type="submit" value="Options ..." class="menu-like"/>
    <a href="#" class="menu-like"/>Edit/Options ...</a>
  </span>
-->
  <span class="toolbar-function" id="toolbar-undo">
    <a class="toolbar-icon" href="#" title="Undo">
    </a>
  </span>
  <span class="toolbar-function disabled" id="toolbar-redo">
    <a  class="toolbar-icon" href="#" title="Redo">
    </a>
  </span>
  <span class="separator">  </span>
  <span class="iconlike">
      <select>
        <option>Normal text</option>
        <option>Section Heading</option>
        <option>Subsection Heading</option>
        <option>Subsubsection Heading</option>
      </select>
  </span>
  <span class="toolbar-function" id="toolbar-bold">
    <a class="toolbar-icon" href="#" title="Bold (Ctrl + B)">
    </a>
  </span>
  <span class="toolbar-function" id="toolbar-italics">
    <a class="toolbar-icon" href="#" title="Italics (Ctrl + I)">
    </a>
  </span>
  <span class="toolbar-function" id="toolbar-underline">
    <a class="toolbar-icon" href="#" title="Underline (Ctrl + U)">
    </a>
  </span>
<!--
  <span class="toolbar-function" id="toolbar-smallcaps">
    <a class="toolbar-icon" href="#" title="Small caps">
    </a>
  </span>
  <span class="separator">  </span>
-->
  <span class="toolbar-function" id="toolbar-superscript">
    <a class="toolbar-icon" href="#" title="Superscript">
    </a>
  </span>
  <span class="toolbar-function" id="toolbar-subscript">
    <a class="toolbar-icon" href="#" title="Subscript">
    </a>
  </span>
  <span class="separator">  </span>
  <span class="toolbar-function" id="toolbar-link">
    <a class="toolbar-icon" href="#" title="Link">
    </a>
  </span>
<!--
  <span class="toolbar-function disabled" id="toolbar-unlink">
    <a class="toolbar-icon" href="#" title="Unlink (remove the link, leaving just the text)">
    </a>
  </span>
-->
<!--
  <span class="toolbar-function" id="toolbar-specialchars">
    <a class="toolbar-icon" href="#" title="Insert special characters">
    </a>
  </span>
  <span class="toolbar-function" id="toolbar-footnote">
    <a class="toolbar-icon" href="#" title="Footnote">
    </a>
  </span>
-->
  <span class="separator">  </span>
  <span class="toolbar-function" id="toolbar-unorderedlist">
    <a class="toolbar-icon" href="#" title="Unordered list">
    </a>
  </span>
  <span class="toolbar-function" id="toolbar-orderedlist">
    <a class="toolbar-icon" href="#" title="Ordered list">
    </a>
  </span>
  <span class="toolbar-function toolbar-dd" id="toolbar-olist-options">
    <a class="toolbar-icon" href="#" title="Choose numbering style">
    </a>
  </span>
  <span class="toolbar-function disabled" id="toolbar-indent">
    <a class="toolbar-icon" href="#" title="Indent list item (move right)">
    </a>
  </span>
  <span class="toolbar-function disabled" id="toolbar-unindent">
    <a class="toolbar-icon" href="#" title="Unindent list item (move left)">
    </a>
  </span>
<!--
  <span class="separator">  </span>
  <div class="btn-group">
    <button class="btn action"><i class="icon-unordered-list"></i></button>
    <button class="btn action"><i class="icon-ordered-list"></i></button>
    <button class="dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
    <ul class="dropdown-menu">
      <li>
        <a href="#" class="action listarabic">1. Default</a>
      </li>
      <li>
        <a href="#" class="action listupperalpha">A. Upper Alpha</a>
      </li>
      <li>
        <a href="#" class="action listloweralpha">a. Lower Alpha</a>
      </li>
      <li>
        <a href="#" class="action listupperroman">I. Upper Roman</a>
      </li>
      <li>
        <a href="#" class="action listlowerroman">i. Lower Roman</a>
      </li>
      <li>
        <a href="#" class="action listlowerroman">Step 1. Step-wise</a>
      </li>
    </ul>
  </div>
  <div class="btn-group">
    <button class="btn action"><i class="icon-indent-list"></i></button>
    <button class="btn action"><i class="icon-unindent-list"></i></button>
    </ul>
  </div>
-->
  <span class="separator">  </span>
  <span class="toolbar-function" id="toolbar-table">
    <a class="toolbar-icon" href="#" title="New table">
    </a>
  </span>
  <span class="toolbar-function toolbar-dd" id="toolbar-table-options">
    <a class="toolbar-icon" href="#" title="Table options">
    </a>
  </span>
<!--
  <span class="toolbar-dropdown">
    <span class="dropdown-toggle" title="Table options"><span class="caret"></span></span>
    <div class="dropdown-menu">
      <ul class="menu-list disabled" id="table-flyout-insert">
        <li class="table-add-row-before">Add new row before</li>
        <li class="table-add-row-after">Add new row after</li>
        <li class="table-add-column-before">Add new column before</li>
        <li class="table-add-column-after">Add new column after</li>
      </ul>
      <ul class="menu-list disabled" id="table-flyout-delete">
        <li class="table-delete-row">Delete row</li>
        <li class="table-delete-column">Delete column</li>
      </ul>
      <ul class="menu-list disabled" id="table-flyout-options">
        <li class="table-options-activate">Table options ...</li>
      </ul>
    </div>
  </span>
-->
<!--
  <div class="btn-group">
    <button class="btn action"><i class="icon-table-insert"></i></button>
    <button class="btn dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
    <ul class="dropdown-menu">
      <li class="disabled">
        <a href="#" class="action addrowbefore">Add new row before</a>
      </li>
      <li class="disabled">
        <a href="#" class="action addrowafter">Add new row after</a>
      </li>
      <li class="disabled">
        <a href="#" class="action addcolumnbefore">Add new column before</a>
      </li>
      <li class="disabled">
        <a href="#" class="action addcolumnafter">Add new column after</a>
      </li>
      <li class="disabled">
        <a href="#" class="action deleterow">Delete row</a>
      </li>
      <li class="disabled">
        <a href="#" class="action deletecolumn">Delete column</a>
      </li>
      <li class="disabled">
        <a href="#" class="action tableoptions">Table options</a>
      </li>
    </ul>
  </div>
-->
  <span class="toolbar-function" id="toolbar-image">
    <a class="toolbar-icon" href="#" title="New image">
    </a>
  </span>
<!--
  <span class="toolbar-function" id="toolbar-video">
    <a class="toolbar-icon" href="#" title="New video">
    </a>
  </span>
  <span class="toolbar-function" id="toolbar-audio">
    <a class="toolbar-icon" href="#" title="New audio">
    </a>
  </span>
-->
  <span class="toolbar-function" id="toolbar-math">
    <a class="toolbar-icon" href="#" title="Add Math">
    </a>
  </span>

  </div>
  </div>
</div>


<div id="sidebar">
<!--
<dl id="toc">
  <dt><a href="#">Module contents</a></h2>
  <dd>asdf</dd>
</dl>
-->
<dl id="pedagog">
  <dt style="position: relative;">
    <span style="color: #999; font-size: 1.7em; position: absolute; right: 0; top: -.35em;">
      &#8594;
    </span>
    <span style="float: lefta;">
      Drag to add a new:
    </span>
  </dt>
  <dd>
    <ul>
      <li class="pedagog" id="example-block">
<!--
        <div class="count">
          <a href="#" class="count-total">1</a>
          <div class="node-list">
            <strong>Examples in this document</strong>
            <ul>
              <li>
                <a href="#ffexample1" title="Jump to this example">Example 1</a/>
              </li>
            </ul>
          </div>
        </div>
-->
<!--
        <a class="node" href="#" title="Drag an 'Example' to the place you want it in the page. Use an 'Example' to illustrate a point or demonstrate a case to the reader."><span 
class="plus">+ </span>Example</a>
-->
        <a class="node" href="#"><span class="plus">+ </span>Example</a>
        <div class="helper" style="display: none;">
          <p>
            Use an <strong>Example</strong> to illustrate a point to the reader.  Supported types: <i>Example, Illustration, Demonstration, Case in Point, Case Study</i>.
          </p>
          <div class="helper-how">
          <p>
            To add an example, either:
          </p>
          <ul>
            <li><strong>Drag the block</strong> at left into the document, OR ...</li>
            <li><strong>Highlight text</strong> in the document and then click the block at left</li>
          </ul>
        </div>
      </li>
      <li class="pedagog" id="exercise-block">
        <a class="node" href="#"><span class="plus">+ </span>Exercise</a>
        <div class="helper" style="display: none;">
          <p>
            Use an <strong>Exercise</strong> to ask a question or assess the reader's understanding.  Supported types: <i>Exercise, Homework, Question, Problem, Task</i>.
          </p>
          <div class="helper-how">
          <p>
            To add an exercise, either:
          </p>
          <ul>
            <li><strong>Drag the block</strong> at left into the document, OR ...</li>
            <li><strong>Highlight text</strong> in the document and then click the block at left</li>
          </ul>
        </div>
      </li>
      <li class="pedagog" id="note-block">
        <a class="node" href="#"><span class="plus">+ </span>Note to Reader</a>
        <div class="helper" style="display: none;">
          <p>
            Use a <strong>Note</strong> to make a note to the reader (set apart from the flow of the text).  Supported types: <i>Note, Warning, Tip, Aside, Important</i>.
          </p>
          <div class="helper-how">
          <p>
            To add a note, either:
          </p>
          <ul>
            <li><strong>Drag the block</strong> at left into the document, OR ...</li>
            <li><strong>Highlight text</strong> in the document and then click the block at left</li>
          </ul>
        </div>
      </li>
      <li class="pedagog" id="definition-block">
        <a class="node" href="#"><span class="plus">+ </span>Definition</a>
        <div class="helper" style="display: none;">
          <p>
            Use a <strong>Definition</strong> to define a key term or glossary word.  Supported types: <i>Definition, Key Term</i>.
          </p>
          <div class="helper-how">
          <p>
            To add a definition, either:
          </p>
          <ul>
            <li><strong>Drag the block</strong> at left into the document, OR ...</li>
            <li><strong>Highlight text</strong> in the document and then click the block at left</li>
          </ul>
        </div>
      </li>
      <li class="pedagog" id="equation-block">
        <a class="node" href="#"><span class="plus">+ </span>Numbered Equation</a>
        <div class="helper" style="display: none;">
          <p>
            Use a <strong>Numbered equation</strong> to display a mathematical equation using the convention of numbering each at right.
          </p>
          <div class="helper-how">
          <p>
            To add an example, either:
          </p>
          <ul>
            <li><strong>Drag the block</strong> at left into the document, OR ...</li>
            <li><strong>Highlight text</strong> in the document and then click the block at left</li>
          </ul>
        </div>
      </li>
<!--
      <li class="pedagog-glossary">
        <input type="checkbox"/>
        <span>Include a Glossary</span>
      </li>
-->
    </ul>
  </dd>
</dl>
  <div id="semantic-help">
    <a id="semantic-help-question" href="#adsf" title="Click to find out more about the above buttons">What are these?</a>
    <div id="semantic-help-answer-wrap">
      <div id="semantic-help-answer" style="display: none;">
        <div id="semantic-help-answer-close"><img src="content_files/remove-element-08.png"/></div>
        <div class="sh-section-opener">
          <span class="plusminus">- </span>
          What are these buttons?
        </div>
        <div class="sh-section" style="display: block">
          <p>
          They provide an easy way to add templates for including pedagogical items in the text you're creating:
          </p>
          <ul>
            <li><strong>Example</strong> <i>(Illustration, Demonstration, Case in Point, Case Study)</i>: <br/>Illustrate a point to the reader (set apart from the flow of the text).</li>
            <li><strong>Exercise</strong> <i>(Homework, Question, Problem, Task)</i>: <br/>Ask a question to assess the reader's understanding.  Optionally provide a solution/answer.</li>
            <li><strong>Note</strong> <i>(Warning, Tip, Aside, Important)</i>: <br/>Make a note to the reader (set apart from the flow of the text).</li>
            <li><strong>Definition</strong> <i>(Key Term)</i>: <br/>Define a key term, or build a glossary.</li>
            <li><strong>Numbered equation</strong>: <br/>Mathematical equations using the convention of numbering each at right.</li>
          </ul>
        </div>
        <div class="sh-section-opener">
          <span class="plusminus">+ </span>
          What are the benefits of using them?
        </div>
        <div class="sh-section">
          <p>
            These templates provide shortcuts for adding consistent elements in your text, while automatically adjusting their numbering (e.g. "Exercise 1" becomes "Exercise 2" if you 
            add another exercise before it).  They also allow for easy linking text to such elements within the document.
          </p>
        </div>
        <div class="sh-section-opener">
          <span class="plusminus">+ </span>
          How do I add them to my document?
        </div>
        <div class="sh-section">
          <ul>
            <li><strong>Drag and drop</strong> the button from the left onto the page (a space will open up).</li>
            <li><strong>Or highlight some text and then click</strong> on the button to wrap that text in the template.</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div id="semantic-nonselection-click" class="helper">
    <a href="#" id="semantic-nonselection-click-close" title="Dismiss this message">
      <img src="content_files/remove-element-08.png"/>
    </a>
    <p>
      <!-- contents will depend on what's click -->
    </p>
  </div>
</div>

<div id="canvas">
<!--
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
asdf<br/>
-->

<div class="element-options" id="glossary-confirm-move" title="Confirm moving this defintion into the glossary" style="display: none;">
  <p>
   <strong>Confirm move to glossary.</strong>  You can quickly access the glossary by clicking the number that will appear next to the "Defintion" block at left.
  </p>
</div>

<div class="element-options" id="exercise-options" title="Edit options for this exercise" style="display: none;">
  <ul class="element-options-tabs">
    <li class="selected" id="eo-basic-tab">
      <a href="#">Basic options</a>
    </li>
    <li id="eo-advanced-tab">
      <a href="#">Advanced</a>
    </li>
  </ul>
  <div class="element-options-contents" id="eo-basic">
    <label>Solution location</label>
    <div class="forminfo">In print and mobile formats, where should the solutions for this exercise appear?</div>
    <div>
      <input type="radio" name="print-placement" id="pp-default" checked="checked" /> <label for="pp-default" style="font-weight: normal;">Default (Let the system decide)</label>
    </div>
    <div>
      <input type="radio" name="print-placement" id="pp-end" /> <label for="pp-end" style="font-weight: normal;">At the end of the chapter</label>
    </div>
    <div>
      <input type="radio" name="print-placement" id="pp-here" /> <label for="pp-here" style="font-weight: normal;">Right after the exercise</label>
    </div>
    <hr/>
    <div>
      <input type="checkbox" id="ex-commentary"/>
      <label for="ex-commentary">Add commentary</label>
      <div class="forminfo">
      Provides a space for commentary at the end of this exercise.
      </div>
    </div>
  </div>
  <div class="element-options-contents" id="eo-advanced" style="display: none;">
    <label>Custom exercise type</label>
    <div class="forminfo">
       Give this exercise a new "type".  
       Nothing obvious will change in your document. 
       This is for advanced book styling and requires support from the publishing system.
    </div>
    <div>
      <input type="text" />
      (<a href="#" class="clear-text-from-input">remove</a>)
    </div>
  </div>
</div>

<div class="element-options" id="example-options" title="Edit options for this example" style="display: none;">
  <ul class="element-options-tabs">
    <li class="selected" id="eo2-advanced-tab">
      <a href="#">Advanced</a>
    </li>
  </ul>
  <div class="element-options-contents" id="eo2-advanced">
    <label>Custom example type</label>
    <div class="forminfo">
       Give this example a new "type".  
       Nothing obvious will change in your document. 
       This is for advanced book styling and requires support from the publishing system.
    </div>
    <div>
      <input type="text" />
      (<a href="#" class="clear-text-from-input">remove</a>)
    </div>
  </div>
</div>

<div class="element-options" id="equation-options" title="Edit options for this equation" style="display: none;">
  <ul class="element-options-tabs">
    <li class="selected" id="eo3-basic-tab">
      <a href="#">Basic options</a>
    </li>
    <li id="eo3-advanced-tab">
      <a href="#">Advanced</a>
    </li>
  </ul>
  <div class="element-options-contents" id="eo3-basic">
    <label>Add a title</label>
    <div class="forminfo">
      Provide a descriptive title for this equation.
    </div>
    <div>
      <input type="text" style="width: 95%;">
    </div>
  </div>
  <div class="element-options-contents" id="eo3-advanced" style="display: none;">
    <label>Custom equation type</label>
    <div class="forminfo">
       Give this equation a new "type".  
       Nothing obvious will change in your document. 
       This is for advanced book styling and requires support from the publishing system.
    </div>
    <div>
      <input type="text" />
      (<a href="#" class="clear-text-from-input">remove</a>)
    </div>
  </div>
</div>

<div class="element-options" id="solution-options" title="Edit options for this solution" style="display: none;">
  <ul class="element-options-tabs">
    <li class="selected" id="eo4-basic-tab">
      <a href="#">Basic options</a>
    </li>
    <li id="eo4-advanced-tab">
      <a href="#">Advanced</a>
    </li>
  </ul>
  <div class="element-options-contents" id="eo4-basic">
    <label>Solution location</label>
    <div class="forminfo">In print and mobile formats, where should this solution appear?  
        This overrides the exercise's location setting for this specific solution, in case you want different location settings in multi-solution exercises.
    </div>
    <div>
      <input type="radio" name="s-print-placement" id="spp-default" checked="checked" /> <label for="spp-default" style="font-weight: normal;">Default (Let the system decide)</label>
    </div>
    <div>
      <input type="radio" name="s-print-placement" id="spp-end" /> <label for="spp-end" style="font-weight: normal;">At the end of the chapter</label>
    </div>
    <div>
      <input type="radio" name="s-print-placement" id="spp-here" /> <label for="spp-here" style="font-weight: normal;">Right after the exercise</label>
    </div>
    <hr/>
    <div>
      <label>Add a title</label>
      <div class="forminfo">
        Provide a descriptive title for this solution.
      </div>
      <div>
        <input type="text" style="width: 95%;">
      </div>
    </div>
  </div>
  <div class="element-options-contents" id="eo4-advanced" style="display: none;">
    <label>Custom solution type</label>
    <div class="forminfo">
       Give this solution a new "type".  
       Nothing obvious will change in your document. 
       This is for advanced book styling and requires support from the publishing system.
    </div>
    <div>
      <input type="text" />
      (<a href="#" class="clear-text-from-input">remove</a>)
    </div>
  </div>
</div>

<div class="element-options" id="table-options" title="Edit options for this table" style="display: none;">
  <ul class="element-options-tabs">
    <li class="selected" id="eo5-basic-tab">
      <a href="#">Basic options</a>
    </li>
    <li id="eo5-formatting-tab">
      <a href="#">Borders</a>
    </li>
    <li id="eo5-advanced-tab">
      <a href="#">Advanced</a>
    </li>
  </ul>
  <div class="element-options-contents" id="eo5-basic">
    <div>
      <label>Add a title</label>
      <div class="forminfo">
        Provide a title for this table.
      </div>
      <div>
        <input type="text" style="width: 95%;">
      </div>
    </div>
    <hr/>
<!--
    <div id="table-summary">
      <label>Add a summary</label>
      <img src="content_files/warning-01.png" title="A summary is required for this table to be considered accessible for visually impaired readers."/>
      <div class="forminfo">
        Provide an overview of the table structure and its contents so that visually impaired can more easily navigate it.
      </div>
      <div>
        <textarea style="width: 95%;"></textarea>
      </div>
    </div>
-->
    <label>Column width</label>
    <div class="forminfo">
      How are the column widths set?
    </div>
    <div>
      <input type="radio" name="table-col-width" id="tcw-full" checked="checked" /> <label for="tcw-full" style="font-weight: normal;">Equal width columns</label>
    </div>
    <div>
      <input type="radio" name="table-col-width" id="tcw-auto" /> <label for="tcw-auto" style="font-weight: normal;">Auto (columns conform to best fill contents)</label>
    </div>
    <div>
      <input type="radio" name="table-col-width" id="tcw-custom" /> <label for="tcw-custom" style="font-weight: normal;">Custom (columns stretched as seen fit)</label>
    </div>
  </div>
  <div class="element-options-contents" id="eo5-formatting" style="display: none;">
    <label>Table border</label>
    <div class="table-examples">
      <table border="0" cellspacing="0" cellpadding="0" style="white-space: nowrap;">
        <tbody>
        <tr>
          <td>
            <input type="radio" name="table-border" id="tb-all" checked="checked" /> <label for="tb-all" style="font-weight: normal;">All edges</label>
            <div class="table-example">
              <table><tbody>
                <tr><td>&nbsp;&nbsp;&nbsp;</td><td>&nbsp;&nbsp;&nbsp;</td><td class="te-right">&nbsp;&nbsp;&nbsp;</td></tr>
                <tr><td>&nbsp;&nbsp;&nbsp;</td><td>&nbsp;&nbsp;&nbsp;</td><td class="te-right">&nbsp;&nbsp;&nbsp;</td></tr>
                <tr><td class="te-bottom">&nbsp;&nbsp;&nbsp;</td><td class="te-bottom">&nbsp;&nbsp;&nbsp;</td><td class="te-bottom te-right">&nbsp;&nbsp;&nbsp;</td></tr>
              </tbody></table>
            </div>
          </td>
          <td>
            <input type="radio" name="table-border" id="tb-sides" /> <label for="tb-sides" style="font-weight: normal;">Sides</label>
            <div class="table-example">
              <table style="border-top: 1px dotted #ddd; border-bottom: 1px dotted #ddd;"><tbody>
                <tr><td>&nbsp;&nbsp;&nbsp;</td><td>&nbsp;&nbsp;&nbsp;</td><td class="te-right">&nbsp;&nbsp;&nbsp;</td></tr>
                <tr><td>&nbsp;&nbsp;&nbsp;</td><td>&nbsp;&nbsp;&nbsp;</td><td class="te-right">&nbsp;&nbsp;&nbsp;</td></tr>
                <tr><td class="te-bottom">&nbsp;&nbsp;&nbsp;</td><td class="te-bottom">&nbsp;&nbsp;&nbsp;</td><td class="te-bottom te-right">&nbsp;&nbsp;&nbsp;</td></tr>
              </tbody></table>
            </div>
          </td>
          <td>
            <input type="radio" name="table-border" id="tb-top" /> <label for="tb-top" style="font-weight: normal;">Top</label>
            <div class="table-example">
              <table style="border-left: 1px dotted #ddd; border-right: 1px dotted #ddd; border-bottom: 1px dotted #ddd"><tbody>
                <tr><td>&nbsp;&nbsp;&nbsp;</td><td>&nbsp;&nbsp;&nbsp;</td><td class="te-right">&nbsp;&nbsp;&nbsp;</td></tr>
                <tr><td>&nbsp;&nbsp;&nbsp;</td><td>&nbsp;&nbsp;&nbsp;</td><td class="te-right">&nbsp;&nbsp;&nbsp;</td></tr>
                <tr><td class="te-bottom">&nbsp;&nbsp;&nbsp;</td><td class="te-bottom">&nbsp;&nbsp;&nbsp;</td><td class="te-bottom te-right">&nbsp;&nbsp;&nbsp;</td></tr>
              </tbody></table>
            </div>
          </td>
          <td>
            <input type="radio" name="table-border" id="tb-bottom" /> <label for="tb-bottom" style="font-weight: normal;">Bottom</label>
            <div class="table-example">
              <table style="border-top: 1px dotted #ddd; border-left: 1px dotted #ddd; border-right: 1px dotted #ddd;"><tbody>
                <tr><td>&nbsp;&nbsp;&nbsp;</td><td>&nbsp;&nbsp;&nbsp;</td><td class="te-right">&nbsp;&nbsp;&nbsp;</td></tr>
                <tr><td>&nbsp;&nbsp;&nbsp;</td><td>&nbsp;&nbsp;&nbsp;</td><td class="te-right">&nbsp;&nbsp;&nbsp;</td></tr>
                <tr><td class="te-bottom">&nbsp;&nbsp;&nbsp;</td><td class="te-bottom">&nbsp;&nbsp;&nbsp;</td><td class="te-bottom te-right">&nbsp;&nbsp;&nbsp;</td></tr>
              </tbody></table>
            </div>
          </td>
          <td>
            <input type="radio" name="table-border" id="tb-topbot" /> <label for="tb-topbot" style="font-weight: normal;">Top &amp; Bottom</label>
            <div class="table-example">
              <table style="border-left: 1px dotted #ddd; border-right: 1px dotted #ddd;"><tbody>
                <tr><td>&nbsp;&nbsp;&nbsp;</td><td>&nbsp;&nbsp;&nbsp;</td><td class="te-right">&nbsp;&nbsp;&nbsp;</td></tr>
                <tr><td>&nbsp;&nbsp;&nbsp;</td><td>&nbsp;&nbsp;&nbsp;</td><td class="te-right">&nbsp;&nbsp;&nbsp;</td></tr>
                <tr><td class="te-bottom">&nbsp;&nbsp;&nbsp;</td><td class="te-bottom">&nbsp;&nbsp;&nbsp;</td><td class="te-bottom te-right">&nbsp;&nbsp;&nbsp;</td></tr>
              </tbody></table>
            </div>
          </td>
          <td>
            <input type="radio" name="table-border" id="tb-none" /> <label for="tb-none" style="font-weight: normal;">None</label>
            <div class="table-example">
              <table style="border: 1px dotted #ddd;"><tbody>
                <tr><td>&nbsp;&nbsp;&nbsp;</td><td>&nbsp;&nbsp;&nbsp;</td><td class="te-right">&nbsp;&nbsp;&nbsp;</td></tr>
                <tr><td>&nbsp;&nbsp;&nbsp;</td><td>&nbsp;&nbsp;&nbsp;</td><td class="te-right">&nbsp;&nbsp;&nbsp;</td></tr>
                <tr><td class="te-bottom">&nbsp;&nbsp;&nbsp;</td><td class="te-bottom">&nbsp;&nbsp;&nbsp;</td><td class="te-bottom te-right">&nbsp;&nbsp;&nbsp;</td></tr>
              </tbody></table>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
    <hr/>
    <label>Cell borders</label>
    <div class="table-examples cell-examples">
      <table border="0" cellspacing="0" cellpadding="0" style="white-space: nowrap;">
        <tbody>
        <tr>
          <td>
            <input type="radio" name="cell-border" id="cb-all" checked="checked" /> <label for="cb-all" style="font-weight: normal;">All</label>
            <div class="table-example">
              <table><tbody>
                <tr><td>&nbsp;&nbsp;&nbsp;</td><td>&nbsp;&nbsp;&nbsp;</td><td class="te-right">&nbsp;&nbsp;&nbsp;</td></tr>
                <tr><td>&nbsp;&nbsp;&nbsp;</td><td>&nbsp;&nbsp;&nbsp;</td><td class="te-right">&nbsp;&nbsp;&nbsp;</td></tr>
                <tr><td class="te-bottom">&nbsp;&nbsp;&nbsp;</td><td class="te-bottom">&nbsp;&nbsp;&nbsp;</td><td class="te-bottom te-right">&nbsp;&nbsp;&nbsp;</td></tr>
              </tbody></table>
            </div>
          </td>
          <td>
            <input type="radio" name="cell-border" id="cb-none" /> <label for="cb-none" style="font-weight: normal;">None</label>
            <div class="table-example none">
              <table style=""><tbody>
                <tr><td>&nbsp;&nbsp;&nbsp;</td><td>&nbsp;&nbsp;&nbsp;</td><td class="te-right">&nbsp;&nbsp;&nbsp;</td></tr>
                <tr><td>&nbsp;&nbsp;&nbsp;</td><td>&nbsp;&nbsp;&nbsp;</td><td class="te-right">&nbsp;&nbsp;&nbsp;</td></tr>
                <tr><td class="te-bottom">&nbsp;&nbsp;&nbsp;</td><td class="te-bottom">&nbsp;&nbsp;&nbsp;</td><td class="te-bottom te-right">&nbsp;&nbsp;&nbsp;</td></tr>
              </tbody></table>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="element-options-contents" id="eo5-advanced" style="display: none;">
    <label>Custom table type</label>
    <div class="forminfo">
       Give this table a new "type".  
       Nothing obvious will change in your document. 
       This is for advanced book styling and requires support from the publishing system.
    </div>
    <div>
      <input type="text" />
      (<a href="#" class="clear-text-from-input">remove</a>)
    </div>
  </div>
</div>

<div class="element-options" id="image-options" title="Upload image" style="display: none;">
  <div id="image-options-step-1">
    <div id="drag-image" style="margin: .5em 0;">
      <div id="drag-image-here">
        Drag image here
      </div>
      <div id="drag-image-alternatives">
        <div class="dia-alt">
          OR 
        </div>
        <div class="dia-alt">
          <a href="#" id="upload-image-link" style="font-weight: normal;">choose an image to upload</a> 
        </div>
        <div class="dia-alt">
          OR 
        </div>
        <div class="dia-alt">
          <a href="#" id="upload-url-link" style="font-weight: normal;">get image from the Web</a>
        </div>
        <input type="file" id="upload-image" size="1"/>
        <div id="upload-url" style="display: none;">
          <input type="text" placeholder="Enter URL of image ..." style="width: 70%"/>
          <input type="submit" value="Preview image above"/>
        </div>
      </div>
    </div>
    <div id="image-dialog-caption" style="display: table">
      <span style="display: table-cell; white-space: nowrap; font-weight: bold;">Image Caption:&nbsp;</span>
      <span style="display: table-cell; width: 99%;"><input type="text" style="width: 99%;"/></span>
    </div>
    <div id="image-size">
      <label>
        Image dimensions:
      </label>
      <input type="text" value="573" size="4"> px by <input type="text" value="600" size="4"/> px 
      <input type="submit" value="Adjust"/>
    </div>
    <div id="enter-alt">
      <label style="font-weight: normal;">
        <img id="alt-warning-upload" style="float: none;" src="content_files/warning-01.png" title="This icon indicates that a description of this image hasn't yet been provided."/>
<!--
        Visually impaired readers of your content need a description of the image to understand it. Please provide one to make your content accessible to them:
-->
        <strong>Describe the image for someone who cannot see it.</strong>
        This description can be read aloud, making it possible for visually impaired learners to understand the content.  <i>(Do not simply duplicate the caption.)</i>
        <a href="http://www.google.com/url?q=https%3A%2F%2Fdocs.google.com%2Fdocument%2Fd%2F1htlS22T6Bm2QkcD9ytxokeYDpOWLrZ_xId8-WCSTV14%2Fedit" target="_blank" style="color: 
        #369;">More info</a> <a href="http://www.google.com/url?q=https%3A%2F%2Fdocs.google.com%2Fdocument%2Fd%2F1htlS22T6Bm2QkcD9ytxokeYDpOWLrZ_xId8-WCSTV14%2Fedit" 
        target="_blank"><img src="helper_files/external-link-03.png"/></a>
      </label>
      <div>
        <div style="padding-right: 20px; padding: 0; margin-top: .25em;">
          <input type="text" placeholder="Enter description for visually impaired readers ..." style="width: 99%;"></input>
        </div>
      </div>
    </div>
  </div>
  <div id="image-options-step-2" style="display: none;">
    <div id="img-perms">
      <div style="margin: .5em 0;">
        <label>Source for this image <span class="required2" id="img-perms-required">(Required)</span></label>
      </div>
      <div>
        <input type="radio" name="img-perms" id="ip-own" val="ip-own"/> <label for="ip-own" style="font-weight: normal;">I own it (no citation needed)</label>
      </div>
      <div>
        <input type="radio" name="img-perms" id="ip-reuse" val="ip-reuse"/> <label for="ip-reuse" style="font-weight: normal;">I am allowed to reuse it:</label>
      </div>

    <div id="reuse-info" style="display: block;">
      <div>
        <label style="font-weight: normal;">Who is the original author of this image?</label>
      </div>
      <div>
        <input type="text" style="width: 99%;" id="reuse-author">
      </div>
      <div style="margin-top: .5em;">
        <label style="font-weight: normal;">What is the original URL of this image?</label>
      </div>
      <div>
        <input type="text" style="width: 99%;" placeholder="http://" id="reuse-url">
      </div>
      <div style="margin-top: .5em;">
        <label style="font-weight: normal;">Permission to reuse</label>
      </div>
      <div>
        <select id="reuse-license">
          <option>Choose a license</option>
          <option>Creative Commons Attribution - CC-BY</option>
          <option>Creative Commons Attribution-NoDerivs - CC BY-ND</option>
          <option>Creative Commons Attribution-ShareAlike - CC BY-SA</option>
          <option>Creative Commons Attribution-NonCommercial - CC BY-NC</option>
          <option>Creative Commons Attribution-NonCommercial-ShareAlike - CC BY-NC-SA</option>
          <option>Creative Commons Attribution-NonCommercial-NoDerivs - CC BY-NC-ND</option>
          <option>Public domain</option>
          <option>other</option>
        </select>
      </div>
      <div style="float: right;">
        <input type="checkbox" id="reuse-footnote-edit" style="margin-top: 1em;"> edit
      </div>
      <div id="include-in-footnote" style="margin: .5em 0;">
        <input type="checkbox" checked="checked"> Include this information in a footnote? (Suggested text below.)
      </div>
      <div>
        <div contentEditable="false" class="disabled" id="reuse-footnote-text">
          <span id="rft-text-1">Image by </span>
          <span id="rft-author"></span><span id="rft-text-2">. </span>
          <span id="rft-url"><a href="#">Original Source</a></span><span id="rft-text-3">. </span>
          <span id="rft-text-4">License:</span>
          <span id="rft-license"></span><span id="rft-text-5">.</span>
          &nbsp;
        </div>
      </div>
    </div>

      <div>
        <input type="radio" name="img-perms" id="ip-idk" val="ip-idk"/> <label for="ip-idk" style="font-weight: normal;">I don't know (skip citation for now)</label>
      </div>
    </div>
  </div>
</div>

<div class="element-options" id="link-options" title="Edit link" style="display: none;">
    <div id="link-text">
      <label style="font-weight: normal;">
        Text to display
      </label>
      <div>
        <input type="text" id="link-text-input" style="width: 99%;"/>
      </div>
    </div>
    <div id="link-locations">
      <div class="link-location">
        <div class="link-radio">
          <input type="radio" name="link-to-where" id="ltw-webpage" />
        </div>
        <div class="link-value">
          <label for="ltw-webpage" style="font-weight: normal;">Link to webpage</label>
          <div>
            <input type="input" id="ltw-webpage-url" style="width: 99%;" placeholder="http://">
          </div>
          <div id="ltw-webpage-test">
            <a href="#" title="Preview this link in a new window">Test this link</a>
          </div>
        </div>
      </div>
      <div class="link-location">
        <div class="link-radio">
          <input type="radio" name="link-to-where" id="ltw-place" />
        </div>
        <div class="link-value">
          <label for="ltw-place" style="font-weight: normal;">Link to another part of this document</label>
            <ul id="link-parts-filters">
              <li id="lp-header" class="lp-header">Show:</li>
              <li id="lp-all">All</li>
              <li id="lp-section-headers">Section Headings</li>
              <li id="lp-exercises">Exercises</li>
              <li id="lp-figures">Figures</li>
              <li id="lp-tables">Tables</li>
              <li id="lp-other">Other</li>
            </ul>
          <div id="link-parts" class="disabled">
          </div>
        </div>
      </div>
    </div>
</div>

<div id="ascii-or-latex" style="display: none;">
  <p>
    How do you want to enter your math code?
    <a id="whats-mathtype-dialog" href="#">(What's this?)</a>
  </p>
  <p id="whats-mathtype-dialog-text" style="display: none;" class="forminfo">
    Both ASCIIMath and LaTeX work by transforming the text you type into mathematics.  
    ASCIIMath is a simple input notation similar to that of a graphing calculator. 
    <a href="http://www1.chapman.edu/~jipsen/asciimath.html" target="_blank" class="external">More info on ASCIIMath notation.</a>
    LaTeX, while similar in many respects to ASCIIMath, includes some more complex notation for power users to write advanced math.  
    <a href="http://en.wikibooks.org/wiki/LaTeX/Mathematics" target="_blank" class="external">More info on LaTeX notation.</a>
  </p>
  <div>
    <input type="radio" name="ascii-or-latex-radio" id="aol-ascii" checked="checked"> <label for="aol-ascii">ASCIIMath</label> (recommended if you aren't sure)
  </div>
  <div>
    <input type="radio" name="ascii-or-latex-radio" id="aol-latex"> <label for="aol-latex">LaTeX</label>
  </div>
</div>


<div id="alt-text" title="Describe this image" style="display: none;">
  <div>
<!--
    <label></label>
    <div class="forminfo">
    </div>
-->
    <p>
        <strong>Describe the image for someone who cannot see it.</strong>
        This description can be read aloud, making it possible for visually impaired learners to understand the content.  <i>(Do not simply duplicate the caption.)</i>
        <a href="http://www.google.com/url?q=https%3A%2F%2Fdocs.google.com%2Fdocument%2Fd%2F1htlS22T6Bm2QkcD9ytxokeYDpOWLrZ_xId8-WCSTV14%2Fedit" target="_blank" style="color: 
        #369;">More info</a> <a href="http://www.google.com/url?q=https%3A%2F%2Fdocs.google.com%2Fdocument%2Fd%2F1htlS22T6Bm2QkcD9ytxokeYDpOWLrZ_xId8-WCSTV14%2Fedit" 
        target="_blank"><img src="helper_files/external-link-03.png"/></a>
    </p>
    <div>
     <textarea style="width: 100%;"></textarea>
    </div>
  </div>
</div>

<div id="confirm-unelement" title="Confirm conversion" style="display: none;">
  <div>
<!--
    <label></label>
    <div class="forminfo">
    </div>
-->
    <p>
    </p>
  </div>
</div>


<div class="canvas2 special-canvas inactive2" style="padding: 0; margin: 0;">

        <div id="cnx_module_header" style="margin-bottom: 1.5em;">

<!--
          <h1 class="content-editable" contentEditable="true">Linear and Time-Invariant Systems</h1>
-->
          <h1 class="content-editable" contentEditable="true">Theoretical Perspectives on Education</h1>
<!--
        <div id="cnx_module_header" style="margin-bottom: 1.5em;">
          <h1 class="content-editable" contentEditable="true">Theoretical Perspectives on Education</h1>
        </div>
-->

        </div>

        <div xmlns:md="http://cnx.rice.edu/mdml/0.4" xmlns:qml="http://cnx.rice.edu/qml/1.0" xmlns:mod="http://cnx.rice.edu/#moduleIds" 
xmlns:bib="http://bibtexml.sf.net/" id="cnx_main">






  <h2 class="section-header">
    <strong class="title content-editable" contentEditable="true">Functionalism</strong>
  </h2>
<!--
<div class="para content-editable convert-to-header" contentEditable="true">
<em class="emphasis">Functionalism</em>
</div>
-->
<div class="para content-editable" contentEditable="true">
Functionalists view education as one of the more important social institutions in a society. They contend that education contributes two kinds of functions: manifest (or primary) 
functions, which are the intended and visible functions of education; and latent (or secondary) functions, which are the hidden and unintended functions. 
</div>

  <h2 class="section-header">
    <strong class="title content-editable" contentEditable="true">Manifest Functions</strong>
  </h2>
<!--
<div class="para content-editable convert-to-header" contentEditable="true">
<em class="emphasis">Manifest Functions</em>
</div>
-->
<div class="para content-editable" contentEditable="true">
There are several major manifest functions associated with education. The first is socialization. Beginning in preschool and kindergarten, students are taught to practice various 
societal roles. The French sociologist &#201;mile Durkheim (1858-1917), who established the academic discipline of sociology, characterized schools as "socialization agencies that 
teach children how to get along with others and prepare them for adult economic roles" (Durkheim 1898).
</div>

  <h2 class="section-header">
    <strong class="title content-editable" contentEditable="true">Latent Functions</strong>
  </h2>
<!--
<div class="para content-editable convert-to-header" contentEditable="true">
<em class="emphasis">Latent Functions</em>
</div>
-->
<div class="para content-editable" contentEditable="true">
Education also fulfills latent functions (shown in the table) . As you well know, much goes on in a school that has little to do with formal education. For example, you might notice 
an attractive fellow student when he gives a particularly interesting answer in class&#151;catching up with him and making a date speaks to the latent function of courtship fulfilled 
by exposure to a peer group in the educational setting.
</div>

  <h2 class="section-header">
    <strong class="title content-editable" contentEditable="true">Conflict Theory</strong>
  </h2>
<!--
<div class="para content-editable convert-to-header" contentEditable="true">
<em class="emphasis">Conflict Theory</em>
</div>
-->
<div class="para content-editable" contentEditable="true">
Conflict theorists do not believe that public schools reduce social inequality. Rather, they believe that the educational system reinforces and perpetuates social inequalities arising 
from differences in class, gender, race, and ethnicity. Where functionalists see education as serving a beneficial role, conflict theorists view it more negatively. To them, 
educational systems preserve the status quo and push people of lower status into obedience.
</div>

  <h2 class="section-header">
    <strong class="title content-editable" contentEditable="true">Feminist Theory</strong>
  </h2>
<!--
<div class="para content-editable convert-to-header" contentEditable="true">
<em class="emphasis">Feminist Theory</em>
</div>
-->
<div class="para content-editable" contentEditable="true">
Feminist theory aims to understand the mechanisms and roots of gender inequality in education, as well as their societal repercussions. Like many other institutions of society, 
educational systems are characterized by unequal treatment and opportunity for women. Almost two-thirds of the world's 862 million illiterate people are women, and the 
<em class="emphasis">illiteracy rate</em> among women is expected to increase in many regions, especially in several African and Asian countries (UNESCO 2005; 'World Bank 2007). 
</div>

  <h2 class="section-header">
    <strong class="title content-editable" contentEditable="true">Symbolic Interactionism</strong>
  </h2>
<!--
<div class="para content-editable convert-to-header" contentEditable="true">
<em class="emphasis">Symbolic Interactionism</em>
</div>
-->
<div class="para content-editable" contentEditable="true">
Symbolic interactionism sees education as one way labeling theory is seen in action. A symbolic interactionist might say that this labeling has a direct correlation to those who are 
in power and those who are being labeled. For example, low standardized test scores or poor performance in a particular class often lead to a student being labeled as a low achiever. 
Such labels are difficult to "shake off," which can create a self-fulfilling prophecy (Merton 1968).
</div>






               <div class="canvas-wrap" contenteditable="false">                  <div class="canvas canvas-unhovered figure">                    
<div class="canvas-inner">      <div style="display: none;" class="canvas-buddy-2">        <a class="edit-element" href="#" data-elementtype="figure" title="Edit options for this 
figure">          <img src="content_files/options-05.png">        </a>        <a class="remove-element" href="#" title="Remove this figure">          <img 
src="content_files/remove-element-01.png">        </a>      </div>      <div style="display: none;" class="canvas-buddy">        <a class="drag-element" href="#" title="Drag this 
figure to another location">          <img src="content_files/drag-element-19.png">        </a>      </div>                    <div class="media-block" contenteditable="false">                  
<div class="media-title">                    <span class="media-title-close" title="Remove title"><img src="content_files/remove-element-08.png"></span>                    <div 
class="hint-text">Add a title for this image (optional)</div>                  </div>                  <table class="media-table" contenteditable="false">                    <tbody>                      
<tr>                        <td class="media-table-add">                          <div style="visibility: visible; display: none;">                            Click to add another 
image here                          </div>                        </td>                        <td style="width: 200px; padding: 0 16px;">                          <span 
class="media-inner-plus-alt">                <img class="alt-warning" src="content_files/warning-01.png" title="This image is missing a description for the visually impaired.  Click 
to provide one." contenteditable="false">                  <span class="media-inner content-editable" contenteditable="true">                  

      <img src="content_files/classroom.jpg" alt="" class="image content-editable" contenteditable="true" width="300"/>
<!--
<img 
src="http://mountainbunker.org/~maxwell/oerpub/editor-ideas/content_files/cigarette-factory-200.jpg" class="image content-editable" alt="" contenteditable="true" width="200">
-->                  
<span class="image-options" contenteditable="false">                    <span class="image-add-options">                      <label class="image-options-add">Add:</label>                      
<a href="#asaefafedfas" class="image-options-title">Title</a>                      &#183;                      <a href="#asdsdfasdfs" class="image-options-caption">Caption</a>                    
</span>                    <a href="#adsfasasdfas" class="image-options-options">                      <img src="content_files/options-05.png" style="vertical-align: bottom;">                       
More options ...                    </a>                  </span>                </span>              </span>                                      </td>                        <td 
class="media-table-add">                          <div style="display: none; visibility: visible;">                            Click to add another image here                          
</div>                        </td>                      </tr>                    </tbody>                  </table>                                  <div class="media-caption" 
style="display: block;">                  <span class="cnx_label">Figure 1</span>                  <div class="media-caption-removable">                    <span 
class="media-caption-close" title="Remove caption"><img src="content_files/remove-element-08.png"></span>                    <span class="hint-text">Add a caption for this image 
(optional)</span>                  </div>                  <div style="clear: both;"></div>                </div>                              </div>                    </div>                  
</div>                </div>



  <h2 class="section-header">
    <strong class="title content-editable" contentEditable="true">Summary</strong>
  </h2>
<!--
<div class="para content-editable convert-to-header" contentEditable="true">
<em class="emphasis">Summary</em>
</div>
-->
<div class="para content-editable" contentEditable="true">
The major sociological theories offer insight into how we understand education. Functionalists view education as an important social institution that contributes both manifest and 
latent functions. Functionalists see education as serving the needs of society by preparing students for later roles, or functions, in society. Conflict theorists see schools as a 
means for perpetuating class, racial-ethnic, and gender inequalities. In the same vein, feminist theory focuses specifically on the mechanisms and roots of gender inequality in 
education. The theory of symbolic interactionism focuses on education as a means for labeling individuals.
</div>















<div class="section" style="display: none;">
  <h2 class="section-header">
    <strong class="title content-editable" contentEditable="true">Signals</strong>
  </h2>

  <div class="section-contents">

  <div class="para content-editable" id="para1" contentEditable="true">
    A signal's complexity is not related to how wiggly it is. Rather, a signal 
    expert looks for ways of <a href="http://users.ece.gatech.edu/~vkm/nii/node35.html" class="link">decomposing a given signal</a> into a  <em class="emphasis">sum of 
    simpler signals</em>, which we term the <dfn class="term">signal decomposition</dfn>. 
    Though we will never compute a signal's complexity, it essentially equals the 
    number of terms in its decomposition. In writing a signal as a sum of component 
    signals, we can change the component signal's gain by multiplying it by a constant 
    and by delaying it. 





More complicated decompositions could contain derivatives 
    or integrals of simple signals. In short, signal decomposition amounts to 
    thinking of the signal as the output of a linear system having simple signals as 
    its inputs. We would build such a system, but envisioning the signal's components
    helps understand the signal's structure. Furthermore, you can readily compute a
    linear system's output to an input decomposed as a superposition of simple signals.


<!-- Editable Equation -->
<span style="" aria-readonly="true" role="textbox" class="MathJax"><span class="asciimath" style="display: none;">x+sqrt(1-x^2)</span><span 
class="actual-math"><nobr><span id="MathJax-Span-5" 
class="math"><span 
style="display: 
inline-block; 
position: relative; 
width: 5.393em; height: 0px; font-size: 139%;"><span style="position: absolute; top: -2.18em; left: 0em; clip: rect(1.163em, 1000em, 2.455em, -0.472em);"><span 
id="MathJax-Span-6" class="mrow"><span id="MathJax-Span-7" class="mrow"><span id="MathJax-Span-8" class="mi"><img style="width: 9px; height: 7px; margin-right: 0.047em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Math/Italic/120/0078.png"></span><span style="padding-left: 0.222em;" id="MathJax-Span-9" class="mo"><img 
style="width: 12px; height: 12px; vertical-align: -1px; margin-right: 0.053em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/120/002B.png"></span><span style="padding-left: 0.222em;" id="MathJax-Span-10" 
class="msqrt"><span style="display: inline-block; position: relative; width: 3.677em; height: 0px;"><span style="position: absolute; top: -2.18em; left: 0.843em; clip: 
rect(1.273em, 1000em, 2.359em, -0.426em);"><span id="MathJax-Span-11" class="mrow"><span id="MathJax-Span-12" class="mn"><img style="width: 8px; height: 12px; 
margin-right: 0.07em;" src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/120/0031.png"></span><span style="padding-left: 0.222em;" 
id="MathJax-Span-13" class="mo"><img style="width: 12px; height: 1px; vertical-align: 4px; margin-right: 0.08em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/120/2212.png"></span><span style="padding-left: 0.222em;" id="MathJax-Span-14" 
class="msup"><span style="display: inline-block; position: relative; width: 1.105em; height: 0px;"><span style="position: absolute; top: -2.18em; left: 0em; clip: 
rect(1.588em, 1000em, 2.359em, -0.472em);"><span id="MathJax-Span-15" class="mi"><img style="width: 9px; height: 7px; margin-right: 0.047em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Math/Italic/120/0078.png"></span>&nbsp;<span style="display: inline-block; width: 0px; height: 
2.18em;"></span></span><span style="position: absolute; top: -2.469em; left: 0.637em;"><span style="font-size: 70.7%;" id="MathJax-Span-16" class="mn"><img style="width: 
6px; height: 8px; margin-right: 0.049em;" src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/085/0032.png"></span>&nbsp;<span style="display: 
inline-block; width: 0px; height: 2.18em;"></span></span></span></span></span>&nbsp;<span style="display: inline-block; width: 0px; height: 2.18em;"></span></span><span 
style="position: absolute; top: -2.77em; left: 0.843em; clip: rect(1.753em, 1000em, 2.129em, -0.506em);"><span style="display: inline-block; position: relative; width: 
2.834em; height: 0px;"><span style="position: absolute; top: -2.18em; left: -0.079em;"><img style="width: 12px; height: 1px; vertical-align: 4px; margin-right: 0.08em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/120/2212.png">&nbsp;<span style="display: inline-block; width: 0px; height: 
2.18em;"></span></span><span style="position: absolute; top: -2.18em; left: 2.171em;"><img style="width: 12px; height: 1px; vertical-align: 4px; margin-right: 0.08em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/120/2212.png">&nbsp;<span style="display: inline-block; width: 0px; height: 
2.18em;"></span></span><span style="position: absolute; top: -2.18em; left: 0.351em;"><img style="width: 12px; height: 1px; vertical-align: 4px; margin-right: 0.08em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/120/2212.png">&nbsp;<span style="display: inline-block; width: 0px; height: 
2.18em;"></span></span><span style="position: absolute; top: -2.18em; left: 0.806em;"><img style="width: 12px; height: 1px; vertical-align: 4px; margin-right: 0.08em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/120/2212.png">&nbsp;<span style="display: inline-block; width: 0px; height: 
2.18em;"></span></span><span style="position: absolute; top: -2.18em; left: 1.261em;"><img style="width: 12px; height: 1px; vertical-align: 4px; margin-right: 0.08em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/120/2212.png">&nbsp;<span style="display: inline-block; width: 0px; height: 
2.18em;"></span></span><span style="position: absolute; top: -2.18em; left: 1.716em;"><img style="width: 12px; height: 1px; vertical-align: 4px; margin-right: 0.08em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/120/2212.png">&nbsp;<span style="display: inline-block; width: 0px; height: 
2.18em;"></span></span></span>&nbsp;<span style="display: inline-block; width: 0px; height: 2.18em;"></span></span><span style="position: absolute; top: -2.264em; left: 
0em; clip: rect(1.247em, 1000em, 2.539em, -0.437em);"><span><img style="width: 15px; height: 18px; vertical-align: -4px; margin-right: -0.019em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/120/221A.png"></span>&nbsp;<span style="display: inline-block; width: 0px; height: 
2.18em;"></span></span></span></span></span></span>&nbsp;<span style="display: inline-block; width: 0px; height: 2.18em;"></span></span></span><span style="border-left: 
0em solid; display: inline-block; overflow: hidden; width: 0px; height: 1.328em; vertical-align: -0.148em;"></span></span></nobr></span>
<span class="ascii-math-error-message" style="display: none;">ASCIIMath error: syntax error</span>
<span class="math-error-message" style="display: none;">LaTeX error: sqrt requires initial backslash: \sqrt</span>
<script 
id="MathJax-Element-1" 
type="math/mml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow>
    <mi>x</mi>
    <mo>+</mo>
    <msqrt>
      <mn>1</mn>
      <mo>-</mo>
      <msup>
        <mi>x</mi>
        <mn>2</mn>
      </msup>
    </msqrt>
</mrow><annotation-xml encoding="MathML-Content"><mi xmlns:cnxorg="http://cnx.rice.edu/system-info">x</mi><mo xmlns:cnxorg="http://cnx.rice.edu/system-info">+</mo><msqrt 
xmlns:cnxorg="http://cnx.rice.edu/system-info">
      <mn>1</mn>
      <mo>-<!-- &amp;#8722; --></mo>
      <msup>
        <mi>x</mi>
        <mn>2</mn>
      </msup>
    </msqrt></annotation-xml></semantics></math></script>

</div>


<div class="canvas-wrap" contenteditable="false">
  <div class="canvas inactive example" id="ex1">
<div class="canvas-inner">
<div style="display: none;" class="canvas-buddy-2">
  <a class="edit-element" href="#" data-elementtype="example" title="Edit options for this example">
    <img src="content_files/options-05.png">
  </a>
  <a class="remove-element" href="#" title="Remove this example">
    <img src="content_files/remove-element-01.png">
  </a>
</div>
<div style="display: none;" class="canvas-buddy">
  <a class="drag-element" href="#" title="Drag this element to another location">
    <img src="content_files/drag-element-19.png">
  </a>
</div>
<h2 class="example-header"><span class="cnx_label">Example 1</span>
<strong class="title content-editable" style="display: none;" contentEditable="true">
  <span class="hint-text">Add a title (optional)</span>
</strong>
</h2><div class="example-contents">

<p class="para content-editable" id="paraex1" contentEditable="true">
      As an example of signal complexity, we can express the pulse  
      <span style="" aria-readonly="true" role="textbox" class="MathJax"><span class="asciimath" style="display: none;">p_Delta(t)</span><span 
class="actual-math"><nobr><span 
id="MathJax-Span-9" 
class="math"><span style="display: 
inline-block; 
position: 
relative; width: 2.757em; height: 0px; font-size: 139%;"><span style="position: absolute; top: -2.319em; left: 0em; clip: rect(1.277em, 1000em, 2.86em, -0.579em);"><span 
id="MathJax-Span-10" class="mrow"><span id="MathJax-Span-11" class="mrow"><span id="MathJax-Span-12" class="mrow"><span id="MathJax-Span-13" class="mrow"><span 
id="MathJax-Span-14" class="mi"></span><span id="MathJax-Span-15" class="msub"><span style="display: inline-block; position: relative; width: 1.109em; height: 0px;"><span 
style="position: absolute; top: -2.199em; left: 0em; clip: rect(1.569em, 1000em, 2.576em, -0.579em);"><span id="MathJax-Span-16" class="mi"><img style="width: 10px; 
height: 10px; vertical-align: -3px; margin-left: -0.04em; margin-right: 0.006em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Math/Italic/120/0070.png"></span>&nbsp;<span style="display: inline-block; width: 0px; height: 
2.199em;"></span></span><span style="position: absolute; top: -1.966em; left: 0.614em;"><span 
xmlns="http://www.w3.org/1999/xhtml" class="mi" id="MathJax-Span-30" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic; ">&#x394;</span><!--
<span style="font-size: 70.7%;" id="MathJax-Span-17" class="mi"><img style="width: 
7px; height: 8px; margin-right: -0.041em;" src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Italic/085/003F.png"></span>
-->&nbsp;<span style="display: 
inline-block; width: 0px; height: 2.199em;"></span></span></span></span><span id="MathJax-Span-18" class="mi"></span></span><span id="MathJax-Span-19" 
class="mo"></span><span style="padding-left: 0.278em;" id="MathJax-Span-20" class="mfenced"><span style="vertical-align: -0.005em;" id="MathJax-Span-21" 
class="mo"><span><img style="width: 7px; height: 20px; vertical-align: -6px; margin-right: 0.037em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Size1/Regular/120/0028.png"></span></span><span id="MathJax-Span-22" class="mrow"><span 
id="MathJax-Span-23" class="mi"><img style="width: 6px; height: 10px; margin-right: 0.032em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Math/Italic/120/0074.png"></span></span><span style="vertical-align: -0.006em;" id="MathJax-Span-24" 
class="mo"><span><img style="width: 6px; height: 20px; vertical-align: -6px; margin-right: 0.156em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Size1/Regular/120/0029.png"></span></span><span style="border-left: 0em solid; display: inline-block; 
overflow: hidden; width: 0px; height: 0.861em; vertical-align: 0em;"></span><span style="border-left: 0em solid; display: inline-block; overflow: hidden; width: 0px; 
height: 0.861em; vertical-align: 0em;"></span></span></span></span></span>&nbsp;<span style="display: inline-block; width: 0px; height: 
2.319em;"></span></span></span><span style="border-left: 0em solid; display: inline-block; overflow: hidden; width: 0px; height: 1.7em; vertical-align: 
-0.502em;"></span></span></nobr></span></span><script type="math/mml" id="MathJax-Element-1">&lt;math xmlns="http://www.w3.org/1998/Math/MathML" 
display="inline"&gt;&lt;semantics&gt;&lt;mrow&gt;
        &lt;mrow&gt;&lt;mrow&gt;&lt;mi&gt;&lt;/mi&gt;&lt;msub&gt;
              &lt;mi&gt;p&lt;/mi&gt;
              &lt;mi&gt;?&lt;/mi&gt;
            &lt;/msub&gt;&lt;mi&gt;&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&lt;/mo&gt;&lt;mfenced open="(" close=")" 
separators=","&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfenced&gt;&lt;/mrow&gt;
      &lt;/mrow&gt;&lt;annotation-xml encoding="MathML-Content"&gt;&lt;apply&gt;
          &lt;ci type="fn"&gt;
            &lt;msub&gt;
              &lt;mi&gt;p&lt;/mi&gt;
              &lt;mi&gt;?&lt;/mi&gt;
            &lt;/msub&gt;
          &lt;/ci&gt;
          &lt;ci&gt;t&lt;/ci&gt;
        &lt;/apply&gt;&lt;/annotation-xml&gt;&lt;/semantics&gt;&lt;/math&gt;</script>
      as a sum of delayed unit steps.
</p>



<div class="canvas-wrap" contenteditable="false">
      <div class="equation canvas inactive" id="eq1">
<div class="canvas-inner">
<div style="display: none;" class="canvas-buddy-2">
  <a class="edit-element" href="#" data-elementtype="equation" title="Edit options for this equation">
    <img src="content_files/options-05.png">
  </a>
  <a class="remove-element" href="#" title="Remove this element">
    <img src="content_files/remove-element-01.png">
  </a>
</div>
<div style="display: none;" class="canvas-buddy">
  <a class="drag-element" href="#" title="Drag this element to another location">
    <img src="content_files/drag-element-19.png">
  </a>
</div>
<h2 class="equation-header">
<strong class="title content-editable" style="display: none;" contentEditable="true">
  <span class="hint-text">Add a title (optional)</span>
</strong>
</h2>
<div class="equation-contents"> 
        <div aria-readonly="true" role="textbox" style="width: 100%; position: relative; text-align: center;" class="MathJax_Display"><span style="" 
class="MathJax"><span class="asciimath" style="display: none;">p_Delta(t) = u(t) - u(t-Delta)</span><span 
class="actual-math"><nobr><span 
id="MathJax-Span-25" class="math"><span style="display: inline-block; position: relative; width: 11.688em; height: 0px; font-size: 
139%;"><span style="position: absolute; top: -2.319em; left: 0em; clip: rect(1.277em, 1000em, 2.86em, -0.579em);"><span id="MathJax-Span-26" class="mrow"><span 
id="MathJax-Span-27" class="mrow"><span id="MathJax-Span-28" class="mrow"><span id="MathJax-Span-29" class="mrow"><span id="MathJax-Span-30" class="mrow"><span 
id="MathJax-Span-31" class="mi"></span><span id="MathJax-Span-32" class="msub"><span style="display: inline-block; position: relative; width: 1.109em; height: 0px;"><span 
style="position: absolute; top: -2.199em; left: 0em; clip: rect(1.569em, 1000em, 2.576em, -0.579em);"><span id="MathJax-Span-33" class="mi"><img style="width: 10px; 
height: 10px; vertical-align: -3px; margin-left: -0.04em; margin-right: 0.006em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Math/Italic/120/0070.png"></span>&nbsp;<span style="display: inline-block; width: 0px; height: 
2.199em;"></span></span><span style="position: absolute; top: -1.966em; left: 0.614em;"><span 
xmlns="http://www.w3.org/1999/xhtml" class="mi" id="MathJax-Span-30" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic; ">&#x394;</span><!--
<span style="font-size: 70.7%;" id="MathJax-Span-34" class="mi"><img style="width: 
7px; height: 8px; margin-right: -0.041em;" src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Italic/085/003F.png"></span>-->&nbsp;<span style="display: 
inline-block; width: 0px; height: 2.199em;"></span></span></span></span><span id="MathJax-Span-35" class="mi"></span></span><span id="MathJax-Span-36" 
class="mo"></span><span style="padding-left: 0.278em;" id="MathJax-Span-37" class="mfenced"><span style="vertical-align: -0.005em;" id="MathJax-Span-38" 
class="mo"><span><img style="width: 7px; height: 20px; vertical-align: -6px; margin-right: 0.037em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Size1/Regular/120/0028.png"></span></span><span id="MathJax-Span-39" class="mrow"><span 
id="MathJax-Span-40" class="mi"><img style="width: 6px; height: 10px; margin-right: 0.032em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Math/Italic/120/0074.png"></span></span><span style="vertical-align: -0.006em;" id="MathJax-Span-41" 
class="mo"><span><img style="width: 6px; height: 20px; vertical-align: -6px; margin-right: 0.156em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Size1/Regular/120/0029.png"></span></span><span style="border-left: 0em solid; display: inline-block; 
overflow: hidden; width: 0px; height: 0.861em; vertical-align: 0em;"></span><span style="border-left: 0em solid; display: inline-block; overflow: hidden; width: 0px; 
height: 0.861em; vertical-align: 0em;"></span></span></span></span><span style="padding-left: 0.278em;" id="MathJax-Span-42" class="mrow"><span id="MathJax-Span-43" 
class="mo"><img style="width: 12px; height: 4px; vertical-align: 2px; margin-right: 0.057em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/120/003D.png"></span></span><span style="padding-left: 0.278em;" id="MathJax-Span-44" 
class="mrow"><span id="MathJax-Span-45" class="mrow"><span id="MathJax-Span-46" class="mrow"><span id="MathJax-Span-47" class="mrow"><span id="MathJax-Span-48" 
class="mi"><img style="width: 10px; height: 7px; margin-right: 0.021em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Math/Italic/120/0075.png"></span></span><span id="MathJax-Span-49" class="mo"></span><span 
style="padding-left: 0.278em;" id="MathJax-Span-50" class="mfenced"><span style="vertical-align: -0.005em;" id="MathJax-Span-51" class="mo"><span><img style="width: 7px; 
height: 20px; vertical-align: -6px; margin-right: 0.037em;" src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Size1/Regular/120/0028.png"></span></span><span 
id="MathJax-Span-52" class="mrow"><span id="MathJax-Span-53" class="mi"><img style="width: 6px; height: 10px; margin-right: 0.032em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Math/Italic/120/0074.png"></span></span><span style="vertical-align: -0.006em;" id="MathJax-Span-54" 
class="mo"><span><img style="width: 6px; height: 20px; vertical-align: -6px; margin-right: 0.156em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Size1/Regular/120/0029.png"></span></span><span style="border-left: 0em solid; display: inline-block; 
overflow: hidden; width: 0px; height: 0.861em; vertical-align: 0em;"></span><span style="border-left: 0em solid; display: inline-block; overflow: hidden; width: 0px; 
height: 0.861em; vertical-align: 0em;"></span></span></span><span style="padding-left: 0.222em;" id="MathJax-Span-55" class="mo"><img style="width: 12px; height: 1px; 
vertical-align: 4px; margin-right: 0.086em;" src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/120/2212.png"></span><span style="padding-left: 
0.222em;" id="MathJax-Span-56" class="mrow"><span id="MathJax-Span-57" class="mrow"><span id="MathJax-Span-58" class="mi"><img style="width: 10px; height: 7px; 
margin-right: 0.021em;" src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Math/Italic/120/0075.png"></span></span><span id="MathJax-Span-59" 
class="mo"></span><span style="padding-left: 0.278em;" id="MathJax-Span-60" class="mfenced"><span style="vertical-align: -0.005em;" id="MathJax-Span-61" 
class="mo"><span><img style="width: 7px; height: 20px; vertical-align: -6px; margin-right: 0.037em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Size1/Regular/120/0028.png"></span></span><span id="MathJax-Span-62" class="mrow"><span 
id="MathJax-Span-63" class="mrow"><span id="MathJax-Span-64" class="mi"><img style="width: 6px; height: 10px; margin-right: 0.032em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Math/Italic/120/0074.png"></span></span><span style="padding-left: 0.222em;" id="MathJax-Span-65" 
class="mo"><img style="width: 12px; height: 1px; vertical-align: 4px; margin-right: 0.086em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/120/2212.png"></span><span style="padding-left: 0.222em;" id="MathJax-Span-66" 
class="mrow"><!--<span id="MathJax-Span-67" class="mi">
<img style="width: 10px; height: 11px; margin-right: -0.041em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Italic/120/003F.png"></span>
--><span xmlns="http://www.w3.org/1999/xhtml" class="mi" id="MathJax-Span-30" style="font-family: MathJax_Math; font-style: italic;">&#x394;</span></span></span><span 
style="vertical-align: -0.006em;" id="MathJax-Span-68" 
class="mo"><span><img style="width: 6px; height: 20px; vertical-align: -6px; margin-right: 0.156em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Size1/Regular/120/0029.png"></span></span><span style="border-left: 0em solid; display: inline-block; 
overflow: hidden; width: 0px; height: 0.861em; vertical-align: 0em;"></span><span style="border-left: 0em solid; display: inline-block; overflow: hidden; width: 0px; 
height: 0.861em; vertical-align: 0em;"></span></span></span></span></span></span></span>&nbsp;<span style="display: inline-block; width: 0px; height: 
2.319em;"></span></span></span><span style="border-left: 0em solid; display: inline-block; overflow: hidden; width: 0px; height: 1.7em; vertical-align: 
-0.502em;"></span></span></nobr></span></span></div><script type="math/mml" id="MathJax-Element-2">&lt;math xmlns="http://www.w3.org/1998/Math/MathML" 
display="block"&gt;&lt;semantics&gt;&lt;mrow&gt;
          &lt;mrow&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mi&gt;&lt;/mi&gt;&lt;msub&gt;
                    &lt;mi&gt;p&lt;/mi&gt;
                    &lt;mi&gt;?&lt;/mi&gt;
                  &lt;/msub&gt;&lt;mi&gt;&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&lt;/mo&gt;&lt;mfenced open="(" close=")" 
separators=","&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfenced&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&lt;/mo&gt;&lt;mfenced 
open="(" close=")" 
separators=","&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfenced&gt;&lt;/mrow&gt;&lt;mo&gt;-&lt;/mo&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&lt;/mo&gt;&lt;mfenced 
open="(" close=")" 
separators=","&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;-&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;?&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mfenced&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mrow&gt;
        &lt;/mrow&gt;&lt;annotation-xml encoding="MathML-Content"&gt;&lt;apply&gt;
            &lt;eq/&gt;
              &lt;apply&gt;
                &lt;ci type="fn"&gt;
                  &lt;msub&gt;
                    &lt;mi&gt;p&lt;/mi&gt;
                    &lt;mi&gt;?&lt;/mi&gt;
                  &lt;/msub&gt;
                &lt;/ci&gt;
                &lt;ci&gt;t&lt;/ci&gt;
              &lt;/apply&gt;
              &lt;apply&gt;
                &lt;minus/&gt;
                &lt;apply&gt;
                    &lt;ci type="fn"&gt;u&lt;/ci&gt;
                  &lt;ci&gt;t&lt;/ci&gt;
                &lt;/apply&gt;
                &lt;apply&gt;
                    &lt;ci type="fn"&gt;u&lt;/ci&gt;
                  &lt;apply&gt;

                      &lt;minus/&gt;
                        &lt;ci&gt;t&lt;/ci&gt;
                        &lt;ci&gt;?&lt;/ci&gt;
                  &lt;/apply&gt;
                &lt;/apply&gt;

              &lt;/apply&gt;
          &lt;/apply&gt;&lt;/annotation-xml&gt;&lt;/semantics&gt;&lt;/math&gt;</script>
      </div><span class="equation-number">(1)</span></div>
</div>
</div>

      Thus, the pulse is a more complex signal than the step. Be that as it may,
      the pulse is very useful to us.
    <p></p></div>
</div>
</div>
</div>


<div class="canvas-wrap">
  <div class="canvas inactive exercise" id="swsuper">
<div class="canvas-inner">
<div style="display: none;" class="canvas-buddy-2">
  <a class="edit-element" href="#" title="Edit options for this element">
    <img src="content_files/options-05.png" style="">
  </a>
  <a class="remove-element" href="#" title="Remove this element">
    <img src="content_files/remove-element-01.png">
  </a>
</div>
<div style="display: none;" class="canvas-buddy">
  <a class="drag-element" href="#" title="Drag this element to another location">
    <img src="content_files/drag-element-19.png">
  </a>
</div>
<h2 class="exercise-header"><span class="cnx_label">Exercise 1</span>
<strong class="title content-editable" style="display: none;" contentEditable="true">
  <span class="hint-text">Add a title (optional)</span>
</strong>
</h2><div class="exercise-contents"><div class="problem"><div class="problem-contents">

      <p class="para content-editable" id="swsupera" contentEditable="true">
        Express a square wave having period   
        <span style="" aria-readonly="true" role="textbox" class="MathJax"><span class="asciimath" style="display: none;">T</span><span 
class="actual-math"><nobr><span 
id="MathJax-Span-69" class="math"><span style="display: inline-block; position: 
relative; width: 0.599em; height: 0px; font-size: 139%;"><span style="position: absolute; top: -2.199em; left: 0em; clip: rect(1.328em, 1000em, 2.379em, -0.518em);"><span 
id="MathJax-Span-70" class="mrow"><span id="MathJax-Span-71" class="mrow"><span id="MathJax-Span-72" class="mrow"><span id="MathJax-Span-73" class="mi"><img style="width: 
12px; height: 11px; margin-right: -0.123em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Math/Italic/120/0054.png"></span></span></span></span>&nbsp;<span style="display: inline-block; width: 0px; 
height: 2.199em;"></span></span></span><span style="border-left: 0em solid; display: inline-block; overflow: hidden; width: 0px; height: 0.96em; vertical-align: 
0em;"></span></span></nobr></span></span><script type="math/mml" id="MathJax-Element-3">&lt;math xmlns="http://www.w3.org/1998/Math/MathML" 
display="inline"&gt;&lt;semantics&gt;&lt;mrow&gt;
          &lt;mrow&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;
        &lt;/mrow&gt;&lt;annotation-xml encoding="MathML-Content"&gt;&lt;ci&gt;T&lt;/ci&gt;&lt;/annotation-xml&gt;&lt;/semantics&gt;&lt;/math&gt;</script> and amplitude
        <span style="" aria-readonly="true" role="textbox" class="MathJax"><span class="asciimath" style="display: none;">A</span><span 
class="actual-math"><nobr><span 
id="MathJax-Span-74" class="math"><span style="display: inline-block; position: 
relative; width: 0.779em; height: 0px; font-size: 139%;"><span style="position: absolute; top: -2.199em; left: 0em; clip: rect(1.288em, 1000em, 2.379em, -0.504em);"><span 
id="MathJax-Span-75" class="mrow"><span id="MathJax-Span-76" class="mrow"><span id="MathJax-Span-77" class="mrow"><span id="MathJax-Span-78" class="mi"><img style="width: 
13px; height: 11px; margin-right: 0.023em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Math/Italic/120/0041.png"></span></span></span></span>&nbsp;<span style="display: inline-block; width: 0px; 
height: 2.199em;"></span></span></span><span style="border-left: 0em solid; display: inline-block; overflow: hidden; width: 0px; height: 1.016em; vertical-align: 
0em;"></span></span></nobr></span></span><script type="math/mml" id="MathJax-Element-4">&lt;math xmlns="http://www.w3.org/1998/Math/MathML" 
display="inline"&gt;&lt;semantics&gt;&lt;mrow&gt;
          &lt;mrow&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;/mrow&gt;
        &lt;/mrow&gt;&lt;annotation-xml encoding="MathML-Content"&gt;&lt;ci&gt;A&lt;/ci&gt;&lt;/annotation-xml&gt;&lt;/semantics&gt;&lt;/math&gt;</script>
        as a superposition of delayed and amplitude-scaled pulses.
      </p>

    </div></div>
<div class="canvas-wrap">
<div class="solution canvas inactive" style="display: block;">
<div class="canvas-inner">
<div style="display: none;" class="canvas-buddy-2">
  <a class="edit-element" href="#" title="Edit options for this element">
    <img src="content_files/options-05.png" style="">
  </a>
  <a class="remove-element" href="#" title="Remove this element">
    <img src="content_files/remove-element-01.png">
  </a>
</div>
<div class="canvas-buddy nodrag" style="cursor: auto; display: none;">
  <a class="drag-element" href="#" title="You can only drag this element within exercises!">
    <img src="content_files/drag-element-19.png">
  </a>
</div>
<h3 class="solution-header"><span class="cnx_label">Solution</span>
<!--
<strong class="title content-editable" style="display: none;" contentEditable="true">
  <span class="hint-text">Add a title (optional)</span>
</strong>
-->
</h3><div class="solution-contents">

<p class="para content-editable" id="swsuperb" contentEditable="true">
        <span style="" aria-readonly="true" role="textbox" class="MathJax"><span class="asciimath" style="display: none;">sq(t) sum_(n=-infty)^infty 
(-1)^n A p_{p/2}{t-n{T/2}}</span><span 
class="actual-math"><nobr><span 
id="MathJax-Span-79" 
class="math"><span 
style="display: 
inline-block; position: 
relative; width: 16.843em; height: 0px; font-size: 139%;"><span style="position: absolute; top: -2.858em; left: 0em; clip: rect(1.143em, 1000em, 3.819em, 
-0.507em);"><span id="MathJax-Span-80" class="mrow"><span id="MathJax-Span-81" class="mrow"><span id="MathJax-Span-82" class="mrow"><span id="MathJax-Span-83" 
class="mrow"><span id="MathJax-Span-84" class="mrow"><span id="MathJax-Span-85" class="mi"><img style="width: 6px; height: 8px; margin-right: 0.036em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/120/0073.png"><img style="width: 9px; height: 12px; vertical-align: -4px; margin-right: 
-0.007em;" src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/120/0071.png"></span></span><span id="MathJax-Span-86" class="mo"></span><span 
style="padding-left: 0.278em;" id="MathJax-Span-87" class="mfenced"><span style="vertical-align: -0.005em;" id="MathJax-Span-88" class="mo"><span><img style="width: 7px; 
height: 20px; vertical-align: -6px; margin-right: 0.037em;" src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Size1/Regular/120/0028.png"></span></span><span 
id="MathJax-Span-89" class="mrow"><span id="MathJax-Span-90" class="mi"><img style="width: 6px; height: 10px; margin-right: 0.032em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Math/Italic/120/0074.png"></span></span><span style="vertical-align: -0.006em;" id="MathJax-Span-91" 
class="mo"><span><img style="width: 6px; height: 20px; vertical-align: -6px; margin-right: 0.156em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Size1/Regular/120/0029.png"></span></span><span style="border-left: 0em solid; display: inline-block; 
overflow: hidden; width: 0px; height: 0.861em; vertical-align: 0em;"></span><span style="border-left: 0em solid; display: inline-block; overflow: hidden; width: 0px; 
height: 0.861em; vertical-align: 0em;"></span></span></span>
<!--
<span style="padding-left: 0.278em;" id="MathJax-Span-92" class="mo"><img style="width: 12px; height: 4px; 
vertical-align: 2px; margin-right: 0.057em;" src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/120/003D.png"></span>
-->
<span xmlns="http://www.w3.org/1999/xhtml" class="mo" id="MathJax-Span-214" style="font-family: MathJax_Size1; font-size: 1.3em; vertical-align: 0em;">&#x3a3;</span>
<span 
id="MathJax-Span-93" 
class="mrow"><span id="MathJax-Span-94" class="munderover"><span style="display: inline-block; position: relative; width: 2.038em; height: 0px;"><span style="position: 
absolute; top: -2.199em; left: 0.779em; clip: rect(1.3em, 1000em, 2.378em, -0.483em);"><!--
<span id="MathJax-Span-95" class="mo"><img style="width: 7px; height: 12px; 
margin-right: 0.057em;" src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/120/003F.png"></span>
--><!--<span xmlns="http://www.w3.org/1999/xhtml" class="mi" id="MathJax-Span-216" style="font-family: MathJax_Main; ">&#x221e;</span>&nbsp;<span style="display: 
inline-block; width: 
0px; height: 2.199em;"></span>--></span><span style="position: absolute; top: -1.517em; left: 0em; clip: rect(1.503em, 1000em, 2.479em, -0.539em);"><span 
id="MathJax-Span-96" class="mrow"><span style="font-size: 70.7%;" id="MathJax-Span-97" class="mi"><span id="MathJax-Span-98" class="mrow"><span style="font-size: 70.7%;" 
id="MathJax-Span-99" class="mi"><img style="width: 7px; height: 5px; margin-right: 0.02em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Math/Italic/085/006E.png"></span></span></span><span style="font-size: 70.7%;" id="MathJax-Span-100" 
class="mi"><img style="width: 10px; height: 3px; vertical-align: 1px; margin-right: -0.009em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Italic/085/003D.png"></span><span id="MathJax-Span-101" class="mrow"><span style="font-size: 70.7%;" 
id="MathJax-Span-102" class="mo"><img style="width: 9px; height: 1px; vertical-align: 2px; margin-right: 0.085em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/085/2212.png"></span><!--
<span style="font-size: 70.7%;" id="MathJax-Span-103" class="mi"><img 
style="width: 7px; height: 8px; margin-right: -0.041em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Italic/085/003F.png"></span>
--><span xmlns="http://www.w3.org/1999/xhtml" class="mi" id="MathJax-Span-216" style="font-size: 70.7%; font-family: MathJax_Main;">&#x221e;</span></span></span>&nbsp;<span 
style="display: inline-block; width: 0px; 
height: 2.199em;"></span></span><span style="position: absolute; top: -3.118em; left: 0.809em; clip: rect(1.403em, 1000em, 2.379em, -0.399em);"><span 
id="MathJax-Span-104" class="mrow"><!--
<span style="font-size: 70.7%;" id="MathJax-Span-105" class="mi"><img style="width: 7px; height: 8px; margin-right: -0.041em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Italic/085/003F.png"></span>
--><span xmlns="http://www.w3.org/1999/xhtml" class="mi" id="MathJax-Span-216" style="font-size: 70.7%; font-family: MathJax_Main; ">&#x221e;</span></span>&nbsp;<span 
style="display: inline-block; width: 0px; height: 
2.199em;"></span></span></span></span><span id="MathJax-Span-106" class="mrow"><span id="MathJax-Span-107" class="msup"><span style="display: inline-block; position: 
relative; width: 2.907em; height: 0px;"><span style="position: absolute; top: -2.319em; left: 0em; clip: rect(1.277em, 1000em, 2.86em, -0.385em);"><span 
id="MathJax-Span-108" class="mfenced"><span style="vertical-align: -0.005em;" id="MathJax-Span-109" class="mo"><span><img style="width: 7px; height: 20px; vertical-align: 
-6px; margin-right: 0.037em;" src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Size1/Regular/120/0028.png"></span></span><span id="MathJax-Span-110" 
class="mrow"><span id="MathJax-Span-111" class="mo"><img style="width: 12px; height: 1px; vertical-align: 4px; margin-right: 0.086em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/120/2212.png"></span><span id="MathJax-Span-112" class="mn"><img style="width: 8px; height: 
12px; margin-right: 0.074em;" src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/120/0031.png"></span></span><span style="vertical-align: 
-0.006em;" id="MathJax-Span-113" class="mo"><span><img style="width: 6px; height: 20px; vertical-align: -6px; margin-right: 0.156em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Size1/Regular/120/0029.png"></span></span><span style="border-left: 0em solid; display: inline-block; 
overflow: hidden; width: 0px; height: 0.861em; vertical-align: 0em;"></span><span style="border-left: 0em solid; display: inline-block; overflow: hidden; width: 0px; 
height: 0.861em; vertical-align: 0em;"></span></span>&nbsp;<span style="display: inline-block; width: 0px; height: 2.319em;"></span></span><span style="position: 
absolute; top: -2.787em; left: 2.413em;"><span id="MathJax-Span-114" class="mrow"><span style="font-size: 70.7%;" id="MathJax-Span-115" class="mi"><img style="width: 7px; 
height: 5px; margin-right: 0.02em;" src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Math/Italic/085/006E.png"></span></span>&nbsp;<span style="display: 
inline-block; width: 0px; height: 2.199em;"></span></span></span></span><span id="MathJax-Span-116" class="mo"></span><span style="padding-left: 0.278em;" 
id="MathJax-Span-117" class="mrow"><span id="MathJax-Span-118" class="mi"><img style="width: 13px; height: 11px; margin-right: 0.023em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Math/Italic/120/0041.png"></span></span><span id="MathJax-Span-119" class="mo"></span><span 
style="padding-left: 0.278em;" id="MathJax-Span-120" class="mrow"><span id="MathJax-Span-121" class="mi"></span><span id="MathJax-Span-122" class="msub"><span 
style="display: inline-block; position: relative; width: 2.008em; height: 0px;"><span style="position: absolute; top: -2.199em; left: 0em; clip: rect(1.569em, 1000em, 
2.576em, -0.579em);"><span id="MathJax-Span-123" class="mi"><img style="width: 10px; height: 10px; vertical-align: -3px; margin-left: -0.04em; margin-right: 0.006em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Math/Italic/120/0070.png"></span>&nbsp;<span style="display: inline-block; width: 0px; height: 
2.199em;"></span></span><span style="position: absolute; top: -1.966em; left: 0.614em;"><span style="font-size: 70.7%;" id="MathJax-Span-124" class="mi"><img 
style="width: 8px; height: 8px; margin-right: 0.038em;" src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/085/0054.png"><img style="width: 6px; 
height: 11px; vertical-align: -3px; margin-right: 0.056em;" src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/085/002F.png"><img style="width: 
6px; height: 8px; margin-right: 0.052em;" src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/085/0032.png"></span>&nbsp;<span style="display: 
inline-block; width: 0px; height: 2.199em;"></span></span></span></span><span id="MathJax-Span-125" class="mi"></span></span><span id="MathJax-Span-126" 
class="mo"></span><span style="padding-left: 0.278em;" id="MathJax-Span-127" class="mrow"><span style="vertical-align: -0.005em;" id="MathJax-Span-128" 
class="mo"><span><img style="width: 10px; height: 30px; vertical-align: -11px; margin-right: 0.037em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Size2/Regular/120/0028.png"></span></span><span id="MathJax-Span-129" class="mrow"><span 
id="MathJax-Span-130" class="mi"><img style="width: 6px; height: 10px; margin-right: 0.032em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Math/Italic/120/0074.png"></span></span><span style="padding-left: 0.222em;" id="MathJax-Span-131" 
class="mo"><img style="width: 12px; height: 1px; vertical-align: 4px; margin-right: 0.086em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/120/2212.png"></span><span style="padding-left: 0.222em;" id="MathJax-Span-132" 
class="mrow"><span id="MathJax-Span-133" class="mrow"><span id="MathJax-Span-134" class="mi"><img style="width: 10px; height: 7px; margin-right: 0.02em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Math/Italic/120/006E.png"></span></span><span id="MathJax-Span-135" class="mo"></span><span 
style="padding-left: 0.398em; padding-right: 0.12em;" id="MathJax-Span-136" class="mfrac"><span style="display: inline-block; position: relative; width: 0.6em; height: 
0px;"><span style="position: absolute; top: -2.621em; left: 50%; clip: rect(1.531em, 1000em, 2.379em, -0.524em); margin-left: -0.24em;"><span id="MathJax-Span-137" 
class="mrow"><span style="font-size: 70.7%;" id="MathJax-Span-138" class="mi"><img style="width: 9px; height: 8px; margin-right: -0.123em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Math/Italic/085/0054.png"></span></span>&nbsp;<span style="display: inline-block; width: 0px; height: 
2.199em;"></span></span><span style="position: absolute; top: -1.797em; left: 50%; clip: rect(1.54em, 1000em, 2.379em, -0.504em); margin-left: -0.21em;"><span 
style="font-size: 70.7%;" id="MathJax-Span-139" class="mn"><img style="width: 6px; height: 8px; margin-right: 0.052em;" 
src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Main/Regular/085/0032.png"></span>&nbsp;<span style="display: inline-block; width: 0px; height: 
2.199em;"></span></span><span style="position: absolute; top: -2.419em; left: 0em; clip: rect(1.944em, 1000em, 2.379em, -0.539em);"><span style="border-left: 0.6em solid; 
display: inline-block; overflow: hidden; width: 0px; height: 0.075em; vertical-align: 0em;"></span>&nbsp;<span style="display: inline-block; width: 0px; height: 
2.199em;"></span></span></span></span></span><span style="vertical-align: -0.006em;" id="MathJax-Span-140" class="mo"><span><img style="width: 7px; height: 30px; 
vertical-align: -11px; margin-right: 0.184em;" src="http://cnx.org/++resource++mathjax/fonts/HTML-CSS/TeX/png/Size2/Regular/120/0029.png"></span></span><span 
style="border-left: 0em solid; display: inline-block; overflow: hidden; width: 0px; height: 1.167em; vertical-align: 0em;"></span><span style="border-left: 0em solid; 
display: inline-block; overflow: hidden; width: 0px; height: 1.167em; vertical-align: 0em;"></span></span></span></span></span></span></span>&nbsp;<span style="display: 
inline-block; width: 0px; height: 2.858em;"></span></span></span><span style="border-left: 0em solid; display: inline-block; overflow: hidden; width: 0px; height: 
3.221em; vertical-align: -1.086em;"></span></span></nobr></span></span><script type="math/mml" id="MathJax-Element-5">&lt;math xmlns="http://www.w3.org/1998/Math/MathML" 
display="inline"&gt;&lt;semantics&gt;&lt;mrow&gt;
          &lt;mrow&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mi&gt;sq&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&lt;/mo&gt;&lt;mfenced open="(" close=")" 
separators=","&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfenced&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow&gt;&lt;munderover&gt;&lt;mo&gt;?&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;
                  &lt;mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;
                
&lt;/mi&gt;&lt;mi&gt;=&lt;/mi&gt;&lt;mrow&gt;&lt;mo&gt;-&lt;/mo&gt;&lt;mi&gt;?&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;?&lt;/mi&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;mrow&gt;&lt;msup&gt;&lt;mfenced 
separators=" 
"&gt;&lt;mrow&gt;&lt;mo&gt;-&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/mfenced&gt;&lt;mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo&gt;&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;
                    &lt;/mi&gt;&lt;msub&gt;
                      &lt;mi&gt;p&lt;/mi&gt;
                      &lt;mi&gt;T/2&lt;/mi&gt;
                    &lt;/msub&gt;&lt;mi&gt;
                  
&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;-&lt;/mo&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mfrac&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mrow&gt;
        &lt;/mrow&gt;&lt;annotation-xml encoding="MathML-Content"&gt;&lt;apply&gt;
            &lt;eq/&gt;
              &lt;apply&gt;
                &lt;ci type="fn"&gt;sq&lt;/ci&gt;
                &lt;ci&gt;t&lt;/ci&gt;
              &lt;/apply&gt;
              &lt;apply&gt;
                &lt;sum/&gt;
                &lt;bvar&gt;
                  &lt;ci&gt;n&lt;/ci&gt;
                &lt;/bvar&gt;
                &lt;lowlimit&gt;
                  &lt;apply&gt;
                    &lt;minus/&gt;
                    &lt;infinity/&gt;
                  &lt;/apply&gt;
                  &lt;/lowlimit&gt;
                &lt;uplimit&gt;
                  &lt;infinity/&gt;
                &lt;/uplimit&gt;
                 &lt;apply&gt;
                  &lt;times/&gt;
                  &lt;apply&gt;
                    &lt;power/&gt;
                      &lt;apply&gt;
                        &lt;minus/&gt;
                          &lt;cn&gt;1&lt;/cn&gt;
                      &lt;/apply&gt;
                      &lt;ci&gt;n&lt;/ci&gt;
                  &lt;/apply&gt;
                  &lt;ci&gt;A&lt;/ci&gt;
                  &lt;ci&gt;
                    &lt;msub&gt;
                      &lt;mi&gt;p&lt;/mi&gt;
                      &lt;mi&gt;T/2&lt;/mi&gt;
                    &lt;/msub&gt;
                  &lt;/ci&gt;
                  &lt;apply&gt;
                    &lt;minus/&gt;
                      &lt;ci&gt;t&lt;/ci&gt;
                      &lt;apply&gt;
                        &lt;times/&gt;
                          &lt;ci&gt;n&lt;/ci&gt;
                          &lt;apply&gt;
                            &lt;divide/&gt;
                            &lt;ci&gt;T&lt;/ci&gt;
                            &lt;cn&gt;2&lt;/cn&gt;
                          &lt;/apply&gt;
                      &lt;/apply&gt;
                    &lt;/apply&gt;
                &lt;/apply&gt;
              &lt;/apply&gt;
          &lt;/apply&gt;&lt;/annotation-xml&gt;&lt;/semantics&gt;&lt;/math&gt;</script>
      </p>


<div class="canvas-wrap">
  <div class="canvas inactive rule" id="rulephth">
<div class="canvas-inner">
<div style="display: none;" class="canvas-buddy-2">
  <a class="edit-element" href="#" title="Edit options for this element">
    <img src="content_files/options-05.png">
  </a>
  <a class="remove-element" href="#" title="Remove this element">
    <img src="content_files/remove-element-01.png">
  </a>
</div>
<div style="display: none;" class="canvas-buddy">
  <a class="drag-element" href="#" title="Drag this element to another location">
    <img src="content_files/drag-element-19.png">
  </a>
</div>


<h3 class="rule-header"><span class="cnx_label">Theorem 1: </span>
<strong class="title content-editable" contentEditable="true">Pythagorean 
Theorem</strong></h3><div class="rule-contents"><div class="statement"><p class="para content-editable" id="st1" contentEditable="true">On a right triangle, the sum of 
the
            squares of the sides equals the square of the hypotenus.
          </p></div>

<div class="canvas-wrap">
  <div class="canvas inactive proof">
<div class="canvas-inner">
<div style="display: none;" class="canvas-buddy-2">
  <a class="edit-element" href="#" title="Edit options for this element">
    <img src="content_files/options-05.png">
  </a>
  <a class="remove-element" href="#" title="Remove this element">
    <img src="content_files/remove-element-01.png">
  </a>
</div>
<div style="display: none;" class="canvas-buddy nodrag">
  <a class="drag-element" href="#" title="You can only drag this element to another rule!">
    <img src="content_files/drag-element-19.png">
  </a>
</div>


<h4 class="proof-header"><span class="cnx_label">Proof</span>
<strong class="title content-editable" style="display: none;" contentEditable="true">
  <span class="hint-text">Add a title (optional)</span>
</strong>
</h4>

<p class="para content-editable" id="phthexp1" contentEditable="true">
            Take a right triangle whose sides are of length 3, 4, and 5.
            In this case the sum of the square of the two shorter sides is
            9+16=25.  The square of the hypotenus is 25.  So the theorem holds.
          </p>

<div class="canvas-wrap">
  <div class="canvas note inactive">
<div class="canvas-inner">
<div style="display: none;" class="canvas-buddy-2">
  <a class="edit-element" href="#" title="Edit options for this element">
    <img src="content_files/options-05.png">
  </a>
  <a class="remove-element" href="#" title="Remove this element">
    <img src="content_files/remove-element-01.png">
  </a>
</div>
<div style="display: none;" class="canvas-buddy">
  <a class="drag-element" href="#" title="Drag this element to another location">
    <img src="content_files/drag-element-19.png">
  </a>
</div>

<h4 class="note-header"><span class="cnx_label">note: </span></h4><div class="note-contents content-editable" contentEditable="true">

The Pythagorean Theorem does not apply to <dfn class="term">acute</dfn> and <dfn class="term">obtuse</dfn> triangles.  It can only be applied to right triangles.  
However, a corollary of the Pythagorean theorem's converse is a simple means of determining whether a triangle is right, obtuse, or acute. 

<div class="canvas-wrap">
  <div class="canvas inactive example" id="ex2">
<div class="canvas-inner">
<div style="display: none;" class="canvas-buddy-2">
  <a class="edit-element" href="#" title="Edit options for this element">
    <img src="content_files/options-05.png">
  </a>
  <a class="remove-element" href="#" title="Remove this element">
    <img src="content_files/remove-element-01.png">
  </a>
</div>
<div style="display: none;" class="canvas-buddy">
  <a class="drag-element" href="#" title="Drag this element to another location">
    <img src="content_files/drag-element-19.png">
  </a>
</div>
<h2 class="example-header"><span class="cnx_label" contentEditable="false">Example 2</span>
<strong class="title content-editable" style="display: none;" contentEditable="true">
  <span class="hint-text">Add a title (optional)</span>
</strong>
</h2><div class="example-contents">

<div class="canvas-wrap">
      <div class="equation canvas inactive" id="eq2">
<div class="canvas-inner">
<div style="display: none;" class="canvas-buddy-2">
  <a class="edit-element" href="#" title="Edit options for this element">
    <img src="content_files/options-05.png">
  </a>
  <a class="remove-element" href="#" title="Remove this element">
    <img src="content_files/remove-element-01.png">
  </a>
</div>
<div style="display: none;" class="canvas-buddy">
  <a class="drag-element" href="#" title="Drag this element to another location">
    <img src="content_files/drag-element-19.png">
  </a>
</div>
<h2 class="equation-header">
<strong class="title content-editable" style="display: none;" contentEditable="true">
  <span class="hint-text">Add a title (optional)</span>
</strong>
</h2>
<div class="equation-contents">
<div class="content-editable" contentEditable="true">
5<sup>2</sup> + 7<sup>2</sup> &lt; 9<sup>2</sup>
</div>
<span class="equation-number">(2)</span>
</div>
</div>
</div>
</div>

</div>
</div>
</div>
</div>

</div></div>

</div></div>

</div></div>

</div></div>

</div></div>

</div></div>

<div class="solution-toggles" style="display: none;"><a href="#" onclick="toggleSolution('swsuper',1); return false;"><span class="solution-toggle">
          [
          Show Solution
          ]
        </span><span class="solution-toggle" style="display: none;">
          [ 
          Hide Solution
          ]
        </span></a></div></div>
</div>
</div>


<div class="add-solution-2">
  <a href="#asdf">Click to add another solution (optional)</a>
</div>


</div>
</div>

</div>
</div>

</div>
</div>

  <p class="para content-editable" id="para2" contentEditable="true" style="display: none;">
    Because the sinusoid is a superposition of two complex exponentials, the 
    sinusoid is more complex. We could not prevent ourselves from the pun in 
    this statement. Clearly, the word "complex" is used in two different ways 
    here. The complex exponential can also be written (using <a title="Strength 5" class="cnxn" href="/content/m0004/latest/#3">Euler's relation</a>) as a sum of a sine 
and a 
    cosine. We will discover that virtually every signal can be decomposed into a
    sum of complex exponentials, and that this decomposition is  <em class="emphasis">very 
    </em>useful. Thus, the complex exponential is more fundamental, and 
    Euler's relation does not adequately reveal its complexity.
  </p>

  </div>
</div>

<div class="glossary-outer">
<div class="glossary-container" id="cnx_glossary">
<h2 
class="glossary-header">Glossary</h2>
    <dl class="definition glossary" id="side"><dt><dfn class="term">sidereal period:</dfn></dt><dd><div 
class="meaning">A period determined by or from the 
stars.</div></dd></dl>
</div>
  </div>









</div>
</div>
</div>

        </div>


</div>









<!--
        <div id="footer">
          <a href="http://www.shuttleworthfoundation.org/" target="_blank"><img src="helper_files/sf150.png" width="150"/></a>
        </div>
-->

      </div>


    </div>
  </div>


  <div id="neworexisting" style="display: none;">
    <p><strong>
      Is this for a new module or will it override an existing one?
    </strong></p>
    <div>
      <span class="button" onclick="window.location = 'metadata-41.html'">New module</span>
      <div class="forminfo" style="margin: .5em 0 1em;">
      <div>
        This is an entirely new module. 
      </div>
    </div>
    <div>
      <span class="button" onclick="window.location = 'choose-module-16.html'">Override existing module</span>
      <div class="forminfo" style="margin: .5em 0 1em;">
      <div>
        Choose an existing module to apply your import to, replacing its contents.  
      </div>
    </div>
    <div class="headeraction" style="margin: 1.5em 0 0; text-align: center;">
      <div>
      <span class="button" id="cancel-neworexisting">Cancel</span>
    </div>
  </div>


  </body>
</html>



